---
title: "Polycentricity & Representation"
subtitle: "Cook County Descriptive Statistics<br>(2012-2022)"
author: "Michael Van Hulle"
date: "August 8, 2024"
date-modified: last-modified
date-format: long
format: 
  html:
    embed-resources: true
    theme: lumen
    code-fold: true
    code-line-numbers: true
    code-overflow: wrap
    toc: true
    toc-location: left
    df-print: paged
knitr: 
  opts_chunk:
    warning: true
    message: false
editor_options: 
  chunk_output_type: console
---

```{r setup}
#| output: false

library(tidyverse)
library(fixest)
library(modelsummary)
library(tinytable)
library(scales)

options(scipen = 999)

```

# Import and clean data

```{r data_import}
#| output: false

df <- read_csv("./apsa/apsa_data.csv")

df_clean <- df |>
  rename_with(~ gsub("^tc_c_", "", .)) |>
  rename_with(~ gsub("^PC_", "pins_", .))

df_clean |>
  select(!c(tax_code, clean_name, year, class)) |>
  datasummary_skim()

```

# Tax code as unit of observation

```{r}

# 346222 obs.

df_clean_temp <- df_clean |>
  # We want to remove observations that are in unincorporated parts of Cook County
  # 321,468 after removing unincorporated taxcodes
  filter(!is.na(clean_name)) |>
  group_by(tax_code, year) |>
  # Calculate landuse mix
  mutate(hhi = (sum(fmv_residential)/sum(fmv))^2 + (sum(fmv_industrial)/sum(fmv))^2 + (sum(fmv_commercial)/sum(fmv))^2)

df_temp_tc <- df_clean_temp |>
  group_by(year, tax_code) |>
  reframe(rate = first(tax_code_rate), municipality = first(clean_name), mean_fmv = first(mean_fmv_all), median_fmv = first(median_fmv_all), 
          min_fmv_all = first(min_fmv_all), fmv_incentive = sum(fmv_incentive), fmv_taxed = sum(fmv_taxed), fmv_inTIF = sum(fmv_inTIF), 
          fmv_incents_inTIF = sum(fmv_incents_inTIF), fmv_residential = sum(fmv_residential), fmv_commercial = sum(fmv_commercial), 
          fmv_industrial = sum(fmv_industrial), fmv = sum(fmv), tif_share = first(tif_share), total_tax = sum(total_bill_current), 
          levy = sum(levy)
            ) |>
  arrange(year) |>
  group_by(tax_code) |>
  mutate(lag_fmv = lag(fmv, n = 1),
         lag_fmv_incentive = lag(fmv_incentive, n = 1),
         lag_fmv_tif = lag(fmv_inTIF, n = 1),
         lag_incents_fmv_tif = lag(fmv_incents_inTIF),
         delta_fmv = (fmv - lag_fmv)/lag_fmv
  ) |>
  ungroup()
  

```


```{r very_naive}
  
lm()
  
  
)

```

```{r to_do}
#| eval: FALSE



```

# Pre-balancing

Initially, we have 1,282,930 PIN-year obs. 

## Cleanup

```{r data_clean}



```

## Descriptive Statistics

```{r unbalanced_descrips}



```

# Balanced panel

## Balancing panel

```{r balance_panel}


```


### Tests of missingness

```{r t_o_m}


```


## Descriptive Statistics

```{r balanced_stats}



```
