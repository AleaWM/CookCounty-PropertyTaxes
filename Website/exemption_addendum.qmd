---
title: "Supporting Content for 'Extended Analysis of Selected Benefits andCosts of Homestead Exemptions in Illinois'"
subtitle: "Addendum to The Current and Future Use of Homestead Exemptions in Cook County"
---

```{r setup, warning=FALSE, message=FALSE}
#| code-fold: TRUE


library(tidyverse)
library(ptaxsim)
library(DBI)
library(httr)
library(jsonlite)
library(glue)
library(DT)

knitr::opts_chunk$set(warning = FALSE, message = FALSE)
```


```{r}
#| code-fold: true

file_path <- "C:/Users/aleaw/" 

taxyear <-c(2021)
taxyear = as.data.frame(taxyear)



source("../scripts/helper_tc_muninames.R")
```


```{r}
#| code-fold: true

#ptaxsim_db_conn <- DBI::dbConnect(RSQLite::SQLite(), "./ptaxsim.db/ptaxsim-2023.0.0.db")

if (file.exists(file_path)){
   ptaxsim_db_conn <- DBI::dbConnect(RSQLite::SQLite(), "C:/Users/aleaw/OneDrive/Documents/PhD Fall 2021 - Spring 2022/Merriman RA/ptax/ptaxsim.db/ptaxsim-2023.0.0.db")
} else {
    ptaxsim_db_conn <- DBI::dbConnect(RSQLite::SQLite(), "./ptaxsim.db/ptaxsim-2023.0.0.db")

}


current_dir = getwd()

if (grepl("website", current_dir)) {
  dots = "../"
} else {
  dots = "../"
}

```


```{r}
path <- paste0(dots, "Output/ptaxsim_muni_level_2006to2023.csv")

muni_sums <- read_csv(path) %>% 
  left_join(nicknames)

path <- paste0(dots, "Output/ptaxsim_muni_class_summaries_2006to2023.csv")
muni_cl_sums <- read_csv(path) %>% 
  left_join(nicknames)
```

```{r}
# Identify PINs associated with tax codes

cook_pins <- DBI::dbGetQuery(
    ptaxsim_db_conn, 
    glue_sql("
             SELECT DISTINCT* 
             FROM pin 
             WHERE class > 199 AND class < 300
             AND year = 2021
             "
              , 
             .con = ptaxsim_db_conn))

cook_pins <- cook_pins |> 
  mutate(has_HO_exe = ifelse( exe_homeowner > 0, 1, 0),
         has_other_exe = ifelse(exe_senior + exe_freeze + exe_longtime_homeowner + exe_disabled + exe_vet_returning + exe_vet_dis_lt50 + exe_vet_dis_50_69 + exe_vet_dis_ge70 > 0, 1, 0 )) %>% 
  left_join(tc_muninames) %>%
    mutate(av = av_clerk) 

table(cook_pins$has_HO_ex)
table(cook_pins$has_other_exe)
```


```{r}
#| label: medianproperty-bymuni
#| fig-cap: "Median AV Class 2 property by Municipality"

q = c(.25, .5, .75)

## ranks properties that are considered single family homes in order of AV for each Muni
muni_quartiles <- cook_pins %>%
  group_by(agency_name) %>%
  arrange(av) %>%
  summarize(count_pins = n(), 
            min = min(av),
            quant25 = round(quantile(av, probs = q[1])), 
            quant50 = round(quantile(av, probs = q[2])),
            quant75 = round(quantile(av, probs = q[3])),
            max = max(av)
           ) %>% 
  arrange( desc( quant50))
muni_quartiles

munis_ranked <- cook_pins  %>%
  inner_join(muni_quartiles, by = c("agency_name")) %>% 
  mutate(rank = case_when(
    av > (quant25-500) & (av<quant25+500) ~ "q25",
    av > (quant50-500) & (av<quant50+500) ~ "q50",
    av > (quant75-500) & (av<quant75+500) ~ "q75")
    ) %>%
  select(clean_name, rank, av, pin, class, everything()) %>%
  left_join(nicknames)
```

```{r}
ccao_loa <- read_csv("../inputs/ccao_loa.csv") %>% 
  mutate(class_code = as.character(class_code))

    
```

## Which taxpayers benefit the most from homestead exemptions?

### Table 1. Comparison of Tax Bills for Median Assessed Value (AV) Class 2 Properties in Selected Municpalitiesunder the Status Quo and Alternative Scenario

### Figure 1. Examples of Actual Tax Bills

**Park Forest vs. Winnetka**

### Figure 2. Value of Median Residential Property Indifferent to Elimination of GHE

![](images/clipboard-1323518501.png)

## How progressive are exemptions?

### Figure 3. Ratio of Tax Bills to AV for 25th and 75th Percentile AV Class 2 Properties with \$10,000 GHE

![](images/clipboard-1581842196.png)


### Figure 4. Effect ofChanging the GHE on Progressivity

**2 X 3 image of distribution for each $10,000 increase in exemption amount**
### Table 3. Revenue Neutral Tax Rates

__Revenue Neutral Tax Rates (Percent) for Select Municipalities as a Function of GHE Value__


### Figure 5. GHE Value and Revenue Neutral Tax Rates

**Relationship of GHE Value and Revenue Neutral Tax Rates in Chicago, Dolton, and Glencoe**


## Can we identify an optimal exemption value

### Figure 6.

**Doesn't exist, whoops!**

### Figure 7. Exemptions by Value in Class 8 Municipalities


### Figure 8.  Exemption Share in Class 8 Municipalities



