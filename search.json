[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Summary Statistics and Findings using CCAO’s PTAXSIM package",
    "section": "",
    "text": "Background Information\n\nTHIS IS A WORK IN PROGRESS!\n\nAll data was originally posted by the Cook County Assessor’s Office (CCAO).\nTax data for Cook County was gathered using CCAO’s ptaxsim package and corresponding database.\nAll summarizing of data was done by Research Assistants working for the Government Finance Research Center at the University of Illinois Chicago."
  },
  {
    "objectID": "GetData.html#access-and-summarize-data-from-ptaxsim",
    "href": "GetData.html#access-and-summarize-data-from-ptaxsim",
    "title": "1  Get and Prepare Data",
    "section": "1.1 Access and Summarize Data from PTAXSIM",
    "text": "1.1 Access and Summarize Data from PTAXSIM\nBills were originally pulled from PTAXSIM and summed to the PIN level in files 1_...rmd and 2...rmd. Exemption data per PIN was pulled from PTAXSIM in file 3_.....rmd. These were then joined together in 4c_..... to create the 4c_joined_pins... CSV.\nThese files ended up being the building blocks for creating the ptax_pull_loop.R file that pulls the data for all the years and aggregates it in various ways.\nWhen looking at tax bill or assessed value distributions at the PIN or parcel level, the joined PIN data containing the taxbills and exemption information for the relevant year must be used. Download 4C_joined_PINs file from Box link here:. I would then move it from the download file into your R project and then the file paths should work with few to zero edits.\n\nsetwd(\"..\")   # set directory above current one (set to parent directory)\nsource(\"helper_tc_muninames.R\")\n\n\n\nCode\nsetwd(\"..\") \nsource(\"ptax_pull_loop.R\")\n\n\nNote: exe_abate is NOT included in the all_exemptions variable.\n\n\nCode\n#ptaxsim_db_conn &lt;- DBI::dbConnect(RSQLite::SQLite(), \"../ptaxsim.db/ptaxsim-2021.0.4.db\")\n\nmuni_summary &lt;- read_csv(\"../Output/ptaxsim_muni_level_2006-2021.csv\")\n\nmuni_MC_summary &lt;- read_csv(\"../Output/ptaxsim_muni_MC_2006-2021.csv\")\n\nMC_TC &lt;- read_csv(\"../Output/ptaxsim_TC_MC_summaries_2006-2021.csv\") %&gt;% filter(year == 2021)\n\n\n\nmuni_summary %&gt;% filter(year == 2021) %&gt;%\n  summarise(zeros = sum(zero_bills))\n\n\n\n  \n\n\nmuni_MC_summary %&gt;% filter(year == 2021 & major_class_code == 2) %&gt;%\n  summarise(zeros = sum(zero_bills))"
  },
  {
    "objectID": "breakeven-points.html#assessed-value-pin-distribution",
    "href": "breakeven-points.html#assessed-value-pin-distribution",
    "title": "2  Breakeven Points and Tax Bill Distributions",
    "section": "2.1 Assessed Value PIN distribution",
    "text": "2.1 Assessed Value PIN distribution\n\n\nCode\npin_data2 %&gt;%\n  filter((class &gt; 199 & class &lt; 300) & agency_name %in% c(\"VILLAGE OF PARK FOREST\", \"VILLAGE OF PHOENIX\", \"VILLAGE OF RIVERDALE\", \"VILLAGE OF WINNETKA\")) %&gt;%\n  group_by(agency_name) %&gt;%\n  ggplot() +\n  geom_histogram(aes(x = av, bins = 100)) +\n#  geom_vline(aes(xintercept = median(av, na.rm=TRUE), color = \"red\")) +\n  theme_classic()+\n  theme(legend.position = \"none\") + \n # geom_text(aes(x=(median(av) + 5000), y = 1500, label = median(av))) +\n  scale_x_continuous(limits = c(-5, 50000)) +\n  #   scale_y_continuous(limits = c(0, 1500))+\n  labs(title = \"PIN AV Distribution for All Class 2 Properties\", x=\"AV\", y=\"Number of PINs\") +\n  facet_wrap(~agency_name)\n\n\n\n\nCode\npin_data2 %&gt;%\n  filter((class &gt; 199 & class &lt; 300) &  agency_name == \"VILLAGE OF PHOENIX\") %&gt;%\n  group_by(agency_name) %&gt;%\n  ggplot() +\n  geom_histogram(aes(x = av, bins = 100)) +\n  geom_vline(aes(xintercept = median(av, na.rm=TRUE), color = \"red\")) +\n  geom_vline(aes(xintercept = 7974), linetype = \"dashed\", label = \"Breakeven AV\") +\n  theme_classic()+\n  theme(legend.position = \"none\") + \n  geom_text(aes(x=(median(av)), y = 450, label = median(av))) +\n  geom_text(aes(x=14000, y = 350), label = \"Breakeven AV = $7,974\") +\n  scale_x_continuous(limits = c(-5, 50000)) +\n  #   scale_y_continuous(limits = c(0, 1500))+\n  labs(title = \"Phoenix PIN AV Distribution for All Class 2 Properties\", x=\"AV\", y=\"Number of PINs\",\n      caption =  \"Median AV is $3,502, Breakeven AV is $7,974\")\n\n\n\n\nCode\npin_data2 %&gt;%\n  filter((class &gt; 199 & class &lt; 300) &  agency_name == \"CITY OF CHICAGO\") %&gt;%\n  ggplot() +\n  geom_histogram(aes(x = av, bins = 100)) +\n  geom_vline(aes(xintercept = median(av, na.rm=TRUE), color = \"red\")) +\n  geom_vline(aes(xintercept = 84228), linetype = \"dashed\") +\n  theme_classic()+\n  theme(legend.position = \"none\") + \n  geom_text(aes(x=median(av)+20000, y = 300000, label = median(av))) +\n geom_text(aes(x=100000, y = 200000), label = \"Breakeven AV = $84,228\") +\n\n  scale_x_continuous(limits = c(-5, 500000), labels = scales::dollar) +\n  scale_y_continuous(limits = c(0, 300000))+\n  labs(title = \"Chicago PIN AV Distribution for All Class 2 Properties\", \n       x=\"AV\", y=\"Number of PINs\",\n      caption =  \"Median AV is ~$21,000, Breakeven AV is ~$84,000\") \n\n\n\n2.1.1 How many homeowners would have decreased taxbills if the GHE were eliminated?\n\n\nCode\npin_data2 %&gt;% \n  filter((class &gt; 199 & class &lt; 300) ) %&gt;%  \n  left_join(muni_taxrates, by = \"agency_name\") %&gt;%\n  left_join(muni_breakeven_points, by = \"clean_name\") %&gt;%\n  filter(pin_AV &gt; nochange_av_munirates) %&gt;%\n  group_by(clean_name, has_HO_exemp) %&gt;%\n  summarize(n()) %&gt;%\n  mutate(has_HO_exemp = ifelse(has_HO_exemp == 0, \"Did not claim\", \"Claimed GHE\"))\n\n\n\n\n Table 2.3:  Count of PINs with AV &gt; breakeven point. Property classes\n200-299. \n  \n\n\n\n\n\n\nCode\npin_data2 %&gt;% \n  filter((class &gt; 199 & class &lt; 300)  & (has_HO_exemp == 1)) %&gt;%\n  left_join(muni_taxrates, by = \"agency_name\") %&gt;%\n    left_join(muni_breakeven_points, by = \"clean_name\") %&gt;%\n\n  filter(pin_AV &gt; nochange_av_munirates) %&gt;%\n  group_by(agency_name) %&gt;%\n  summarize(pins_over_breakpoint = n()) %&gt;%\n  left_join(muni_taxrates) %&gt;%\n  mutate(pct_c2_benefits = round((pins_over_breakpoint / C2_pins_in_muni)*100, digits = 4)) %&gt;%\n  select(clean_name, pins_over_breakpoint, pct_c2_benefits)\n\n\n\n\n Table 2.4:  Count of PINs with AV &gt; breakeven point. Property classes 200 -\n299 that claimed GHE in 2021 \n  \n\n\n\n\n\n\nCode\npin_data2 %&gt;% \n  filter((class &gt; 199 & class &lt; 300) & has_HO_exemp == 0) %&gt;%\n  left_join(muni_taxrates, by = \"agency_name\") %&gt;%\n  group_by(agency_name) %&gt;%\n  summarize(lowerbill_PINcount = n()\n            ) %&gt;%\n  left_join(muni_taxrates) %&gt;%\n  mutate(pct_c2_benefits = round((lowerbill_PINcount / C2_pins_in_muni)*100, digits = 4)) %&gt;%\n  select(clean_name, lowerbill_PINcount, pct_c2_benefits) %&gt;% arrange(pct_c2_benefits)\n\n\n\n\n Table 2.5:  Count of PINs with AV &gt; breakeven point. Property classes 200 -\n299 that did not claim the GHE in 2021 \n  \n\n\n\n\n\n\nCode\npin_data2 %&gt;% \n  filter(class &gt; 199 & class &lt; 300) %&gt;%\n  left_join(muni_taxrates, by = \"agency_name\") %&gt;%\n    left_join(muni_breakeven_points, by = \"clean_name\") %&gt;%\n\n  filter(pin_AV &lt; nochange_av_munirates & has_HO_exemp == 1) %&gt;%\n  group_by(agency_name) %&gt;%\n  summarize(under_breakpoint = n()) %&gt;%\n  left_join(muni_taxrates) %&gt;%\n  mutate(pct_c2_w_higherbills = round((under_breakpoint / C2_pins_in_muni)*100, digits = 4)) %&gt;%\n  select(clean_name, under_breakpoint, pct_c2_w_higherbills) %&gt;% arrange(clean_name)\n\n\n\n\n Table 2.6:  Count of PINs that claimed GHE with AV below the breakeven point.\nThese properties would experience an increased tax bill if the GHE were\nremoved. \n  \n\n\n\n\n\n\nCode\nhomeowners_higherbills &lt;- pin_data2 %&gt;%   \n  filter(class &gt; 199 & class &lt; 300) %&gt;%\n  filter((cur_comp_TC_rate*(eav-exe_homeowner) &lt; (new_comp_TC_rate*eav))) %&gt;%\n  group_by(agency_name, ) %&gt;%\n  summarize(higherbill_PINcount = n()) %&gt;%\n  left_join(muni_taxrates, by = \"agency_name\") %&gt;%\n  select(clean_name, higherbill_PINcount, C2_pins_in_muni) %&gt;%\n  mutate(pct_C2_higherbills = higherbill_PINcount / C2_pins_in_muni)\nhomeowners_higherbills %&gt;% arrange(clean_name)\n\n\n\n\n Table 2.7:  Count of PINs where current tax bill &lt; hypothetical tax bill \n  \n\n\n\n\n\n\nCode\n## Number of residential PINs that would have a lower tax bill in each muni\nhomeowners_benefited &lt;- pin_data2 %&gt;% \n  filter(class &gt; 199 & class &lt; 300) %&gt;%\n  # filter keeps obs if they didn't claim the exemption OR they did claim it & have fancy houses\n  # filter(has_HO_exemp == 0 | (has_HO_exemp == 1 & pin_AV &gt; nochange_av)) %&gt;%\n  \n  filter(\n    # did not claim the general homeowner exemption (GHE)\n    has_HO_exemp == 0 | \n      # OR \n      # did claim the GHE in 2021, but their new bill still goes down compared \n      # to than their current tax bill if the GHE were removed  \n      # implies that the hypothetical taxrate change*eav &gt; exempt EAV * current tax rate \n      (has_HO_exemp == 1 & (cur_comp_TC_rate*(eav-exe_homeowner) &gt; (new_comp_TC_rate*eav)))) %&gt;%\n  \n  group_by(agency_name, has_HO_exemp) %&gt;%\n  summarize(lowerbill_PINcount = n()) %&gt;%\n  left_join(muni_taxrates, by = \"agency_name\") %&gt;%\n\n  mutate(lowerbill_PINcount = ifelse(is.na(lowerbill_PINcount), 0, lowerbill_PINcount)) %&gt;%\n  pivot_wider(id_cols = c(clean_name, C2_pins_in_muni), names_from = has_HO_exemp, values_from =  lowerbill_PINcount,  ) %&gt;% \n  rename(didnot_claim = `0`,\n         lowerbill_did_claim_GHE = `1`) %&gt;% \n  mutate(lowerbill_did_claim_GHE = ifelse(is.na(lowerbill_did_claim_GHE), 0, lowerbill_did_claim_GHE),\n    lowerbill_PINcount = didnot_claim + lowerbill_did_claim_GHE,\n    pct_c2_w_higherbills = 100-round((lowerbill_PINcount / C2_pins_in_muni)*100, digits = 2),\n    pct_c2_w_lowerbills = round((lowerbill_PINcount / C2_pins_in_muni)*100, digits = 2),\n    pct_c2_lowerbills_did_claim = round((lowerbill_did_claim_GHE / C2_pins_in_muni)*100, digits = 2),\n    pct_c2_lowerbills_didnotclaim = round((didnot_claim / C2_pins_in_muni)*100, digits = 2))\n\n\n# homeowners_benefited\n\n\n\n\nCode\nhomeowners_benefited %&gt;% arrange(clean_name)\nhomeowners_higherbills %&gt;% arrange(clean_name)\n#homeowners_benefited %&gt;% write_csv(\"../Output/homeowner_billchanges.csv\")\n\n\n\nComparison of increased and decreased tax bills\n\n\n\n\n\n  \n\n\n\n\n\n\n\n  \n\n\n\n\n\n\n\n2.1.2 Property Value where Bill doesn’t change\n\n\nCode\nnobillchange &lt;- muni_taxrates %&gt;% \n  left_join(muni_breakeven_points, by = \"clean_name\") %&gt;%\n  rename(nobillchange_propertyEAV = nobillchange_propertyEAV_munirates,\n         nochange_av = nochange_av_munirates)\n\nnobillchange %&gt;%       \n  filter(agency_name %in% c(\"VILLAGE OF PARK FOREST\", \"VILLAGE OF PHOENIX\", \"VILLAGE OF RIVERDALE\", \"VILLAGE OF WINNETKA\", \"CITY OF CHICAGO\")) %&gt;%\n  ggplot(aes(y=C2median_av, x = agency_name)) +\n  geom_col()+\n    geom_text(aes(y=C2median_av + 3000, label = round(C2median_av) ) ) +\n  scale_y_continuous(labels = scales::dollar) +\n  theme_classic() +\n  scale_x_discrete(label = c(\"Chicago\",\"Park Forest\", \"Phoenix\", \"Riverdale\", \"Winnetka\")) + \n  labs(y = \"Median Residential AV\", x = \"\", title = \"Median Residential Property Assessed Value - All Class 2 property Types\")\nnobillchange %&gt;%       \n  filter(agency_name %in% c(\"CITY OF CHICAGO\", \"VILLAGE OF PARK FOREST\", \"VILLAGE OF PHOENIX\", \"VILLAGE OF RIVERDALE\", \"VILLAGE OF WINNETKA\")) %&gt;%\n  ggplot(aes(y=(nobillchange_propertyEAV/eq_2021), x = agency_name)) +\n  geom_col() +\n  geom_text(aes(y=(nobillchange_propertyEAV/eq_2021) + 3000, label = round(nobillchange_propertyEAV/eq_2021)) ) +\n  scale_y_continuous(labels = scales::dollar) +\n  theme_classic() +\n  scale_x_discrete(label = c(\"Chicago\", \"Park Forest\", \"Phoenix\", \"Riverdale\", \"Winnetka\")) + \n  labs(y = \"Breakeven Point - AV\", x = \"\", title = \"Residential Property AV Breakeven Point\", caption = \"Residential properties above these values would have their bills decrease if the GHE were eliminated\n       (if they had claimed the GHE before)\")\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nCode\nnochange &lt;- C2_munistats %&gt;% \n  left_join(muni_taxrates) %&gt;%\n  left_join(muni_breakeven_points) %&gt;%\n  rename(nobillchange_propertyEAV = nobillchange_propertyEAV_munirates,\n         nochange_av = nochange_av_munirates)\n\nnochange %&gt;%\n # filter(nochange_av &lt; 300000) %&gt;%\n  ggplot(aes(y=nochange_av, \n             x = C2median_av, \n             label=clean_name\n             )) +\n  geom_point(aes(alpha = .5)) +\n # geom_smooth(method = \"lm\" )+\n  geom_text(aes(y = (nochange_av-5000), x = (C2median_av)), size = 2)+\n  theme_classic() +\n  scale_x_continuous(labels = scales::dollar) +\n  scale_y_continuous(labels = scales::dollar) +\n  theme(legend.position = \"none\")+\n  labs(y = \" Breakeven Point\", \n       x = \"Median AV - Class 2 Properties in Municipality\", title = \"Some highly valued homes would have lower tax bills if the GHE were eliminated\", \n       caption = \"The breakeven point is the assessed values at which a major class 2 \n       property would not have their taxbill change if the GHE were eliminated.\")\n\n\n\n\n\nFigure 2.1: Includes all municipalities\n\n\n\n\n\n\nCode\nnochange %&gt;%\n  filter(nochange_av &lt; 300000) %&gt;%\n  ggplot(aes(y=nochange_av, \n             x = C2median_av, \n             label=clean_name\n             )) +\n  geom_point(aes(alpha = .5)) +\n  \n  geom_point(data = (nochange %&gt;% filter(clean_name %in% c(\"Park Forest\", \"Chicago\", \"Winnetka\", \"Riverdale\",\"Dolton\"))), aes(y = nochange_av, x = C2median_av, color = \"red\"), size = 3) +\n  ggrepel::geom_label_repel(data = (nochange %&gt;% filter(clean_name %in% c(\"Park Forest\", \"Chicago\", \"Winnetka\", \"Riverdale\", \"Dolton\"))), aes(y = (nochange_av), x = (C2median_av)), size = 3)+\n  theme_classic() +\n  scale_x_continuous(labels = scales::dollar) +\n  scale_y_continuous(labels = scales::dollar) +\n    theme(legend.position = \"none\") +\n\n  labs(title = \"Municipalities' Median AV & Breakeven Point - Class 2 Properties Only\",\n    y = \"Breakeven Point\", \n       x = \"Median AV\")\n\n\n\n\n\nFigure 2.2: Excludes outliers: labeled\n\n\n\n\n\n\nCode\nnochange %&gt;%\n  filter(nochange_av &lt; 300000) %&gt;%\n  ggplot(aes(y=nochange_av, \n             x = C2median_av, \n             label=clean_name\n             )) +\n  geom_point(aes(alpha = .5)) +\n  \n  geom_point(data = (nochange %&gt;% filter(clean_name %in% c(\"Park Forest\", \"Chicago\", \"Winnetka\", \"Riverdale\",\"Dolton\"))), aes(y = nochange_av, x = C2median_av, color = \"red\"), size = 3) +\n    #ggrepel::geom_text_repel(aes(label = clean_name), vjust = -1,colour=\"black\") + \n\n # geom_smooth(method = \"lm\" )+\n # ggrepel::geom_text_repel(data = (nochange %&gt;% filter(clean_name %in% c(\"Park Forest\", \"Chicago\", \"Winnetka\", \"Riverdale\", \"Dolton\"))), aes(y = (nochange_av), x = (C2median_av)), size = 3)+\n  theme_classic() +\n  scale_x_continuous(labels = scales::dollar) +\n  scale_y_continuous(labels = scales::dollar) +\n    theme(legend.position = \"none\") +\n\n  labs(title = \"Municipalities' Median AV & Breakeven Point - Class 2 Properties Only\",\n    y = \"Breakeven Point\", \n       x = \"Median AV\", \n caption = \"The breakeven point is the assessed values at which a major class 2 property would not have their taxbill change if the \n GHE were eliminated. Excludes outliers: University Park, Bedford Park, McCook, Hodgkins, and Rosemont. Class 2 properties that had\n claimed the GHE would have lower taxbills even if the GHE were removed if the AV is above the breakeven point.\")\n\n\n\n\nFigure 2.3: Excludes outliers\n\n\n\n\n\n\n\nCode\nnochange %&gt;%\n  filter(clean_name %in% c(\"Phoenix\", \"Park Forest\", \"Riverdale\")) %&gt;%\n  ggplot(aes(y=nochange_av, \n             x = C2median_av, \n             label=clean_name\n             )) +\n  geom_point() +\n  geom_text(aes(y = (nochange_av-500), x = (C2median_av-100)), size = 3)+\n  theme_classic() +\n  scale_x_continuous(labels = scales::dollar, limits = c(0,10000)) +\n  scale_y_continuous(labels = scales::dollar, limits = c(0,20000)) +\n  labs(title = \"Municipalities' Median AV & Breakeven Point\",\n    y = \" Breakeven Point\", \n       x = \"Median AV\", \n caption = \"The breakeven point is the assessed values at which a major class 2 property would not have their taxbill change if the GHE \n were eliminated. Excludes outliers: University Park, Bedford Park, McCook, Hodgkins, and Rosemont. Class 2 properties that had\n claimed the GHE would have lower taxbills even if the GHE were removed if the AV is above the breakeven point.\")\n\n\n\n\nFigure 2.4: Do tax bills still counter-intuitively fall when exemptions are eliminated: The case of Phoenix, Park Forest, and Riverdale\n\n\n\n\n\n\n\nCode\n# nochange %&gt;%\n#       filter(agency_name %in% c(\"VILLAGE OF PARK FOREST\", \"VILLAGE OF PHOENIX\", \"VILLAGE OF RIVERDALE\") ) %&gt;%\n#   filter(is.finite(nobillchange_propertyEAV) )%&gt;%\n#   select(agency_name, nobillchange_propertyEAV, rate_change, everything()) %&gt;%\n#  # filter(nobillchange_propertyEAV &lt; 7000000) %&gt;% \n#   ggplot(aes(x=nobillchange_propertyEAV, y = median_eav, label=clean_name)) +\n#   geom_point()+\n#   geom_text(aes(x =(nobillchange_propertyEAV), y = (median_eav+500)), size = 2) +\n#       scale_x_continuous(labels = scales::dollar) +\n#       scale_y_continuous(labels = scales::dollar) +\n#   theme_classic() +\n#   labs(x = \"EAV of Class 2 Property w/ No Bill Change\", y = \"Median EAV of Municipality\", title = \"Can homeowners have lower tax bills if the GHE exemption was ended?\",\n#        subtitle = \"Yes, in very, very rare cases. \")\n# \n# \n# nochange %&gt;%\n#     #  filter(agency_name == \"VILLAGE OF WINNETKA\") %&gt;%\n#         filter(median_eav &gt; 150000) %&gt;%\n#   filter(is.finite(nobillchange_propertyEAV) ) %&gt;%\n#   select(agency_name, nobillchange_propertyEAV, rate_change, everything()) %&gt;%\n#   #filter(nobillchange_propertyEAV &lt; 7000000) %&gt;% \n#   ggplot(aes(x=nobillchange_propertyEAV, y = median_eav, label=clean_name)) +\n#   geom_point()+\n#   geom_text(aes(x =(nobillchange_propertyEAV), y = (median_eav+5000)), size = 2) +\n#       scale_x_continuous(labels = scales::dollar) +\n#       scale_y_continuous(labels = scales::dollar) +\n#   theme_classic() +\n#   labs(x = \"EAV of Class 2 Property w/ No Bill Change\", y = \"Median EAV of Municipality\", title = \"Can homeowners with GHE benefit from removal of the GHE?\",\n#        caption = \"A $500K home in Winnetka would benefit if everyone else lost their General Homestead Exemption\")\n\n\n# nochange  %&gt;%\n#   filter(is.finite(nobillchange_propertyEAV) ) %&gt;%\n#   select(agency_name,   nobillchange_propertyEAV, rate_change, everything()) %&gt;%\n# #  filter(nobillchange_propertyEAV &lt; 7000000) %&gt;% \n#   ggplot(aes(x=nobillchange_propertyEAV, y = median_eav, label=clean_name)) +\n#   # geom_smooth(method = \"lm\" )+\n#   geom_text(aes(x = (nobillchange_propertyEAV), y = (median_eav+1000)), size = 2)+\n#   theme_classic() +\n#   scale_x_continuous(labels = scales::dollar) +\n#   scale_y_continuous(labels = scales::dollar) +\n#   labs(x = \"EAV of Class 2 Property w/ No Bill Change\", y = \"Median EAV of Municipality\", title = \"Can homeowners who claim GHE benefit from removal of the GHE?\",\n#        subtitle = \"In very, very rare instances: yes. \")\n\n# \n# nochange %&gt;%\n#   select(agency_name,   nobillchange_propertyEAV, rate_change, everything()) %&gt;%\n# #  filter(nobillchange_propertyEAV &lt; 7000000) %&gt;% \n#   ggplot(aes(y=rate_change, x = median_eav, label=clean_name)) +\n#   geom_point() +\n#   theme_classic() +\n#   scale_x_continuous(labels = scales::dollar) +\n#   labs(x= \"EAV of Class 2 Property w/ No Bill Change\", y = \"Composite Tax Rate Change (Percentage Points)\", title = \"EAV of Residential Property 'Breakeven Point' & Composite Tax Rate Change \n#        from Elimination of GHE\")\n\nnochange %&gt;%\n  select(agency_name,   nobillchange_propertyEAV, rate_change, everything()) %&gt;%\n  ggplot(aes(y=rate_change, x = C2median_av, label=clean_name)) +\n  geom_point() +\n  theme_classic() +\n  scale_x_continuous(labels = scales::dollar) +\n  labs(x= \"AV of Class 2 Property w/ No Bill Change\", y = \"Composite Tax Rate Change (Percentage Points)\", title = \"AV of Residential Property 'Breakeven Point' & Composite Tax Rate Change \n       from Elimination of GHE\")\n\n\n\n\n\nCode\n# \n# nochange %&gt;%\n#   select(agency_name,   nobillchange_propertyEAV, rate_change, everything()) %&gt;%\n#   ggplot(aes(y=rate_change, x = C2median_av*10, label=agency_name)) +\n#   geom_point() +\n#   theme_classic() +\n#   scale_x_continuous(labels = scales::dollar) +\n#   labs(x= \"Market Value of Class 2 Property \n#        at 'Breakeven Point'\", \n#        y = \"Composite Tax Rate Change \n#        (Percentage Points)\", \n#        title = \"Market Value of Residential Property 'Breakeven Point' & \n#        Composite Tax Rate Change from Elimination of GHE\")"
  },
  {
    "objectID": "breakeven-points.html#class-2-summary-tables",
    "href": "breakeven-points.html#class-2-summary-tables",
    "title": "2  Breakeven Points and Tax Bill Distributions",
    "section": "2.2 Class 2 Summary Tables",
    "text": "2.2 Class 2 Summary Tables\n\n\nCode\ntax_bill_change_HO &lt;- pin_data2 %&gt;% \n  filter(pin_AV &gt; 0) %&gt;% \n  filter(agency_name %in% c(\"VILLAGE OF PARK FOREST\", \"VILLAGE OF PHOENIX\", \"VILLAGE OF WINNETKA\", \"VILLAGE OF RIVERDALE\")) %&gt;%\n    filter(class &gt;199 & class &lt; 300) %&gt;% \n  arrange(av) %&gt;%\n    mutate(bill_current = (final_tax_to_dist + final_tax_to_tif),\n         bill_noexemps =  new_comp_TC_rate/100*(equalized_AV-all_exemptions+exe_homeowner),\n         bill_change = bill_noexemps - bill_current) %&gt;%\n  group_by(agency_name, has_HO_exemp) %&gt;% \n  summarize(median_AV = median(av),\n            median_EAV = median(eav),\n            median_bill_cur = round(median(bill_current)),\n            median_bill_new = round(median(bill_noexemps)),\n            median_change = round(median(bill_change)),\n            pincount=n(),\n            perceived_savings = median(tax_amt_exe))\n\ntax_bill_change_HO\n\n\n\n\n  \n\n\n\nCode\npin_data2 %&gt;% \nfilter(pin_AV &gt; 0) %&gt;% \n  filter(agency_name %in% c(\"VILLAGE OF PARK FOREST\", \"VILLAGE OF PHOENIX\", \"VILLAGE OF WINNETKA\", \"VILLAGE OF RIVERDALE\")) %&gt;%\n    filter(class &gt;199 & class &lt; 300) %&gt;% \n  arrange(av) %&gt;%\n  mutate(median_EAV = median(eav),\n            median_bill_cur = round(median(bill_current)),\n            median_bill_new = round(median(bill_noexemps)),\n            median_change = round(median(bill_change)),\n            pincount=n(),\n            perceived_savings = median(tax_amt_exe))\n\n\n\n\n  \n\n\n\nCode\n## Grouped by if they have a $0 tax bill and had the GHE per muni\npin_data2 %&gt;% \nfilter(pin_AV &gt; 0) %&gt;% \n  filter(agency_name %in% c(\"VILLAGE OF PARK FOREST\", \"VILLAGE OF PHOENIX\", \"VILLAGE OF WINNETKA\", \"VILLAGE OF RIVERDALE\")) %&gt;%\n  #filter(class == 203) %&gt;% \n    filter(class &gt;199 & class &lt; 300) %&gt;% \n\n  arrange(av) %&gt;%\n    mutate(bill_current = (final_tax_to_dist + final_tax_to_tif),\n         bill_noexemps =  new_comp_TC_rate/100*(equalized_AV-all_exemptions+exe_homeowner),\n         bill_change = bill_noexemps - bill_current) %&gt;%\n  group_by(agency_name, zero_bill, has_HO_exemp) %&gt;% \n  summarize(median_AV = median(av),\n            median_EAV = median(eav),\n            median_bill_cur = round(median(bill_current)),\n            median_bill_new = round(median(bill_noexemps)),\n            median_change = round(median(bill_change)),\n            pincount=n(),\n            perceived_savings = median(tax_amt_exe))\n\n\n\n\n  \n\n\n\n\n2.2.1 Calculation for Median properties in each munis\n\n\nCode\n## Grouped by if they have a $0 tax bill and had the GHE per muni\n## Recalculating for Josh & Rachael\nmuni_median_summarytable &lt;- pin_data2 %&gt;% \n  # filter(agency_name %in% c(\"VILLAGE OF PARK FOREST\", \"VILLAGE OF PHOENIX\", \"VILLAGE OF WINNETKA\", \"VILLAGE OF RIVERDALE\")) %&gt;%\n  \n  #filter(class == 203) %&gt;% \n  filter(class &gt;199 & class &lt; 300) %&gt;% \n  \n  # merge in muni residential median AV\n  left_join(C2_munistats_filtered) %&gt;%\n  \n  # +/- 500 from municpalities median residential AV\n  filter(av+500 &gt; median_av | av-500&lt; median_av) %&gt;%\n  \n  # Removes properties that received other types of exemptions\n  filter(exe_senior == 0 & \n           exe_freeze == 0 & \n           exe_longtime_homeowner == 0 & \n           exe_disabled == 0 & \n           exe_vet_returning == 0 & \n           exe_vet_dis_lt50 == 0 & \n           exe_vet_dis_50_69 == 0 & \n           exe_vet_dis_ge70 == 0 & \n           exe_abate == 0) %&gt;%\n  \n  arrange(av) %&gt;%\n  \n  mutate(bill_current = (final_tax_to_dist + final_tax_to_tif),\n         bill_noexemps =  new_comp_TC_rate/100*(equalized_AV-all_exemptions+exe_homeowner),\n         bill_change = bill_noexemps - bill_current) %&gt;%\n  \n  group_by(agency_name, # zero_bill, \n           has_HO_exemp\n           ) %&gt;% \n  \n  summarize(AV = median(median_av),\n            `Taxable EAV` = median(eav),\n            bill_cur = round(median(bill_current)),\n            bill_new = round(median(bill_noexemps)),\n            bill_change = round(median(bill_change)),\n            pincount=n(),\n            perceived_savings = median(tax_amt_exe)) %&gt;% \n  \n  # merge in clean_names variable\n  left_join(nicknames) %&gt;%\n  \n  select(clean_name, has_HO_exemp, bill_cur, bill_new, bill_change, perceived_savings,  AV, `Taxable EAV`, everything())"
  },
  {
    "objectID": "breakeven-points.html#tax-bill-distributions",
    "href": "breakeven-points.html#tax-bill-distributions",
    "title": "2  Breakeven Points and Tax Bill Distributions",
    "section": "2.3 Tax Bill Distributions",
    "text": "2.3 Tax Bill Distributions\n\n\nCode\npin_data2 %&gt;%\n  filter(major_class_code == 2 & bill_current &lt; 30000 & agency_name == \"VILLAGE OF PARK FOREST\") %&gt;% ggplot() +\n  geom_histogram(aes(x= bill_current, bins = 100))+\n    geom_vline(aes(xintercept=median(bill_current, na.rm=TRUE), color = \"red\")) +\n    theme_classic()+theme(legend.position = \"none\") + \n\n  scale_x_continuous(limits = c(-5,20000), label = scales::dollar) +\n  scale_y_continuous(limits = c(0, 1500), label = scales::comma)+\n  labs(x=\"PF's Actual Tax Bills With Current Exemptions\", y = \"Number of Tax Bills\")\npin_data2 %&gt;%\n  group_by(has_HO_exemp) %&gt;%\n  filter(major_class_code == 2 & bill_current &lt; 30000 & agency_name == \"VILLAGE OF PARK FOREST\") %&gt;% ggplot() +\n  geom_histogram(aes(x= bill_current, bins = 100))+\n    theme_classic()+theme(legend.position = \"none\") + \n  scale_x_continuous(limits = c(-5,20000), label = scales::dollar) +\n  scale_y_continuous(limits = c(0, 1500), label = scales::comma)+\n  labs(x=\"PF's Actual Tax Bills With Current Exemptions\", y = \"Number of Tax Bills\") +\n  facet_wrap(~has_HO_exemp)\npin_data2 %&gt;%\n  filter(major_class_code == 2 & bill_noexemps &lt; 30000 & agency_name == \"VILLAGE OF PARK FOREST\") %&gt;% ggplot() +\n  geom_histogram(aes(x= bill_noexemps, bins = 100))+\n    geom_vline(aes(xintercept=median(bill_noexemps, na.rm=TRUE), color = \"red\")) +\n    theme_classic()+theme(legend.position = \"none\") + \n\n  scale_x_continuous(limits = c(-5,20000), label = scales::dollar) + \n    scale_y_continuous(limits = c(0, 1500), label = scales::comma)+\n\n  labs(x=\"PF's Tax Bills Without General Homestead Exemptions\", y = \"Number of Tax Bills\")\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nCode\npin_data2 %&gt;%\n  filter(major_class_code == 2 & agency_name == \"VILLAGE OF PHOENIX\") %&gt;% ggplot() +\n  geom_histogram(aes(x= bill_current, bins = 100))+\n    geom_vline(aes(xintercept=median(bill_current, na.rm=TRUE), color = \"red\")) +\n    theme_classic()+theme(legend.position = \"none\") + \n\n  scale_x_continuous(limits = c(-5,20000)) + \n   scale_y_continuous(limits = c(0, 600))+\n\n  labs(title=\"PHOENIX's Current Tax Bill Distribution\", x = \"Dollars\", y = \"Number of Tax Bills\")\n\npin_data2 %&gt;%\n  filter(major_class_code == 2 & agency_name == \"VILLAGE OF PHOENIX\") %&gt;% ggplot() +\n  geom_histogram(aes(x= bill_noexemps, bins = 100))+\n    geom_vline(aes(xintercept=median(bill_noexemps, na.rm=TRUE), color = \"red\")) +\n    theme_classic()+theme(legend.position = \"none\") + \n\n  scale_x_continuous(limits = c(-5,20000)) + \n    scale_y_continuous(limits = c(0, 600))+\n\n  labs(title=\"PHOENIX's Tax Bills Without General Homestead Exemptions\", y = \"Number of Tax Bills\")\n\n\n\n\n\n\nFigure 2.5: ?(caption)\n\n\n\n\n\n\n\nFigure 2.6: ?(caption)\n\n\n\n\n\n\n\n\n\nCode\npin_data2 %&gt;%\n  filter(major_class_code == 2 & agency_name == \"VILLAGE OF WINNETKA\") %&gt;% ggplot() +\n  geom_histogram(aes(x= bill_current, bins = 100))+\n    geom_vline(aes(xintercept=median(bill_current, na.rm=TRUE), color = \"red\")) +\n    theme_classic()+theme(legend.position = \"none\") + \n\n # scale_x_continuous(limits = c(-5,20000)) +\n # scale_y_continuous(limits = c(0, 80000)) +\n  labs(title=\"WINNETKA's Actual Tax Bills With Current Exemptions\", x= \"Dollars\", y = \"Number of Tax Bills\")\n\npin_data2 %&gt;%\n  filter(major_class_code == 2  & agency_name == \"VILLAGE OF WINNETKA\") %&gt;% ggplot() +\n  geom_histogram(aes(x= bill_noexemps, bins = 100))+\n    geom_vline(aes(xintercept=median(bill_noexemps, na.rm=TRUE), color = \"red\")) +\n    theme_classic()+theme(legend.position = \"none\") + \n\n  #scale_x_continuous(limits = c(-5,20000)) + \n  #scale_y_continuous(limits = c(0, 80000)) +\n\n  labs(title=\"WINNETKA's Tax Bills Without General Homestead Exemptions\", x=\"Dollars\", y = \"Number of Tax Bills\")\n\n\n\n\n\n\nFigure 2.7: ?(caption)\n\n\n\n\n\n\n\nFigure 2.8: ?(caption)\n\n\n\n\n\n\n\n\n\nCode\npin_data2 %&gt;%\n  filter(major_class_code == 2 & agency_name == \"VILLAGE OF PARK FOREST\") %&gt;% \n  ggplot() +\n  geom_histogram(aes(x= bill_change, bins = 100))+\n    geom_vline(aes(xintercept=median(bill_change, na.rm=TRUE), color = \"red\")) +\n    theme_classic()+\n  theme(legend.position = \"none\") + \n    scale_x_continuous(limits = c(-10000,10000)) +\n\n#   scale_y_continuous(limits = c(0, 2000))+\n  labs(title=\"Park Forest's Change in Tax Bills\", subtitle =  \"Hypothetical with no General Homestead Exemptions\", x = \"Change in Tax Bill ($)\", y = \"Number of Tax Bills\")\n\npin_data2 %&gt;%\n  filter(major_class_code == 2 & agency_name == \"VILLAGE OF PHOENIX\") %&gt;% ggplot() +\n  geom_histogram(aes(x= bill_change, bins = 100))+\n    geom_vline(aes(xintercept=median(bill_change, na.rm=TRUE), color = \"red\")) +\n    theme_classic()+ theme(legend.position = \"none\") + \n   scale_x_continuous(limits = c(-10000,10000)) +\n\n#   scale_x_continuous(limits = c(-2800,2800)) + \n#   scale_y_continuous(limits = c(0, 2000))+\n\n  labs(title =\"PHOENIX's Change in Tax Bills\", subtitle = \"Hypothetical with no General Homestead Exemptions\", x = \"Change in Tax Bill ($)\", y = \"Number of Tax Bills\")\n\npin_data2 %&gt;%\n  filter(major_class_code == 2 & agency_name == \"VILLAGE OF WINNETKA\") %&gt;% ggplot() +\n  geom_histogram(aes(x= bill_change, bins = 100))+\n    geom_vline(aes(xintercept=median(bill_change, na.rm=TRUE), color = \"red\")) +\n    theme_classic()+theme(legend.position = \"none\") + \n   scale_x_continuous(limits = c(-10000,10000)) +\n  labs(title=\"WINNETKA's Change in Tax Bills Without General Homestead Exemptions\", y = \"Number of Tax Bills\", x = \"Dollars\")\n\npin_data2 %&gt;%\n  filter(major_class_code == 2 & agency_name == \"VILLAGE OF RIVERDALE\") %&gt;% ggplot() +\n  geom_histogram(aes(x= bill_change, bins = 100))+\n    geom_vline(aes(xintercept=median(bill_change, na.rm=TRUE), color = \"red\")) +\n    theme_classic()+\n  theme(legend.position = \"none\") + \n   scale_x_continuous(limits = c(-10000,10000)) +\nlabs(title=\"RIVERDALE's Change in Tax Bills Without General Homestead Exemptions\", y = \"Number of Tax Bills\", x = \"Dollars\")\n\n\n\n\n\n\nFigure 2.9: ?(caption)\n\n\n\n\n\n\n\nFigure 2.10: ?(caption)\n\n\n\n\n\n\n\n\n\nFigure 2.11: ?(caption)\n\n\n\n\n\n\n\nFigure 2.12: ?(caption)\n\n\n\n\n\n\n\n\n\nCode\npin_data2 %&gt;% \nfilter(pin_AV &gt; 0) %&gt;% \n  filter(agency_name %in% c(\"VILLAGE OF PARK FOREST\", \"VILLAGE OF PHOENIX\", \"VILLAGE OF WINNETKA\")) %&gt;%\n  filter(class &gt;199 & class &lt; 300) %&gt;% \n  arrange(av) %&gt;%\n # group_by(agency_name, has_HO_exemp) %&gt;% \n  mutate(#taxable_eav = final_tax_to_dist / tax_code_rate,\n    # current bill = current tax rate * portion of levy billed\n         bill_current = (final_tax_to_dist + final_tax_to_tif),\n         bill_noexemps =  new_comp_TC_rate/100*(equalized_AV-all_exemptions+exe_homeowner),\n         bill_change = bill_noexemps - bill_current) %&gt;%\n  group_by(agency_name, zero_bill, has_HO_exemp) %&gt;% \n  summarize(median_AV = median(av),\n            median_EAV = median(eav),\n            mean_bill_cur = mean(bill_current, na.rm=TRUE),\n            median_bill_cur = median(bill_current),\n            mean_bill_new = mean(bill_noexemps, na.rm=TRUE),\n            median_bill_new = median(bill_noexemps),\n            mean_change = mean(bill_change, na.rm=TRUE),\n            median_change = median(bill_change),\n            perceived_savings = median(tax_amt_exe),\n            cur_comp_TC_rate = mean(cur_comp_TC_rate),\n            new_comp_TC_rate = mean(new_comp_TC_rate),\n            pincount=n()\n)\npin_data2 %&gt;% \nfilter(pin_AV &gt; 0) %&gt;% \n  filter(agency_name %in% c(\"VILLAGE OF PARK FOREST\", \"VILLAGE OF PHOENIX\", \"VILLAGE OF WINNETKA\", \"VILLAGE OF RIVERDALE\")) %&gt;%\n  filter(class &gt;199 & class &lt; 300) %&gt;% \n  arrange(av) %&gt;%\n # group_by(agency_name, has_HO_exemp) %&gt;% \n  mutate(#taxable_eav = final_tax_to_dist / tax_code_rate,\n    # current bill = current tax rate * portion of levy billed\n         bill_current = (final_tax_to_dist + final_tax_to_tif),\n         bill_noexemps =  new_comp_TC_rate/100*(equalized_AV-all_exemptions+exe_homeowner),\n         bill_change = bill_noexemps - bill_current) %&gt;%\n  group_by(agency_name, has_HO_exemp) %&gt;% \n  summarize(median_AV = median(av),\n            median_EAV = median(eav),\n            mean_bill_cur = mean(bill_current, na.rm=TRUE),\n            median_bill_cur = median(bill_current),\n            mean_bill_new = mean(bill_noexemps, na.rm=TRUE),\n            median_bill_new = median(bill_noexemps),\n            mean_change = mean(bill_change, na.rm=TRUE),\n            median_change = median(bill_change),\n            perceived_savings = median(tax_amt_exe),\n            cur_comp_TC_rate = mean(cur_comp_TC_rate),\n            new_comp_TC_rate = mean(new_comp_TC_rate),\n            pincount=n()\n)\npin_data2 %&gt;% \nfilter(pin_AV &gt; 0) %&gt;% \n  filter(agency_name %in% c(\"VILLAGE OF PARK FOREST\", \"VILLAGE OF PHOENIX\", \"VILLAGE OF WINNETKA\",\"VILLAGE OF RIVERDALE\")) %&gt;%\n  filter(class &gt;199 & class &lt; 300) %&gt;% \n  arrange(av) %&gt;%\n # group_by(agency_name, has_HO_exemp) %&gt;% \n  mutate(#taxable_eav = final_tax_to_dist / tax_code_rate,\n    # current bill = current tax rate * portion of levy billed\n         bill_current = (final_tax_to_dist + final_tax_to_tif),\n         bill_noexemps =  new_comp_TC_rate/100*(equalized_AV-all_exemptions+exe_homeowner),\n         bill_change = bill_noexemps - bill_current) %&gt;%\n  group_by(agency_name) %&gt;% \n  summarize(median_AV = median(av),\n            median_EAV = median(eav),\n            mean_bill_cur = mean(bill_current, na.rm=TRUE),\n            median_bill_cur = median(bill_current),\n            mean_bill_new = mean(bill_noexemps, na.rm=TRUE),\n            median_bill_new = median(bill_noexemps),\n            mean_change = mean(bill_change, na.rm=TRUE),\n            median_change = median(bill_change),\n            perceived_savings = median(tax_amt_exe),\n            cur_comp_TC_rate = mean(cur_comp_TC_rate),\n            new_comp_TC_rate = mean(new_comp_TC_rate),\n            pincount=n()\n)\n\n\n\n?(caption)"
  },
  {
    "objectID": "GHE_Scenarios.html#changing-general-homeowner-exemption---scenarios",
    "href": "GHE_Scenarios.html#changing-general-homeowner-exemption---scenarios",
    "title": "3  Exemption Progressivity & GHE Scenarios",
    "section": "3.1 Changing General Homeowner Exemption - Scenarios",
    "text": "3.1 Changing General Homeowner Exemption - Scenarios\nCreate a PIN input with modified exemption amounts, then recalculate the base by taking the difference between the real and hypothetical exemptions.\nThen recalculate the tax base for each district. If increasing the exemption, the base should decrease because there is less taxable EAV.\n\n\n3.1.1 Quartiles and Progressivity\n\n\nCode\nclass_dict &lt;- read_csv(\"../Necessary_Files/class_dict_singlefamcodes.csv\") %&gt;% \n  mutate(class_code = as.character(class_code)) # change variable type to character so the join works.\n\nnicknames &lt;- readxl::read_xlsx(\"../Necessary_Files/muni_shortnames.xlsx\")\n\n#pin_data2 &lt;- read_csv(\"../Output/4C_joined_PINs_bills_and_exemptions.csv\")\n\nmuni_taxrates &lt;- read_csv(\"../Output/4C_muni_taxrates.csv\")\n\n#pin_data2 &lt;- pin_data2 %&gt;% left_join(class_dict)\n\nmuni_TC_fullyCook &lt;- muni_tax_codes %&gt;%\n  filter(!agency_num %in% cross_county_lines)\n\n\njoined_pins &lt;- read_csv(\"../Output/4C_joined_PINs_bills_and_exemptions.csv\") %&gt;%\n  mutate(tax_code_num = as.character(tax_code_num)) %&gt;%  \n  left_join(tc_muninames) %&gt;% left_join(class_dict)\n\n# all pins in munis fully within cook county that are some form of single-family, detached home\nsingfam_pins &lt;- joined_pins %&gt;% \n  filter(tax_code %in% muni_TC_fullyCook$tax_code_num) %&gt;% # excludes county line crossing munis\n  filter(Option2 == \"Single-Family\")\n\n\n\n\n3.1.2 Cook County Quartiles\nCook County quartiles are calculated fromg single family properties assessed value in 2021.\n\n\nCode\nq = c(.25, .5, .75)\n\n\ncook_quartiles &lt;- singfam_pins %&gt;%\n  filter(Option2 == \"Single-Family\") %&gt;%\n  filter(tax_code %in% muni_TC_fullyCook$tax_code_num) %&gt;% # excludes county line crossing munis\n  arrange(av) %&gt;%\n  summarize(count_pins = n(), \n            min = min(av),\n            quant25 = round(quantile(av, probs = q[1])), \n            quant50 = round(quantile(av, probs = q[2])),\n            quant75 = round(quantile(av, probs = q[3])),\n            max = max(av))\ncook_quartiles\n\n\n\n\n  \n\n\n\n\n\n3.1.3 Scenarios & tax rates\nSimilar to File 5_Exemption_Scenarios.rmd.\n\nCalculate Class 2 Burden –&gt; Calculate the amount of taxable EAV in the Municipality (for each scenario) and multiply it by the new composite tax rate (for each scenario).\nBurden Share = Taxable EAV within Property Class * Composite tax rate\nComposite Tax Rate = (Municipal Levy / Taxable EAV )\n\n\n\nCode\n## Bring in tax bills and exemption data for 2021 PINs ##\n# \n# joined_pins &lt;- read_csv(\"../Output/4C_joined_PINs_bills_and_exemptions.csv\") %&gt;%\n#   mutate(tax_code_num = as.character(tax_code_num)) %&gt;%  \n#   left_join(tc_muninames) %&gt;% left_join(class_dict)\n\nMuniLevy &lt;- joined_pins %&gt;% \n  group_by(clean_name, agency_num) %&gt;%\n  \n  summarize(MuniLevy = sum(final_tax_to_dist, na.rm = TRUE), # amount billed by munis with current exemptions in place\n            current_nonTIF_EAV_post_exemps = sum(final_tax_to_dist/(tax_code_rate/100), na.rm = TRUE),\n            current_TIF_increment_EAV = sum(final_tax_to_tif/(tax_code_rate/100), na.rm=TRUE),  \n            current_Exempt_EAV = sum(tax_amt_exe/(tax_code_rate/100), na.rm=TRUE), \n            Total_EAV = sum((tax_amt_exe+final_tax_to_dist+final_tax_to_tif)/(tax_code_rate/100), na.rm = TRUE)) %&gt;% \n  mutate(cur_muni_comp_rate = MuniLevy / current_nonTIF_EAV_post_exemps)\n\nMuniLevy\n\n\n\n\n  \n\n\n\n\n\nCode\njoined_pins &lt;- joined_pins %&gt;% \n  mutate(exe_neg10 = 0,\n         exe_0 = ifelse(eav &lt; 10000 & exe_homeowner!=0, eav, \n                             ifelse(eav&gt;10000 & exe_homeowner!=0, 10000, 0 )),  #would be if there is no change in exemptions\n         exe_plus10 = ifelse(eav &lt; 20000 & exe_homeowner!=0, eav, \n                             ifelse(eav&gt;20000 & exe_homeowner!=0, 20000, 0 )),\n         exe_plus20 = ifelse(eav &lt; 30000 & exe_homeowner!=0, eav, \n                             ifelse(eav&gt;30000 & exe_homeowner!=0, 30000, 0 ) ),\n         exe_plus30 = ifelse(eav &lt; 40000 & exe_homeowner!=0, eav, \n                             ifelse(eav&gt;40000 & exe_homeowner!=0, 40000, 0) ),\n         exe_plus40 = ifelse(eav &lt; 50000 & exe_homeowner!=0, eav, \n                             ifelse(eav&gt;50000 & exe_homeowner!=0, 50000, 0) ) )\n\nscenario_calcs &lt;- joined_pins %&gt;%    \n  group_by(clean_name) %&gt;%\n\n    summarize(MuniLevy = sum(final_tax_to_dist, na.rm = TRUE), # amount billed by munis with current exemptions in place\n            current_nonTIF_EAV_post_exemps = sum(final_tax_to_dist/(tax_code_rate/100), na.rm = TRUE),\n            current_TIF_increment_EAV = sum(final_tax_to_tif/(tax_code_rate/100), na.rm=TRUE),  \n            current_Exempt_EAV = sum(tax_amt_exe/(tax_code_rate/100), na.rm=TRUE), \n            current_GHE = sum(exe_homeowner, na.rm=TRUE),\n            Total_EAV = sum((tax_amt_exe+final_tax_to_dist+final_tax_to_tif)/(tax_code_rate/100), na.rm = TRUE),\n            exe_neg10 = sum(exe_neg10),\n            exe_0 = sum(exe_0), # no change, for comparison\n            exe_plus10 = sum(exe_plus10),\n            exe_plus20 = sum(exe_plus20),\n            exe_plus30 = sum(exe_plus30),\n            exe_plus40 = sum(exe_plus40)) %&gt;%\n\n  # remove all GHE (up to 10,000 EAV added back to base per PIN), \n  # add exe_homeowner back to taxable base\n  mutate(neg10_taxable_eav = Total_EAV - current_TIF_increment_EAV - current_Exempt_EAV + current_GHE,    # adds GHE exempt EAV back to taxable base and decreases tax rates\n         plus10_taxable_eav = Total_EAV - current_TIF_increment_EAV - current_Exempt_EAV + current_GHE - exe_plus10, # will increase tax rates\n         plus20_taxable_eav = Total_EAV - current_TIF_increment_EAV - current_Exempt_EAV + current_GHE - exe_plus20,\n         plus30_taxable_eav = Total_EAV - current_TIF_increment_EAV - current_Exempt_EAV + current_GHE - exe_plus30,\n         plus40_taxable_eav = Total_EAV - current_TIF_increment_EAV - current_Exempt_EAV + current_GHE - exe_plus40,\n         scenario_noexemptions_taxable_eav = Total_EAV - current_TIF_increment_EAV) %&gt;%\n  \n  mutate(tr_neg10 = MuniLevy / neg10_taxable_eav,\n         tr_nochange = MuniLevy / current_nonTIF_EAV_post_exemps,\n         tr_plus10 = MuniLevy / plus10_taxable_eav,\n         tr_plus20 = MuniLevy / plus20_taxable_eav,\n         tr_plus30 = MuniLevy / plus30_taxable_eav,\n         tr_plus40 = MuniLevy / plus40_taxable_eav, \n         tax_rate_current = MuniLevy/current_nonTIF_EAV_post_exemps,\n         taxrate_noexemps = MuniLevy /(Total_EAV - current_TIF_increment_EAV  ),\n         taxrate_noTIFs = MuniLevy / (Total_EAV - current_Exempt_EAV),\n         taxrate_noTIFs_orExemps = MuniLevy / Total_EAV) %&gt;%\n  select(clean_name, MuniLevy, tr_neg10:taxrate_noTIFs_orExemps, everything())\n\nwrite_csv(scenario_calcs, \"../Output/5b_scenario_calcs.csv\")\n\n\nscenario_taxrates &lt;- scenario_calcs %&gt;%  select(clean_name, MuniLevy, tr_neg10:taxrate_noTIFs_orExemps) \n\nscenario_taxrates\n\n\n\n\n  \n\n\n\n\n3.1.3.1 Class 2 Burden Shift\n\n\nCode\nC2_taxableEAV &lt;- joined_pins %&gt;%   \n  filter(class &gt;= 200 & class &lt;= 300) %&gt;% \n  #left_join(scenario_taxrates, by = c(\"tax_code\" = \"tax_code_num\")) %&gt;%\n  group_by(clean_name) %&gt;%\n\n    summarize(\n      C2_av = sum(av),\n      C2_eav_original = sum(equalized_AV), \n      C2_DistrictRev = sum(final_tax_to_dist, na.rm=TRUE),\n      C2_current_nonTIF_EAV_post_exemps = sum(final_tax_to_dist/(tax_code_rate/100), na.rm = TRUE),\n      C2_current_TIF_increment_EAV = sum(final_tax_to_tif/(tax_code_rate/100), na.rm=TRUE),  \n      C2_current_Exempt_EAV = sum(tax_amt_exe/(tax_code_rate/100), na.rm=TRUE), \n      C2_current_GHE = sum(exe_homeowner, na.rm=TRUE),\n      C2_Total_EAV = sum((tax_amt_exe+final_tax_to_dist+final_tax_to_tif)/(tax_code_rate/100), na.rm = TRUE),\n      C2_exe_neg10 = sum(exe_neg10),\n      C2_exe_0 = sum(exe_0), # no change, for comparison\n      C2_exe_plus10 = sum(exe_plus10),\n      C2_exe_plus20 = sum(exe_plus20),\n      C2_exe_plus30 = sum(exe_plus30),\n      C2_exe_plus40 = sum(exe_plus40),\n      C2_PC_permuni = n())  %&gt;% \n  left_join(MuniLevy, by = \"clean_name\") %&gt;%\n  mutate(C2_EAV_pct = C2_eav_original / Total_EAV)\n\n\n\nC2_burden_shift &lt;- C2_taxableEAV %&gt;%\n  left_join(scenario_taxrates) %&gt;%\n  mutate(C2_neg10_taxableEAV = C2_Total_EAV - C2_current_TIF_increment_EAV - C2_current_Exempt_EAV + C2_current_GHE - C2_exe_neg10,\n         C2_nochange = C2_Total_EAV - C2_current_TIF_increment_EAV - C2_current_Exempt_EAV,\n         C2_plus10_taxableEAV = C2_Total_EAV - C2_current_TIF_increment_EAV - C2_current_Exempt_EAV + C2_current_GHE - C2_exe_plus10,\n         C2_plus20_taxableEAV = C2_Total_EAV - C2_current_TIF_increment_EAV - C2_current_Exempt_EAV + C2_current_GHE - C2_exe_plus20,\n        C2_plus30_taxableEAV = C2_Total_EAV - C2_current_TIF_increment_EAV - C2_current_Exempt_EAV + C2_current_GHE - C2_exe_plus30,\n        C2_plus40_taxableEAV = C2_Total_EAV - C2_current_TIF_increment_EAV - C2_current_Exempt_EAV + C2_current_GHE - C2_exe_plus40\n         ) %&gt;%\n  mutate(burden_C2_neg10 = (C2_neg10_taxableEAV * tr_neg10)/ MuniLevy,\n         burden_C2_nochange = C2_nochange * tax_rate_current  / MuniLevy,\n         burden_C2_plus10 = (C2_plus10_taxableEAV * tr_plus10) / MuniLevy,\n         burden_C2_plus20 = C2_plus20_taxableEAV * tr_plus20/ MuniLevy,\n         burden_C2_plus30 = C2_plus30_taxableEAV * tr_plus30/ MuniLevy,\n         burden_C2_plus40 = C2_plus40_taxableEAV * tr_plus40/ MuniLevy,\n         \n        burden_C2_noexemps = ( (C2_Total_EAV - C2_current_TIF_increment_EAV)*taxrate_noexemps ) / MuniLevy) %&gt;%\n  select(clean_name, C2_EAV_pct, burden_C2_neg10:burden_C2_plus40, everything())\n\nC2_burden_shift\n\n\n\n\n  \n\n\n\nCode\nwrite_csv(C2_burden_shift, \"../Output/5b_Class2_burdenshift.csv\")\n\n\n\n\n3.1.3.2 Scenario Tax rate graphs\n\n\nCode\nscenarios_long &lt;- scenario_taxrates  %&gt;% \n  select(clean_name, MuniLevy, tr_neg10:taxrate_noTIFs_orExemps) %&gt;%\n  pivot_longer(cols = c(tr_neg10:taxrate_noTIFs_orExemps), names_to = \"GHE_Amount\")\n\n\nscenario_taxrates %&gt;% \n  select(clean_name, MuniLevy, tr_neg10:taxrate_noTIFs_orExemps) %&gt;%\n  pivot_longer(cols = c(tr_neg10:taxrate_noTIFs_orExemps), names_to = \"GHE_Amount\") %&gt;%\n  ggplot() + \n  geom_col(aes(x=value, y = GHE_Amount))\n\n\n\n\n\nCode\nscenario_taxrates %&gt;% \n  filter(clean_name %in% c(\"Chicago\", \"Dolton\", \"Glencoe\")) %&gt;%\n  select(clean_name, MuniLevy, tr_neg10:taxrate_noTIFs_orExemps) %&gt;%\n  pivot_longer(cols = c(tr_neg10:taxrate_noTIFs_orExemps), names_to = \"GHE_Amount\") %&gt;%\n  ggplot() + \n  geom_col(aes(x=value, y = GHE_Amount, fill = clean_name), position = \"dodge\")  + \n  labs(x = \"Municipality Composite Tax Rate\", y = \"Exemption Scenarios\")"
  },
  {
    "objectID": "GHE_Scenarios.html#ranked-properties-and-muni-quartiles",
    "href": "GHE_Scenarios.html#ranked-properties-and-muni-quartiles",
    "title": "3  Exemption Progressivity & GHE Scenarios",
    "section": "3.2 Ranked Properties and Muni Quartiles",
    "text": "3.2 Ranked Properties and Muni Quartiles\n\n\nCode\nq = c(.25, .5, .75)\n\n## ranks properties that are considered single family homes in order of AV for each Muni\nmuni_quartiles &lt;- joined_pins %&gt;%\n  filter(Option2 == \"Single-Family\") %&gt;% \n  filter(tax_code %in% muni_TC_fullyCook$tax_code_num) %&gt;%\n  group_by(agency_name, clean_name) %&gt;%\n  arrange(av) %&gt;%\n  summarize(count_pins = n(), \n            min = min(av),\n            quant25 = round(quantile(av, probs = q[1])), \n            quant50 = round(quantile(av, probs = q[2])),\n            quant75 = round(quantile(av, probs = q[3])),\n            max = max(av)\n           ) %&gt;% \n  arrange( desc( quant50))\nmuni_quartiles\n\n\n\n\n  \n\n\n\n\n\nCode\n## create rank variable for properties that fall within the quartiles +/- $500 range\nmunis_ranked &lt;- joined_pins  %&gt;%\n  inner_join(muni_quartiles, by = c(\"agency_name\", \"clean_name\")) %&gt;% \n  mutate(rank = case_when(\n    av &gt; (quant25-500) & (av&lt;quant25+500) ~ \"q25\",\n    av &gt; (quant50-500) & (av&lt;quant50+500) ~ \"q50\",\n    av &gt; (quant75-500) & (av&lt;quant75+500) ~ \"q75\")\n    ) %&gt;%\n  select(clean_name, rank, av, pin, class, everything()) %&gt;%\n  left_join(nicknames)\n\n\n\n\nmunis_billchange &lt;-  munis_ranked %&gt;% \n  group_by(clean_name, rank) %&gt;%\n  left_join(scenario_taxrates) %&gt;%\n  arrange(av) %&gt;%\n # group_by(agency_name, has_HO_exemp) %&gt;% \n  mutate(#taxable_eav = final_tax_to_dist / tax_code_rate,\n    # current bill = current tax rate * portion of levy billed\n    \n    \n   # ## Made negative tax bills!! ## #\n         \n         bill_neg10 = tr_neg10*(equalized_AV-all_exemptions+ exe_homeowner -exe_neg10),\n\n         bill_current = cur_comp_TC_rate/100*(equalized_AV-all_exemptions),\n         bill_plus10 =  tr_plus10*(equalized_AV-all_exemptions+ exe_homeowner -exe_plus10),\n         bill_plus20 = tr_plus20*(equalized_AV-all_exemptions+ exe_homeowner -exe_plus20),\n         bill_plus30 = tr_plus20*(equalized_AV-all_exemptions+ exe_homeowner -exe_plus30),\n         bill_plus40 = tr_plus20*(equalized_AV-all_exemptions+ exe_homeowner -exe_plus40),\n    \n    # ## make bills $1 if they had been negative.    \n         bill_neg10 = ifelse(bill_neg10 &lt; 1, 1, bill_neg10),\n         bill_current = ifelse(bill_current &lt; 1, 1, bill_current),\n         bill_plus10 = ifelse(bill_plus10 &lt; 1, 1, bill_plus10),\n         bill_plus20 = ifelse(bill_plus20 &lt; 1, 1, bill_plus20),\n         bill_plus30 = ifelse(bill_plus30 &lt; 1, 1, bill_plus30),\n         bill_plus40 = ifelse(bill_plus40 &lt; 1, 1, bill_plus40),\n         \n## Prevent tax bills from having negative values  (if exemptions &gt; eav of home)\n         # bill_neg10 = ifelse(tr_neg10*(equalized_AV-all_exemptions+ exe_homeowner -exe_neg10) &gt; 1,\n         #                              tr_neg10*(equalized_AV-all_exemptions+ exe_homeowner -exe_neg10), 1),\n         # \n         # bill_current = ifelse(cur_comp_TC_rate/100*(equalized_AV-all_exemptions) &gt; 1,\n         #                       cur_comp_TC_rate/100*(equalized_AV-all_exemptions), 1),\n         # \n         # bill_plus10 =  ifelse(tr_plus10*(equalized_AV-all_exemptions+ exe_homeowner -exe_plus10) &gt; 1,\n         #                       tr_plus10*(equalized_AV-all_exemptions+ exe_homeowner -exe_plus10),1),\n         # \n         # bill_plus20 = ifelse(tr_plus20*(equalized_AV-all_exemptions+ exe_homeowner -exe_plus20) &gt; 1,\n         #                      tr_plus20*(equalized_AV-all_exemptions+ exe_homeowner -exe_plus20), 1),\n         # \n         # bill_plus30 = ifelse(tr_plus30*(equalized_AV-all_exemptions+ exe_homeowner -exe_plus30) &gt;1, \n         #                      tr_plus30*(equalized_AV-all_exemptions+ exe_homeowner -exe_plus30), 1),\n         #                      \n         #                      \n         # bill_plus40 = ifelse(tr_plus40*(equalized_AV-all_exemptions+ exe_homeowner -exe_plus40) &gt; 1,\n         #                      tr_plus40*(equalized_AV-all_exemptions+ exe_homeowner -exe_plus40), 1)\n         )%&gt;%\n  mutate(\n         zerodol_bills_ghe0 = ifelse(bill_neg10 &lt; 5, 1, 0),\n         zerodol_bills_current = ifelse(bill_current &lt; 5, 1, 0),\n         zerodol_bills_ghe20 = ifelse(bill_plus10 &lt; 5, 1, 0),\n         zerodol_bills_ghe30 = ifelse(bill_plus20 &lt; 5, 1, 0),\n         zerodol_bills_ghe40 = ifelse(bill_plus30 &lt; 5, 1, 0),\n         zerodol_bills_ghe50 = ifelse(bill_plus40 &lt; 5, 1, 0),\n  ) %&gt;%\n  group_by(clean_name, rank, has_HO_exemp) %&gt;% \n  summarize(median_AV = round(median(av)),\n            median_EAV = round(median(eav)),\n            mean_bill_neg10 = round(mean(bill_neg10, na.rm=TRUE)),\n            mean_bill_cur = round(mean(bill_current, na.rm=TRUE)),\n            mean_bill_plus10 = round(mean(bill_plus10, na.rm=TRUE)),\n            mean_bill_plus20 = round(mean(bill_plus20, na.rm=TRUE)),\n            mean_bill_plus30 = round(mean(bill_plus30, na.rm=TRUE)),\n            mean_bill_plus40 = round(mean(bill_plus40, na.rm=TRUE)),\n            \n            # current perceived_savings = median(tax_amt_exe),\n            tr_neg10 = round(mean(tr_neg10*100), digits = 2), \n            cur_comp_TC_rate = round(mean(cur_comp_TC_rate), digits = 2),\n            tr_plus10 = round(mean(tr_plus10*100), digits = 2),\n            tr_plus20 = round(mean(tr_plus20*100), digits = 2),\n            tr_plus30 = round(mean(tr_plus30*100), digits = 2),\n            tr_plus40 = round(mean(tr_plus40*100), digits = 2),\n            pincount=n(),\n            zerodol_bills_ghe0 = sum(zerodol_bills_ghe0),           \n            zerodol_bills_current = sum(zerodol_bills_current),\n            zerodol_bills_ghe20 = sum(zerodol_bills_ghe20),\n            zerodol_bills_ghe30 = sum(zerodol_bills_ghe30),\n            zerodol_bills_ghe40 = sum(zerodol_bills_ghe40),\n            zerodol_bills_ghe50 = sum(zerodol_bills_ghe50),\n\n\n  ) %&gt;%\n  mutate(clean_name = ifelse(clean_name == \"Hazelcrest\", \"Hazel Crest\", clean_name)) %&gt;%\n  arrange(has_HO_exemp, rank)\n\n\nmunis_billchange &lt;- munis_billchange %&gt;% left_join(muni_quartiles)\nmunis_billchange\n\n\n\n\n  \n\n\n\nCode\n#write_csv(munis_billchange, \"../Output/5b_muni_billchange_scenarios.csv\")\n\n\n\n3.2.1 Case Studies in Red - 25 v 75 Percentile Homes\n\n\nCode\nratios&lt;- munis_billchange %&gt;% \n  filter(has_HO_exemp == 1 &  !is.na(rank)) %&gt;% # claimed exemption in 2021\n  mutate(currbill_to_AV_25 = ifelse(rank == \"q25\", mean_bill_cur/median_AV, NA)) %&gt;%\n  mutate(currbill_to_AV_75 = ifelse(rank == \"q75\", mean_bill_cur/median_AV, NA)) %&gt;% \n  group_by(clean_name) %&gt;%\n  summarize(currbill_to_AV_25 = max(currbill_to_AV_25, na.rm=TRUE),\n            currbill_to_AV_75 = max(currbill_to_AV_75, na.rm=TRUE)) %&gt;%\n  mutate(muni_ratio_25to75 = currbill_to_AV_25/currbill_to_AV_75) %&gt;% filter(muni_ratio_25to75 &gt; 0.01)\n\n\n\nggplot(data = ratios, aes(y = currbill_to_AV_25, x = currbill_to_AV_75, label = clean_name)) + \n  geom_abline(intercept = 0, slope = 1) +\n  geom_point(data = ratios, aes(alpha = .5)) + \n  ggrepel::geom_label_repel(data = (ratios %&gt;% filter(clean_name %in% c(\"Park Forest\", \"Chicago\", \"Winnetka\", \"Glencoe\", \"Riverdale\", \"Dolton\", \"Markham\", \"Chicago Heights\", \"Hazel Crest\", \"Phoenix\"))), aes(y = currbill_to_AV_25, x = currbill_to_AV_75), size = 2, max.overlaps = Inf, point.padding = 0, # additional padding around each point\n    min.segment.length = 0, # draw all line segments\n    )+\n    geom_point(data = (ratios %&gt;% filter(clean_name %in% c(\"Park Forest\", \"Chicago\", \"Winnetka\", \"Glencoe\", \"Riverdale\", \"Dolton\", \"Markham\", \"Chicago Heights\", \"Hazel Crest\", \"Phoenix\"))), aes(y = currbill_to_AV_25, x = currbill_to_AV_75, color = \"red\"), size = 2)+\n\n  theme_classic() +\n    scale_y_continuous(limits = c(0, .6), expand = c(0,0))+\n   scale_x_continuous(limits = c(0, .6), expand = c(0,0))+\n  theme(legend.position = \"none\") +\n  labs(title=\"25th & 75th Percentile AV Properties (Class 2 Only): Ratio of Tax Bill to AV\", y=\"25th Percentile AV\", x=\"75th Percentile AV\", subtitle = \"GHE = $10,000 EAV\")\n\n\n\n\nFigure 3.1: Current GHE Amount (up to 10,000 EAV exempt per property)\n\n\n\n\n\n\n\nCode\nratios&lt;- munis_billchange %&gt;% \n  filter(has_HO_exemp == 1 &  !is.na(rank)) %&gt;% # claimed exemption in 2021\n  mutate(currbill_to_AV_25 = ifelse(rank == \"q25\", mean_bill_neg10/median_AV, NA)) %&gt;%\n  mutate(currbill_to_AV_75 = ifelse(rank == \"q75\", mean_bill_neg10/median_AV, NA)) %&gt;% \n  group_by(clean_name) %&gt;%\n  summarize(GHE_0_bill_to_AV_25 = max(currbill_to_AV_25, na.rm=TRUE),\n            GHE_0_bill_to_AV_75 = max(currbill_to_AV_75, na.rm=TRUE)) %&gt;%\n  mutate(muni_ratio_25to75 = GHE_0_bill_to_AV_25/GHE_0_bill_to_AV_75) \n\n\nggplot(data = ratios, aes(y = GHE_0_bill_to_AV_25, x = GHE_0_bill_to_AV_75, label = clean_name)) + \n  geom_abline(intercept = 0, slope = 1) +\n  geom_point(aes(alpha = .5)) + \n    ggrepel::geom_label_repel(data = (ratios %&gt;% filter(clean_name %in% c(\"Park Forest\", \"Chicago\", \"Winnetka\", \"Glencoe\", \"Riverdale\", \"Dolton\", \"Markham\", \"Chicago Heights\", \"Hazel Crest\", \"Phoenix\"))), aes(y = GHE_0_bill_to_AV_25, x = GHE_0_bill_to_AV_75 + 0.1, label = clean_name, size = 2))+\n    geom_point(data = (ratios %&gt;% filter(clean_name %in% c(\"Park Forest\", \"Chicago\", \"Winnetka\", \"Glencoe\", \"Riverdale\", \"Dolton\", \"Markham\", \"Chicago Heights\", \"Hazel Crest\", \"Phoenix\"))), aes(y = GHE_0_bill_to_AV_25, x = GHE_0_bill_to_AV_75, color = \"red\"), size = 3)+\n  theme_classic() + \n    scale_y_continuous(limits = c(0, .6), expand = c(0,0))+\n  scale_x_continuous(limits = c(0, .6), expand = c(0,0))+\n  theme(legend.position = \"none\") +\n  labs(title = \"GHE = 0 EAV\", x = \"\", y = \"\")\nratios&lt;- munis_billchange %&gt;% \n  filter(has_HO_exemp == 1 &  !is.na(rank)) %&gt;% # claimed exemption in 2021\n  mutate(currbill_to_AV_25 = ifelse(rank == \"q25\", mean_bill_cur/median_AV, NA)) %&gt;%\n  mutate(currbill_to_AV_75 = ifelse(rank == \"q75\", mean_bill_cur/median_AV, NA)) %&gt;% \n  group_by(clean_name) %&gt;%\n  summarize(currbill_to_AV_25 = max(currbill_to_AV_25, na.rm=TRUE),\n            currbill_to_AV_75 = max(currbill_to_AV_75, na.rm=TRUE)) %&gt;%\n  mutate(muni_ratio_25to75 = currbill_to_AV_25/currbill_to_AV_75) %&gt;% filter(muni_ratio_25to75 &gt; 0.01)\n\n\n\nggplot(data = ratios, aes(y = currbill_to_AV_25, x = currbill_to_AV_75, label = clean_name)) + \n  geom_abline(intercept = 0, slope = 1) +\n  geom_point(data = ratios, aes(alpha = .5)) + \n  ggrepel::geom_label_repel(data = (ratios %&gt;% filter(clean_name %in% c(\"Park Forest\", \"Chicago\", \"Winnetka\", \"Glencoe\", \"Riverdale\", \"Dolton\", \"Markham\", \"Chicago Heights\", \"Hazel Crest\", \"Phoenix\"))), aes(y = currbill_to_AV_25, x = currbill_to_AV_75), size = 3, max.overlaps = Inf, point.padding = 0, # additional padding around each point\n    min.segment.length = 0, # draw all line segments\n    )+\n    geom_point(data = (ratios %&gt;% filter(clean_name %in% c(\"Park Forest\", \"Chicago\", \"Winnetka\", \"Glencoe\", \"Riverdale\", \"Dolton\", \"Markham\", \"Chicago Heights\", \"Hazel Crest\", \"Phoenix\"))), aes(y = currbill_to_AV_25, x = currbill_to_AV_75, color = \"red\"), size = 2)+\n\n  theme_classic() +\n    scale_y_continuous(limits = c(0, .6), expand = c(0,0))+\n   scale_x_continuous(limits = c(0, .6), expand = c(0,0))+\n  theme(legend.position = \"none\") +\n  labs(title = \"Current GHE Amount (up to 10,000 EAV exempt per property)\", x=\"\", y=\"\")\nnew_ratios&lt;- munis_billchange %&gt;% \n  filter(has_HO_exemp == 1 &  !is.na(rank)) %&gt;% # claimed exemption in 2021\n  mutate(newbill_to_AV_25 = ifelse(rank == \"q25\", mean_bill_plus10/median_AV, NA)) %&gt;%\n  mutate(newbill_to_AV_75 = ifelse(rank == \"q75\", mean_bill_plus10/median_AV, NA)) %&gt;% \n  group_by(clean_name) %&gt;%\n  summarize(newbill_to_AV_25 = max(newbill_to_AV_25, na.rm=TRUE),\n            newbill_to_AV_75 = max(newbill_to_AV_75, na.rm=TRUE)) %&gt;%\n  mutate(muni_ratio_25to75 = newbill_to_AV_25/newbill_to_AV_75) %&gt;% filter(muni_ratio_25to75 &gt; 0.01)\n\n\nggplot(data = new_ratios, aes(y = newbill_to_AV_25, x = newbill_to_AV_75, label = clean_name)) + \n  geom_abline(intercept = 0, slope = 1) +\n  geom_point(data = new_ratios, aes(alpha = .5)) + \n  ggrepel::geom_label_repel(data = (new_ratios %&gt;% filter(clean_name %in% c(\"Park Forest\", \"Chicago\", \"Winnetka\", \"Glencoe\", \"Riverdale\", \"Dolton\", \"Markham\", \"Chicago Heights\", \"Hazel Crest\", \"Phoenix\"))), aes(y = newbill_to_AV_25, x = newbill_to_AV_75), size = 2, max.overlaps = Inf, point.padding = 0, # additional padding around each point\n    min.segment.length = 0, # draw all line segments\n    )+\n    geom_point(data = (new_ratios %&gt;% filter(clean_name %in% c(\"Park Forest\", \"Chicago\", \"Winnetka\", \"Glencoe\", \"Riverdale\", \"Dolton\", \"Markham\", \"Chicago Heights\", \"Hazel Crest\", \"Phoenix\"))), aes(y = newbill_to_AV_25, x = newbill_to_AV_75, color = \"red\"), size = 2)+\n  theme_classic() + \n  scale_y_continuous(limits = c(0, .6), expand = c(0,0))+\n  scale_x_continuous(limits = c(0, .6), expand = c(0,0))+\n  theme(legend.position = \"none\") + \n  labs(title = \"Increase GHE by 10,000 EAV (for up to 20,000 EAV exempt)\", x= \"\", y=\"\")\nnew_ratios&lt;- munis_billchange %&gt;% \n  filter(has_HO_exemp == 1 &  !is.na(rank)) %&gt;% # claimed exemption in 2021\n  mutate(newbill_to_AV_25 = ifelse(rank == \"q25\", mean_bill_plus20/median_AV, NA)) %&gt;%\n  mutate(newbill_to_AV_75 = ifelse(rank == \"q75\", mean_bill_plus20/median_AV, NA)) %&gt;% \n  group_by(clean_name) %&gt;%\n  summarize(newbill_to_AV_25 = max(newbill_to_AV_25, na.rm=TRUE),\n            newbill_to_AV_75 = max(newbill_to_AV_75, na.rm=TRUE)) %&gt;%\n  mutate(muni_ratio_25to75 = newbill_to_AV_25/newbill_to_AV_75) %&gt;% filter(muni_ratio_25to75 &gt; 0.01)\n\n\nggplot(data = new_ratios, aes(y = newbill_to_AV_25, x = newbill_to_AV_75, label = clean_name)) + \n  geom_abline(intercept = 0, slope = 1) +\n  geom_point(aes(alpha = .5)) + \n  ggrepel::geom_label_repel(data = (new_ratios %&gt;% filter(clean_name %in% c(\"Park Forest\", \"Chicago\", \"Winnetka\", \"Glencoe\", \"Riverdale\", \"Dolton\", \"Markham\", \"Chicago Heights\", \"Hazel Crest\", \"Phoenix\"))), aes(y = newbill_to_AV_25, x = newbill_to_AV_75), size = 2, max.overlaps = Inf, point.padding = 0, # additional padding around each point\n    min.segment.length = 0, # draw all line segments\n    )+\n    geom_point(data = (new_ratios %&gt;% filter(clean_name %in% c(\"Park Forest\", \"Chicago\", \"Winnetka\", \"Glencoe\", \"Riverdale\", \"Dolton\", \"Markham\", \"Chicago Heights\", \"Hazel Crest\", \"Phoenix\"))), aes(y = newbill_to_AV_25, x = newbill_to_AV_75, color = \"red\"), size = 2)+\n  theme_classic() + \n    scale_y_continuous(limits = c(0, .6), expand = c(0,0))+\n\n  scale_x_continuous(limits = c(0, .6), expand = c(0,0))+\n  theme(legend.position = \"none\") + \n  labs(title = \"Increase GHE by 20,000 EAV (for up to 30,000 EAV exempt)\",\n                                        x = \"\", y = \"\")\nnew_ratios&lt;- munis_billchange %&gt;% \n  filter(has_HO_exemp == 1 &  !is.na(rank)) %&gt;% # claimed exemption in 2021\n  mutate(newbill_to_AV_25 = ifelse(rank == \"q25\", mean_bill_plus30/median_AV, NA)) %&gt;%\n  mutate(newbill_to_AV_75 = ifelse(rank == \"q75\", mean_bill_plus30/median_AV, NA)) %&gt;% \n  group_by(clean_name) %&gt;%\n  summarize(newbill_to_AV_25 = max(newbill_to_AV_25, na.rm=TRUE),\n            newbill_to_AV_75 = max(newbill_to_AV_75, na.rm=TRUE)) %&gt;%\n  mutate(muni_ratio_25to75 = newbill_to_AV_25/newbill_to_AV_75) %&gt;% filter(muni_ratio_25to75 &gt; 0.01)\n\n\nggplot(data = new_ratios, aes(y = newbill_to_AV_25, x = newbill_to_AV_75, label = clean_name)) + \n  geom_abline(intercept = 0, slope = 1) +\n  geom_point(aes(alpha = .5)) + \n  ggrepel::geom_label_repel(data = (new_ratios %&gt;% filter(clean_name %in% c(\"Park Forest\", \"Chicago\", \"Winnetka\", \"Glencoe\", \"Riverdale\", \"Dolton\", \"Markham\", \"Chicago Heights\", \"Hazel Crest\", \"Phoenix\"))), aes(y = newbill_to_AV_25, x = newbill_to_AV_75), size = 2, max.overlaps = Inf, point.padding = 0, # additional padding around each point\n    min.segment.length = 0, # draw all line segments\n    )+\n    geom_point(data = (new_ratios %&gt;% filter(clean_name %in% c(\"Park Forest\", \"Chicago\", \"Winnetka\", \"Glencoe\", \"Riverdale\", \"Dolton\", \"Markham\", \"Chicago Heights\", \"Hazel Crest\", \"Phoenix\"))), aes(y = newbill_to_AV_25, x = newbill_to_AV_75, color = \"red\"), size = 2)+\n  theme_classic() + \n    scale_y_continuous(limits = c(0, .6), expand = c(0,0))+\n\n  scale_x_continuous(limits = c(0, .6), expand = c(0,0))+\n  theme(legend.position = \"none\") + \n  labs(title = \"Increase GHE by 30,000 EAV (for up to 40,000 EAV exempt) \", \n                                     x= \"\", y = \"\")\nnew_ratios&lt;- munis_billchange %&gt;% \n  filter(has_HO_exemp == 1 &  !is.na(rank)) %&gt;% # claimed exemption in 2021\n  mutate(newbill_to_AV_25 = ifelse(rank == \"q25\", mean_bill_plus40/median_AV, NA)) %&gt;%\n  mutate(newbill_to_AV_75 = ifelse(rank == \"q75\", mean_bill_plus40/median_AV, NA)) %&gt;% \n  group_by(clean_name) %&gt;%\n  summarize(newbill_to_AV_25 = max(newbill_to_AV_25, na.rm=TRUE),\n            newbill_to_AV_75 = max(newbill_to_AV_75, na.rm=TRUE)) %&gt;%\n  mutate(muni_ratio_25to75 = newbill_to_AV_25/newbill_to_AV_75) %&gt;% filter(muni_ratio_25to75 &gt; 0.01)\n\n\nggplot(data = new_ratios, aes(y = newbill_to_AV_25, x = newbill_to_AV_75, label = clean_name)) + \n  geom_abline(intercept = 0, slope = 1) +\n  geom_point(aes(alpha = .5)) + \n  ggrepel::geom_label_repel(data = (new_ratios %&gt;% filter(clean_name %in% c(\"Park Forest\", \"Chicago\", \"Winnetka\", \"Glencoe\", \"Riverdale\", \"Dolton\", \"Markham\", \"Chicago Heights\", \"Hazel Crest\", \"Phoenix\"))), aes(y = newbill_to_AV_25, x = newbill_to_AV_75), size = 2, max.overlaps = Inf, point.padding = 0, # additional padding around each point\n    min.segment.length = 0, # draw all line segments\n    )+\n    geom_point(data = (new_ratios %&gt;% filter(clean_name %in% c(\"Park Forest\", \"Chicago\", \"Winnetka\", \"Glencoe\", \"Riverdale\", \"Dolton\", \"Markham\", \"Chicago Heights\", \"Hazel Crest\", \"Phoenix\"))), aes(y = newbill_to_AV_25, x = newbill_to_AV_75, color = \"red\"), size = 2)+\n  theme_classic() + \n    scale_y_continuous(limits = c(0, .6), expand = c(0,0))+\n\n  scale_x_continuous(limits = c(0, .6), expand = c(0,0))+\n  theme(legend.position = \"none\") + labs(title = \"Increase GHE by 40,000 EAV (for up to 50,000 EAV exempt) \", \n                                      x = \"\", y = \"\")\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n3.2.2 25 v 75 Percentile Homes\n\n\nCode\nratios&lt;- munis_billchange %&gt;% \n  filter(has_HO_exemp == 1 &  !is.na(rank)) %&gt;% # claimed exemption in 2021\n  mutate(currbill_to_AV_25 = ifelse(rank == \"q25\", mean_bill_neg10/median_AV, NA)) %&gt;%\n  mutate(currbill_to_AV_75 = ifelse(rank == \"q75\", mean_bill_neg10/median_AV, NA)) %&gt;% \n  group_by(clean_name) %&gt;%\n  summarize(GHE_0_bill_to_AV_25 = max(currbill_to_AV_25, na.rm=TRUE),\n            GHE_0_bill_to_AV_75 = max(currbill_to_AV_75, na.rm=TRUE)) %&gt;%\n  mutate(muni_ratio_25to75 = GHE_0_bill_to_AV_25/GHE_0_bill_to_AV_75)\n\n\nggplot(data = ratios, aes(y = GHE_0_bill_to_AV_25, x = GHE_0_bill_to_AV_75, label = clean_name)) + \n  geom_abline(intercept = 0, slope = 1) +\n  geom_point(aes(alpha = .5)) + \n  geom_text(nudge_x = .03, nudge_y=0.01, size = 3, check_overlap = TRUE)+ \n  theme_classic() + \n    scale_y_continuous(limits = c(0, .6))+\n\n  scale_x_continuous(limits = c(0, .6))+\n  theme(legend.position = \"none\") +\n  labs(title = \"Reduced GHE Amount by 10,000 EAV (0 EAV exempt from GHE)\",\n       subtitle = \"Other exemptions still in place\")\nratios&lt;- munis_billchange %&gt;% \n  filter(has_HO_exemp == 1 &  !is.na(rank)) %&gt;% # claimed exemption in 2021\n  mutate(currbill_to_AV_25 = ifelse(rank == \"q25\", mean_bill_cur/median_AV, NA)) %&gt;%\n  mutate(currbill_to_AV_75 = ifelse(rank == \"q75\", mean_bill_cur/median_AV, NA)) %&gt;% \n  group_by(clean_name) %&gt;%\n  summarize(currbill_to_AV_25 = max(currbill_to_AV_25, na.rm=TRUE),\n            currbill_to_AV_75 = max(currbill_to_AV_75, na.rm=TRUE)) %&gt;%\n  mutate(muni_ratio_25to75 = currbill_to_AV_25/currbill_to_AV_75)\n\n\nggplot(data = ratios, aes(y = currbill_to_AV_25, x = currbill_to_AV_75, label = clean_name)) + \n  geom_abline(intercept = 0, slope = 1) +\n  geom_point(data = ratios, aes(alpha = .5)) + \n  geom_point(data = (ratios %&gt;% filter(clean_name %in% c(\"Park Forest\", \"Chicago\", \"Winnetka\", \"Riverdale\",\"Dolton\"))), aes(y = currbill_to_AV_25, x = currbill_to_AV_75, color = \"red\"), size = 3)+\n  ggrepel::geom_text_repel(data = (ratios %&gt;% filter(clean_name %in% c(\"Park Forest\", \"Chicago\", \"Winnetka\", \"Riverdale\", \"Dolton\"))), aes(y = currbill_to_AV_25, x = currbill_to_AV_75, label = clean_name), size = 3)+\n  theme_classic() +\n    scale_y_continuous(limits = c(0, .6))+\n\n\n   scale_x_continuous(limits = c(0, .6))+\n  theme(legend.position = \"none\") +\n  labs(title = \"Current GHE Amount (up to 10,000 EAV exempt per property)\", x=\"\", y=\"\")\nnew_ratios&lt;- munis_billchange %&gt;% \n  filter(has_HO_exemp == 1 &  !is.na(rank)) %&gt;% # claimed exemption in 2021\n  mutate(newbill_to_AV_25 = ifelse(rank == \"q25\", mean_bill_plus10/median_AV, NA)) %&gt;%\n  mutate(newbill_to_AV_75 = ifelse(rank == \"q75\", mean_bill_plus10/median_AV, NA)) %&gt;% \n  group_by(clean_name) %&gt;%\n  summarize(newbill_to_AV_25 = max(newbill_to_AV_25, na.rm=TRUE),\n            newbill_to_AV_75 = max(newbill_to_AV_75, na.rm=TRUE)) %&gt;%\n  mutate(muni_ratio_25to75 = newbill_to_AV_25/newbill_to_AV_75)\n\n\nggplot(data = new_ratios, aes(y = newbill_to_AV_25, x = newbill_to_AV_75, label = clean_name)) + \n  geom_abline(intercept = 0, slope = 1) +\n  geom_point(aes(alpha = .5)) + \n  geom_text(nudge_x = .03, nudge_y=0.01, size = 3, check_overlap = TRUE)+ \n  theme_classic() + \n  scale_y_continuous(limits = c(0, .6))+\n  scale_x_continuous(limits = c(0, .6))+\n  theme(legend.position = \"none\") + \n  labs(title = \"Increase GHE by 10,000 EAV (for up to 20,000 EAV exempt) \", \n                                   y = \"25th percentile of homes, taxbill:AV\",\n                                         x= \"75th percentile of homes, taxbill:AV\",\n                                         caption =  \"Uses single-family properties. Exempt EAV up to 20K per property\")\nnew_ratios&lt;- munis_billchange %&gt;% \n  filter(has_HO_exemp == 1 &  !is.na(rank)) %&gt;% # claimed exemption in 2021\n  mutate(newbill_to_AV_25 = ifelse(rank == \"q25\", mean_bill_plus20/median_AV, NA)) %&gt;%\n  mutate(newbill_to_AV_75 = ifelse(rank == \"q75\", mean_bill_plus20/median_AV, NA)) %&gt;% \n  group_by(clean_name) %&gt;%\n  summarize(newbill_to_AV_25 = max(newbill_to_AV_25, na.rm=TRUE),\n            newbill_to_AV_75 = max(newbill_to_AV_75, na.rm=TRUE)) %&gt;%\n  mutate(muni_ratio_25to75 = newbill_to_AV_25/newbill_to_AV_75)\n\n\nggplot(data = new_ratios, aes(y = newbill_to_AV_25, x = newbill_to_AV_75, label = clean_name)) + \n  geom_abline(intercept = 0, slope = 1) +\n  geom_point(aes(alpha = .5)) + \n  geom_text(nudge_x = .03, nudge_y=0.01, size = 3, check_overlap = TRUE)+ \n  theme_classic() + \n    scale_y_continuous(limits = c(0, .6))+\n\n  scale_x_continuous(limits = c(0, .6), expand = c(0,0))+\n  theme(legend.position = \"none\") + \n  labs(title = \"Increase GHE by 20,000 EAV (for up to 30,000 EAV exempt) \",\n                                         y = \"25th percentile of homes, taxbill:AV\",\n                                         x= \"75th percentile of homes, taxbill:AV\",\n                                         caption =  \"Uses single-family properties. Exempt EAV up to 30K per property\")\nnew_ratios&lt;- munis_billchange %&gt;% \n  filter(has_HO_exemp == 1 &  !is.na(rank)) %&gt;% # claimed exemption in 2021\n  mutate(newbill_to_AV_25 = ifelse(rank == \"q25\", mean_bill_plus30/median_AV, NA)) %&gt;%\n  mutate(newbill_to_AV_75 = ifelse(rank == \"q75\", mean_bill_plus30/median_AV, NA)) %&gt;% \n  group_by(clean_name) %&gt;%\n  summarize(newbill_to_AV_25 = max(newbill_to_AV_25, na.rm=TRUE),\n            newbill_to_AV_75 = max(newbill_to_AV_75, na.rm=TRUE)) %&gt;%\n  mutate(muni_ratio_25to75 = newbill_to_AV_25/newbill_to_AV_75)\n\n\nggplot(data = new_ratios, aes(y = newbill_to_AV_25, x = newbill_to_AV_75, label = clean_name)) + \n  geom_abline(intercept = 0, slope = 1) +\n  geom_point(aes(alpha = .5)) + \n  geom_text(nudge_x = .03, nudge_y=0.01, size = 3, check_overlap = TRUE)+ \n  theme_classic() + \n    scale_y_continuous(limits = c(0, .6))+\n\n  scale_x_continuous(limits = c(0, .6))+\n  theme(legend.position = \"none\") + \n  labs(title = \"Increase GHE by 30,000 EAV (for up to 40,000 EAV exempt) \", \n                                         y = \"25th percentile of homes, taxbill:AV\",\n                                         x= \"75th percentile of homes, taxbill:AV\",\n                                         caption =  \"Uses single-family properties. Exempt EAV up to 40K per property\")\nnew_ratios&lt;- munis_billchange %&gt;% \n  filter(has_HO_exemp == 1 &  !is.na(rank)) %&gt;% # claimed exemption in 2021\n  mutate(newbill_to_AV_25 = ifelse(rank == \"q25\", mean_bill_plus40/median_AV, NA)) %&gt;%\n  mutate(newbill_to_AV_75 = ifelse(rank == \"q75\", mean_bill_plus40/median_AV, NA)) %&gt;% \n  group_by(clean_name) %&gt;%\n  summarize(newbill_to_AV_25 = max(newbill_to_AV_25, na.rm=TRUE),\n            newbill_to_AV_75 = max(newbill_to_AV_75, na.rm=TRUE)) %&gt;%\n  mutate(muni_ratio_25to75 = newbill_to_AV_25/newbill_to_AV_75)\n\n\nggplot(data = new_ratios, aes(y = newbill_to_AV_25, x = newbill_to_AV_75, label = clean_name)) + \n  geom_abline(intercept = 0, slope = 1) +\n  geom_point(aes(alpha = .5)) + \n  geom_text(nudge_x = .03, nudge_y=0.01, size = 3, check_overlap = TRUE)+ \n  theme_classic() + \n    scale_y_continuous(limits = c(0, .6))+\n\n  scale_x_continuous(limits = c(0, .6))+\n  theme(legend.position = \"none\") + labs(title = \"Increase GHE by 40,000 EAV (for up to 50,000 EAV exempt) \", \n                                         y = \"25th percentile of homes, taxbill:AV\",\n                                         x= \"75th percentile of homes, taxbill:AV\",\n                                         caption =  \"Uses single-family properties. Exempt EAV up to 50K per property\")\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n3.2.3 90/10 deciles\n\n\nCode\nq = c(.1, .5, .9)\n\n## ranks properties that are considered single family homes in order of AV for each Muni\nmuni_quartiles &lt;- joined_pins %&gt;%\n  filter(Option2 == \"Single-Family\") %&gt;% \n  filter(tax_code %in% muni_TC_fullyCook$tax_code_num) %&gt;%\n  group_by(agency_name, clean_name) %&gt;%\n  arrange(av) %&gt;%\n  summarize(count_pins = n(), \n            min = min(av),\n            quant10 = round(quantile(av, probs = q[1])), \n            quant50 = round(quantile(av, probs = q[2])),\n            quant90 = round(quantile(av, probs = q[3])),\n            max = max(av)\n           ) %&gt;% \n  arrange( desc( quant50))\nmuni_quartiles\n\n\n\n\n  \n\n\n\n\n\nCode\n## create rank variable for properties that fall within the quartiles +/- $500 range\nmunis_ranked &lt;- joined_pins  %&gt;%\n  inner_join(muni_quartiles, by = c(\"agency_name\", \"clean_name\")) %&gt;% \n  mutate(rank = case_when(\n    av &gt; (quant10-500) & (av&lt;quant10+500) ~ \"q10\",\n    av &gt; (quant50-500) & (av&lt;quant50+500) ~ \"q50\",\n    av &gt; (quant90-500) & (av&lt;quant90+500) ~ \"q90\")\n    ) %&gt;%\n  select(clean_name, rank, av, pin, class, everything()) %&gt;%\n  left_join(nicknames)\n\n\n\n\nmunis_billchange &lt;-  munis_ranked %&gt;% \n  group_by(clean_name, rank) %&gt;%\n  left_join(scenario_taxrates) %&gt;%\n  arrange(av) %&gt;%\n # group_by(agency_name, has_HO_exemp) %&gt;% \n  mutate(#taxable_eav = final_tax_to_dist / tax_code_rate,\n    # current bill = current tax rate * portion of levy billed\n         bill_neg10 = tr_neg10*(equalized_AV-all_exemptions+ exe_homeowner -exe_neg10),\n\n         bill_current = cur_comp_TC_rate/100*(equalized_AV-all_exemptions),\n         bill_plus10 =  tr_plus10*(equalized_AV-all_exemptions+ exe_homeowner -exe_plus10),\n         bill_plus20 = tr_plus20*(equalized_AV-all_exemptions+ exe_homeowner -exe_plus20),\n         bill_plus30 = tr_plus30*(equalized_AV-all_exemptions+ exe_homeowner -exe_plus30),\n         bill_plus40 = tr_plus40*(equalized_AV-all_exemptions+ exe_homeowner -exe_plus40),\n\n    # ## make bills $1 if they had been negative.    \n         bill_neg10 = ifelse(bill_neg10 &lt; 1, 1, bill_neg10),\n         bill_current = ifelse(bill_current &lt; 1, 1, bill_current),\n         bill_plus10 = ifelse(bill_plus10 &lt; 1, 1, bill_plus10),\n         bill_plus20 = ifelse(bill_plus20 &lt; 1, 1, bill_plus20),\n         bill_plus30 = ifelse(bill_plus30 &lt; 1, 1, bill_plus30),\n         bill_plus40 = ifelse(bill_plus40 &lt; 1, 1, bill_plus40)) %&gt;%\n\n  mutate(\n         zerodol_bills_ghe0 = ifelse(bill_neg10 &lt; 5, 1, 0),\n         zerodol_bills_current = ifelse(bill_current &lt; 5, 1, 0),\n         zerodol_bills_ghe20 = ifelse(bill_plus10 &lt; 5, 1, 0),\n         zerodol_bills_ghe30 = ifelse(bill_plus20 &lt; 5, 1, 0),\n         zerodol_bills_ghe40 = ifelse(bill_plus30 &lt; 5, 1, 0),\n         zerodol_bills_ghe50 = ifelse(bill_plus40 &lt; 5, 1, 0),\n  ) %&gt;%\n  group_by(clean_name, rank, has_HO_exemp) %&gt;% \n  summarize(median_AV = round(median(av)),\n            median_EAV = round(median(eav)),\n            mean_bill_neg10 = round(mean(bill_neg10, na.rm=TRUE)),\n            mean_bill_cur = round(mean(bill_current, na.rm=TRUE)),\n            mean_bill_plus10 = round(mean(bill_plus10, na.rm=TRUE)),\n            mean_bill_plus20 = round(mean(bill_plus20, na.rm=TRUE)),\n            mean_bill_plus30 = round(mean(bill_plus30, na.rm=TRUE)),\n            mean_bill_plus40 = round(mean(bill_plus40, na.rm=TRUE)),\n            \n            # current perceived_savings = median(tax_amt_exe),\n            tr_neg10 = round(mean(tr_neg10*100), digits = 2), \n            cur_comp_TC_rate = round(mean(cur_comp_TC_rate), digits = 2),\n            tr_plus10 = round(mean(tr_plus10*100), digits = 2),\n            tr_plus20 = round(mean(tr_plus20*100), digits = 2),\n            tr_plus30 = round(mean(tr_plus30*100), digits = 2),\n            tr_plus40 = round(mean(tr_plus40*100), digits = 2),\n            pincount=n()\n  ) %&gt;%\n  arrange(has_HO_exemp, rank)\n\n\nmunis_billchange &lt;- munis_billchange %&gt;% left_join(muni_quartiles)\nmunis_billchange\n\n\n\n\n  \n\n\n\n\n\nCode\nratios&lt;- munis_billchange %&gt;% \n  filter(has_HO_exemp == 1 &  !is.na(rank)) %&gt;% # claimed exemption in 2021\n  mutate(currbill_to_AV_10 = ifelse(rank == \"q10\", mean_bill_neg10/median_AV, NA)) %&gt;%\n  mutate(currbill_to_AV_90 = ifelse(rank == \"q90\", mean_bill_neg10/median_AV, NA)) %&gt;% \n  group_by(clean_name) %&gt;%\n  summarize(GHE_0_bill_to_AV_10 = max(currbill_to_AV_10, na.rm=TRUE),\n            GHE_0_bill_to_AV_90 = max(currbill_to_AV_90, na.rm=TRUE)) %&gt;%\n  mutate(muni_ratio_10to90 = GHE_0_bill_to_AV_10/GHE_0_bill_to_AV_90)\n\n\nggplot(data = ratios, aes(y = GHE_0_bill_to_AV_10, x = GHE_0_bill_to_AV_90, label = clean_name)) + \n  geom_abline(intercept = 0, slope = 1) +\n  geom_point(aes(alpha = .5)) + \n  geom_text(nudge_x = .03, nudge_y=0.01, size = 3, check_overlap = TRUE)+ \n  theme_classic() + \n    scale_y_continuous(limits = c(0, .6))+\n\n  scale_x_continuous(limits = c(0, .6))+\n  theme(legend.position = \"none\") +\n  labs(title = \"Reduced GHE Amount by 10,000 EAV (0 EAV exempt from GHE)\",\n       subtitle = \"Other exemptions still in place\")\nratios&lt;- munis_billchange %&gt;% \n  filter(has_HO_exemp == 1 &  !is.na(rank)) %&gt;% # claimed exemption in 2021\n  mutate(currbill_to_AV_10 = ifelse(rank == \"q10\", mean_bill_cur/median_AV, NA)) %&gt;%\n  mutate(currbill_to_AV_90 = ifelse(rank == \"q90\", mean_bill_cur/median_AV, NA)) %&gt;% \n  group_by(clean_name) %&gt;%\n  summarize(currbill_to_AV_10 = max(currbill_to_AV_10, na.rm=TRUE),\n            currbill_to_AV_90 = max(currbill_to_AV_90, na.rm=TRUE)) %&gt;%\n  mutate(muni_ratio_10to90 = currbill_to_AV_10/currbill_to_AV_90)\n\n\nggplot(data = ratios, aes(y = currbill_to_AV_10, x = currbill_to_AV_90, label = clean_name)) + \n  geom_abline(intercept = 0, slope = 1) +\n  geom_point(aes(alpha = .5)) + \n  geom_text(nudge_x = .03, nudge_y=0.01, size = 3, check_overlap = TRUE)+ \n  theme_classic() + \n    scale_y_continuous(limits = c(0, .6))+\n\n  scale_x_continuous(limits = c(0, .6))+\n  theme(legend.position = \"none\") +\n  labs(title = \"Current GHE Amount (up to 10,000 EAV exempt per property)\")\nnew_ratios&lt;- munis_billchange %&gt;% \n  filter(has_HO_exemp == 1 &  !is.na(rank)) %&gt;% # claimed exemption in 2021\n  mutate(newbill_to_AV_10 = ifelse(rank == \"q10\", mean_bill_plus10/median_AV, NA)) %&gt;%\n  mutate(newbill_to_AV_90 = ifelse(rank == \"q90\", mean_bill_plus10/median_AV, NA)) %&gt;% \n  group_by(clean_name) %&gt;%\n  summarize(newbill_to_AV_10 = max(newbill_to_AV_10, na.rm=TRUE),\n            newbill_to_AV_90 = max(newbill_to_AV_90, na.rm=TRUE)) %&gt;%\n  mutate(muni_ratio_10to90 = newbill_to_AV_10/newbill_to_AV_90)\n\n\nggplot(data = new_ratios, aes(y = newbill_to_AV_10, x = newbill_to_AV_90, label = clean_name)) + \n  geom_abline(intercept = 0, slope = 1) +\n  geom_point(aes(alpha = .5)) + \n  geom_text(nudge_x = .03, nudge_y=0.01, size = 3, check_overlap = TRUE)+ \n  theme_classic() + \n  scale_y_continuous(limits = c(0, .6))+\n  scale_x_continuous(limits = c(0, .6))+\n  theme(legend.position = \"none\") + labs(title = \"Increase GHE by 10,000 EAV (for up to 20,000 EAV exempt) \", \n                                         y = \"10th percentile of homes, taxbill:AV\",\n                                         x= \"90th percentile of homes, taxbill:AV\",\n                                         caption =  \"Uses single-family properties. Exempt EAV up to 20K per property\")\nnew_ratios&lt;- munis_billchange %&gt;% \n  filter(has_HO_exemp == 1 &  !is.na(rank)) %&gt;% # claimed exemption in 2021\n  mutate(newbill_to_AV_10 = ifelse(rank == \"q10\", mean_bill_plus20/median_AV, NA)) %&gt;%\n  mutate(newbill_to_AV_90 = ifelse(rank == \"q90\", mean_bill_plus20/median_AV, NA)) %&gt;% \n  group_by(clean_name) %&gt;%\n  summarize(newbill_to_AV_10 = max(newbill_to_AV_10, na.rm=TRUE),\n            newbill_to_AV_90 = max(newbill_to_AV_90, na.rm=TRUE)) %&gt;%\n  mutate(muni_ratio_10to90 = newbill_to_AV_10/newbill_to_AV_90)\n\n\nggplot(data = new_ratios, aes(y = newbill_to_AV_10, x = newbill_to_AV_90, label = clean_name)) + \n  geom_abline(intercept = 0, slope = 1) +\n  geom_point(aes(alpha = .5)) + \n  geom_text(nudge_x = .03, nudge_y=0.01, size = 3, check_overlap = TRUE)+ \n  theme_classic() + \n    scale_y_continuous(limits = c(0, .6))+\n\n  scale_x_continuous(limits = c(0, .6))+\n  theme(legend.position = \"none\") + labs(title = \"Increase GHE by 20,000 EAV (for up to 30,000 EAV exempt) \", \n                                         y = \"10th percentile of homes, taxbill:AV\",\n                                         x= \"90th percentile of homes, taxbill:AV\",\n                                         caption =  \"Uses single-family properties. Exempt EAV up to 30K per property\")\nnew_ratios&lt;- munis_billchange %&gt;% \n  filter(has_HO_exemp == 1 &  !is.na(rank)) %&gt;% # claimed exemption in 2021\n  mutate(newbill_to_AV_10 = ifelse(rank == \"q10\", mean_bill_plus30/median_AV, NA)) %&gt;%\n  mutate(newbill_to_AV_90 = ifelse(rank == \"q90\", mean_bill_plus30/median_AV, NA)) %&gt;% \n  group_by(clean_name) %&gt;%\n  summarize(newbill_to_AV_10 = max(newbill_to_AV_10, na.rm=TRUE),\n            newbill_to_AV_90 = max(newbill_to_AV_90, na.rm=TRUE)) %&gt;%\n  mutate(muni_ratio_10to90 = newbill_to_AV_10/newbill_to_AV_90)\n\n\nggplot(data = new_ratios, aes(y = newbill_to_AV_10, x = newbill_to_AV_90, label = clean_name)) + \n  geom_abline(intercept = 0, slope = 1) +\n  geom_point(aes(alpha = .5)) + \n  geom_text(nudge_x = .03, nudge_y=0.01, size = 3, check_overlap = TRUE)+ \n  theme_classic() + \n    scale_y_continuous(limits = c(0, .6))+\n\n  scale_x_continuous(limits = c(0, .6))+\n  theme(legend.position = \"none\") + labs(title = \"Increase GHE by 30,000 EAV (for up to 40,000 EAV exempt) \", \n                                         y = \"10th percentile of homes, taxbill:AV\",\n                                         x= \"90th percentile of homes, taxbill:AV\",\n                                         caption =  \"Uses single-family properties. Exempt EAV up to 40K per property\")\nnew_ratios&lt;- munis_billchange %&gt;% \n  filter(has_HO_exemp == 1 &  !is.na(rank)) %&gt;% # claimed exemption in 2021\n  mutate(newbill_to_AV_10 = ifelse(rank == \"q10\", mean_bill_plus40/median_AV, NA)) %&gt;%\n  mutate(newbill_to_AV_90 = ifelse(rank == \"q90\", mean_bill_plus40/median_AV, NA)) %&gt;% \n  group_by(clean_name) %&gt;%\n  summarize(newbill_to_AV_10 = max(newbill_to_AV_10, na.rm=TRUE),\n            newbill_to_AV_90 = max(newbill_to_AV_90, na.rm=TRUE)) %&gt;%\n  mutate(muni_ratio_10to90 = newbill_to_AV_10/newbill_to_AV_90)\n\n\nggplot(data = new_ratios, aes(y = newbill_to_AV_10, x = newbill_to_AV_90, label = clean_name)) + \n  geom_abline(intercept = 0, slope = 1) +\n  geom_point(aes(alpha = .5)) + \n  geom_text(nudge_x = .03, nudge_y=0.01, size = 3, check_overlap = TRUE)+ \n  theme_classic() + \n    scale_y_continuous(limits = c(0, .6))+\n\n  scale_x_continuous(limits = c(0, .6))+\n  theme(legend.position = \"none\") + labs(title = \"Increase GHE by 40,000 EAV (for up to 50,000 EAV exempt) \", \n                                         y = \"10th percentile of homes, taxbill:AV\",\n                                         x= \"90th percentile of homes, taxbill:AV\",\n                                         caption =  \"Uses single-family properties. Exempt EAV up to 50K per property\")\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n3.2.3.1 90/10 deciles - Bigger AV range\nIncreased range of homes included in quantile to avoid having municipalities drop out if there were no tax bills. Not sure if it addresses the problem.\n\n\nCode\nq = c(.1, .5, .9)\n\n## ranks properties that are considered single family homes in order of AV for each Muni\nmuni_quartiles &lt;- joined_pins %&gt;%\n  filter(Option2 == \"Single-Family\") %&gt;% \n  filter(tax_code %in% muni_TC_fullyCook$tax_code_num) %&gt;%\n  group_by(agency_name, clean_name) %&gt;%\n  arrange(av) %&gt;%\n  summarize(count_pins = n(), \n            min = min(av),\n            quant10 = round(quantile(av, probs = q[1])), \n            quant50 = round(quantile(av, probs = q[2])),\n            quant90 = round(quantile(av, probs = q[3])),\n            max = max(av)\n           ) %&gt;% \n  arrange( desc( quant50))\nmuni_quartiles\n\n\n\n\n  \n\n\n\n\n\nCode\n## create rank variable for properties that fall within the quartiles +/- $500 range\nmunis_ranked &lt;- joined_pins  %&gt;%\n  inner_join(muni_quartiles, by = c(\"agency_name\", \"clean_name\")) %&gt;% \n  mutate(rank = case_when(\n    av &gt; (quant10-1000) & (av&lt;quant10+1000) ~ \"q10\",\n    av &gt; (quant50-1000) & (av&lt;quant50+1000) ~ \"q50\",\n    av &gt; (quant90-1000) & (av&lt;quant90+1000) ~ \"q90\")\n    ) %&gt;%\n  select(clean_name, rank, av, pin, class, everything()) %&gt;%\n  left_join(nicknames)\n\n\n\n\nmunis_billchange &lt;-  munis_ranked %&gt;% \n  group_by(clean_name, rank) %&gt;%\n  left_join(scenario_taxrates) %&gt;%\n  arrange(av) %&gt;%\n  mutate(#taxable_eav = final_tax_to_dist / tax_code_rate,\n    # current bill = current tax rate * portion of levy billed\n         bill_neg10 = tr_neg10*(equalized_AV-all_exemptions+ exe_homeowner -exe_neg10),\n\n         bill_current = cur_comp_TC_rate/100*(equalized_AV-all_exemptions),\n         bill_plus10 =  tr_plus10*(equalized_AV-all_exemptions+ exe_homeowner -exe_plus10),\n         bill_plus20 = tr_plus20*(equalized_AV-all_exemptions+ exe_homeowner -exe_plus20),\n         bill_plus30 = tr_plus30*(equalized_AV-all_exemptions+ exe_homeowner -exe_plus30),\n         bill_plus40 = tr_plus40*(equalized_AV-all_exemptions+ exe_homeowner -exe_plus40),\n\n    # ## make bills $1 if they had been negative.    \n         bill_neg10 = ifelse(bill_neg10 &lt; 1, 1, bill_neg10),\n         bill_current = ifelse(bill_current &lt; 1, 1, bill_current),\n         bill_plus10 = ifelse(bill_plus10 &lt; 1, 1, bill_plus10),\n         bill_plus20 = ifelse(bill_plus20 &lt; 1, 1, bill_plus20),\n         bill_plus30 = ifelse(bill_plus30 &lt; 1, 1, bill_plus30),\n         bill_plus40 = ifelse(bill_plus40 &lt; 1, 1, bill_plus40)) %&gt;%\n\n  mutate(\n         zerodol_bills_ghe0 = ifelse(bill_neg10 &lt; 5, 1, 0),\n         zerodol_bills_current = ifelse(bill_current &lt; 5, 1, 0),\n         zerodol_bills_ghe20 = ifelse(bill_plus10 &lt; 5, 1, 0),\n         zerodol_bills_ghe30 = ifelse(bill_plus20 &lt; 5, 1, 0),\n         zerodol_bills_ghe40 = ifelse(bill_plus30 &lt; 5, 1, 0),\n         zerodol_bills_ghe50 = ifelse(bill_plus40 &lt; 5, 1, 0),\n  ) %&gt;%\n  group_by(clean_name, rank, has_HO_exemp) %&gt;% \n  summarize(median_AV = round(median(av)),\n            median_EAV = round(median(eav)),\n            mean_bill_neg10 = round(mean(bill_neg10, na.rm=TRUE)),\n            mean_bill_cur = round(mean(bill_current, na.rm=TRUE)),\n            mean_bill_plus10 = round(mean(bill_plus10, na.rm=TRUE)),\n            mean_bill_plus20 = round(mean(bill_plus20, na.rm=TRUE)),\n            mean_bill_plus30 = round(mean(bill_plus30, na.rm=TRUE)),\n            mean_bill_plus40 = round(mean(bill_plus40, na.rm=TRUE)),\n            \n            # current perceived_savings = median(tax_amt_exe),\n            tr_neg10 = round(mean(tr_neg10), digits = 2), \n            cur_comp_TC_rate = round(mean(cur_comp_TC_rate), digits = 2),\n            tr_plus10 = round(mean(tr_plus10*100), digits = 2),\n            tr_plus20 = round(mean(tr_plus20*100), digits = 2),\n            tr_plus30 = round(mean(tr_plus30*100), digits = 2),\n            tr_plus40 = round(mean(tr_plus40*100), digits = 2),\n            pincount=n()\n  ) %&gt;%\n  arrange(has_HO_exemp, rank)\n\n\nmunis_billchange &lt;- munis_billchange %&gt;% left_join(muni_quartiles)\nmunis_billchange\n\n\n\n\n  \n\n\n\n\n\nCode\nratios&lt;- munis_billchange %&gt;% \n  filter(has_HO_exemp == 1 &  !is.na(rank)) %&gt;% # claimed exemption in 2021\n  mutate(currbill_to_AV_10 = ifelse(rank == \"q10\", mean_bill_neg10/median_AV, NA)) %&gt;%\n  mutate(currbill_to_AV_90 = ifelse(rank == \"q90\", mean_bill_neg10/median_AV, NA)) %&gt;% \n  group_by(clean_name) %&gt;%\n  summarize(GHE_0_bill_to_AV_10 = max(currbill_to_AV_10, na.rm=TRUE),\n            GHE_0_bill_to_AV_90 = max(currbill_to_AV_90, na.rm=TRUE)) %&gt;%\n  mutate(muni_ratio_10to90 = GHE_0_bill_to_AV_10/GHE_0_bill_to_AV_90)\n\n\nggplot(data = ratios, aes(y = GHE_0_bill_to_AV_10, x = GHE_0_bill_to_AV_90, label = clean_name)) + \n  geom_abline(intercept = 0, slope = 1) +\n  geom_point(aes(alpha = .5)) + \n  geom_text(nudge_x = .03, nudge_y=0.01, size = 3, check_overlap = TRUE)+ \n  theme_classic() + \n    scale_y_continuous(limits = c(0, .6))+\n\n  scale_x_continuous(limits = c(0, .6))+\n  theme(legend.position = \"none\") +\n  labs(title = \"Reduced GHE Amount by 10,000 EAV (0 EAV exempt from GHE)\",\n       subtitle = \"Other exemptions still in place\")\nratios&lt;- munis_billchange %&gt;% \n  filter(has_HO_exemp == 1 &  !is.na(rank)) %&gt;% # claimed exemption in 2021\n  mutate(currbill_to_AV_10 = ifelse(rank == \"q10\", mean_bill_cur/median_AV, NA)) %&gt;%\n  mutate(currbill_to_AV_90 = ifelse(rank == \"q90\", mean_bill_cur/median_AV, NA)) %&gt;% \n  group_by(clean_name) %&gt;%\n  summarize(currbill_to_AV_10 = max(currbill_to_AV_10, na.rm=TRUE),\n            currbill_to_AV_90 = max(currbill_to_AV_90, na.rm=TRUE)) %&gt;%\n  mutate(muni_ratio_10to90 = currbill_to_AV_10/currbill_to_AV_90)\n\n\nggplot(data = ratios, aes(y = currbill_to_AV_10, x = currbill_to_AV_90, label = clean_name)) + \n  geom_abline(intercept = 0, slope = 1) +\n  geom_point(aes(alpha = .5)) + \n  geom_text(nudge_x = .03, nudge_y=0.01, size = 3, check_overlap = TRUE)+ \n  theme_classic() + \n    scale_y_continuous(limits = c(0, .6))+\n\n  scale_x_continuous(limits = c(0, .6))+\n  theme(legend.position = \"none\") +\n  labs(title = \"Current GHE Amount (up to 10,000 EAV exempt per property)\")\nnew_ratios&lt;- munis_billchange %&gt;% \n  filter(has_HO_exemp == 1 &  !is.na(rank)) %&gt;% # claimed exemption in 2021\n  mutate(newbill_to_AV_10 = ifelse(rank == \"q10\", mean_bill_plus10/median_AV, NA)) %&gt;%\n  mutate(newbill_to_AV_90 = ifelse(rank == \"q90\", mean_bill_plus10/median_AV, NA)) %&gt;% \n  group_by(clean_name) %&gt;%\n  summarize(newbill_to_AV_10 = max(newbill_to_AV_10, na.rm=TRUE),\n            newbill_to_AV_90 = max(newbill_to_AV_90, na.rm=TRUE)) %&gt;%\n  mutate(muni_ratio_10to90 = newbill_to_AV_10/newbill_to_AV_90)\n\n\nggplot(data = new_ratios, aes(y = newbill_to_AV_10, x = newbill_to_AV_90, label = clean_name)) + \n  geom_abline(intercept = 0, slope = 1) +\n  geom_point(aes(alpha = .5)) + \n  geom_text(nudge_x = .03, nudge_y=0.01, size = 3, check_overlap = TRUE)+ \n  theme_classic() + \n  scale_y_continuous(limits = c(0, .6))+\n  scale_x_continuous(limits = c(0, .6))+\n  theme(legend.position = \"none\") + labs(title = \"Increase GHE by 10,000 EAV (for up to 20,000 EAV exempt) \", \n                                         y = \"10th percentile of homes, taxbill:AV\",\n                                         x= \"90th percentile of homes, taxbill:AV\",\n                                         caption =  \"Uses single-family properties. Exempt EAV up to 20K per property\")\nnew_ratios&lt;- munis_billchange %&gt;% \n  filter(has_HO_exemp == 1 &  !is.na(rank)) %&gt;% # claimed exemption in 2021\n  mutate(newbill_to_AV_10 = ifelse(rank == \"q10\", mean_bill_plus20/median_AV, NA)) %&gt;%\n  mutate(newbill_to_AV_90 = ifelse(rank == \"q90\", mean_bill_plus20/median_AV, NA)) %&gt;% \n  group_by(clean_name) %&gt;%\n  summarize(newbill_to_AV_10 = max(newbill_to_AV_10, na.rm=TRUE),\n            newbill_to_AV_90 = max(newbill_to_AV_90, na.rm=TRUE)) %&gt;%\n  mutate(muni_ratio_10to90 = newbill_to_AV_10/newbill_to_AV_90)\n\n\nggplot(data = new_ratios, aes(y = newbill_to_AV_10, x = newbill_to_AV_90, label = clean_name)) + \n  geom_abline(intercept = 0, slope = 1) +\n  geom_point(aes(alpha = .5)) + \n  geom_text(nudge_x = .03, nudge_y=0.01, size = 3, check_overlap = TRUE)+ \n  theme_classic() + \n    scale_y_continuous(limits = c(0, .6))+\n\n  scale_x_continuous(limits = c(0, .6))+\n  theme(legend.position = \"none\") + labs(title = \"Increase GHE by 20,000 EAV (for up to 30,000 EAV exempt) \", \n                                         y = \"10th percentile of homes, taxbill:AV\",\n                                         x= \"90th percentile of homes, taxbill:AV\",\n                                         caption =  \"Uses single-family properties. Exempt EAV up to 30K per property\")\nnew_ratios&lt;- munis_billchange %&gt;% \n  filter(has_HO_exemp == 1 &  !is.na(rank)) %&gt;% # claimed exemption in 2021\n  mutate(newbill_to_AV_10 = ifelse(rank == \"q10\", mean_bill_plus30/median_AV, NA)) %&gt;%\n  mutate(newbill_to_AV_90 = ifelse(rank == \"q90\", mean_bill_plus30/median_AV, NA)) %&gt;% \n  group_by(clean_name) %&gt;%\n  summarize(newbill_to_AV_10 = max(newbill_to_AV_10, na.rm=TRUE),\n            newbill_to_AV_90 = max(newbill_to_AV_90, na.rm=TRUE)) %&gt;%\n  mutate(muni_ratio_10to90 = newbill_to_AV_10/newbill_to_AV_90)\n\n\nggplot(data = new_ratios, aes(y = newbill_to_AV_10, x = newbill_to_AV_90, label = clean_name)) + \n  geom_abline(intercept = 0, slope = 1) +\n  geom_point(aes(alpha = .5)) + \n  geom_text(nudge_x = .03, nudge_y=0.01, size = 3, check_overlap = TRUE)+ \n  theme_classic() + \n    scale_y_continuous(limits = c(0, .6))+\n\n  scale_x_continuous(limits = c(0, .6))+\n  theme(legend.position = \"none\") + labs(title = \"Increase GHE by 30,000 EAV (for up to 40,000 EAV exempt) \", \n                                         y = \"10th percentile of homes, taxbill:AV\",\n                                         x= \"90th percentile of homes, taxbill:AV\",\n                                         caption =  \"Uses single-family properties. Exempt EAV up to 40K per property\")\nnew_ratios&lt;- munis_billchange %&gt;% \n  filter(has_HO_exemp == 1 &  !is.na(rank)) %&gt;% # claimed exemption in 2021\n  mutate(newbill_to_AV_10 = ifelse(rank == \"q10\", mean_bill_plus40/median_AV, NA)) %&gt;%\n  mutate(newbill_to_AV_90 = ifelse(rank == \"q90\", mean_bill_plus40/median_AV, NA)) %&gt;% \n  group_by(clean_name) %&gt;%\n  summarize(newbill_to_AV_10 = max(newbill_to_AV_10, na.rm=TRUE),\n            newbill_to_AV_90 = max(newbill_to_AV_90, na.rm=TRUE)) %&gt;%\n  mutate(muni_ratio_10to90 = newbill_to_AV_10/newbill_to_AV_90)\n\n\nggplot(data = new_ratios, aes(y = newbill_to_AV_10, x = newbill_to_AV_90, label = clean_name)) + \n  geom_abline(intercept = 0, slope = 1) +\n  geom_point(aes(alpha = .5)) + \n  geom_text(nudge_x = .03, nudge_y=0.01, size = 3, check_overlap = TRUE)+ \n  theme_classic() + \n    scale_y_continuous(limits = c(0, .6))+\n\n  scale_x_continuous(limits = c(0, .6))+\n  theme(legend.position = \"none\") + labs(title = \"Increase GHE by 40,000 EAV (for up to 50,000 EAV exempt) \", \n                                         y = \"10th percentile of homes, taxbill:AV\",\n                                         x= \"90th percentile of homes, taxbill:AV\",\n                                         caption =  \"Uses single-family properties. Exempt EAV up to 50K per property\")"
  },
  {
    "objectID": "GHE_Scenarios.html#combined-tables",
    "href": "GHE_Scenarios.html#combined-tables",
    "title": "3  Exemption Progressivity & GHE Scenarios",
    "section": "3.3 Combined tables",
    "text": "3.3 Combined tables\n\n\n\n\nCode\nq = c(.10, .25, .5, .75, .9, .99)\n\n## ranks properties that are considered single family homes in order of AV for each Muni\nmuni_quartiles &lt;- joined_pins %&gt;%\n  filter(Option2 == \"Single-Family\") %&gt;% \n  filter(tax_code %in% muni_TC_fullyCook$tax_code_num) %&gt;%\n  group_by(agency_name, clean_name) %&gt;%\n  arrange(av) %&gt;%\n  summarize(count_pins = n(), \n            min = min(av),\n            quant10 = round(quantile(av, probs = q[1])), \n\n            quant25 = round(quantile(av, probs = q[2])), \n            quant50 = round(quantile(av, probs = q[3])),\n            quant75 = round(quantile(av, probs = q[4])),\n            quant90 = round(quantile(av, probs = q[5])),\n            quant99 = round(quantile(av, probs = q[6])),\n\n            max = max(av)\n           ) %&gt;% \n  arrange( desc( quant50))\n\nmuni_quartiles\n\n\n\n\n  \n\n\n\nCode\n## create rank variable for properties that fall within the quartiles +/- $500 range\nmunis_ranked &lt;- joined_pins  %&gt;%\n  inner_join(muni_quartiles, by = c(\"agency_name\", \"clean_name\")) %&gt;% \n  mutate(rank = case_when(\n    av &gt; (quant10-500) & (av&lt;quant10+500) ~ \"q10\",\n    av &gt; (quant25-500) & (av&lt;quant25+500) ~ \"q25\",\n    av &gt; (quant50-500) & (av&lt;quant50+500) ~ \"q50\",\n    av &gt; (quant75-500) & (av&lt;quant75+500) ~ \"q75\",\n    av &gt; (quant90-500) & (av&lt;quant90+500) ~ \"q90\",\n    av &gt; (quant99-500) & (av&lt;quant99+500) ~ \"q99\")\n\n    ) %&gt;%\n  select(clean_name, rank, av, pin, class, everything()) %&gt;%\n  left_join(nicknames)\n\n\n\n\nmunis_billchange &lt;-  munis_ranked %&gt;% \n  group_by(clean_name, rank) %&gt;%\n  left_join(scenario_taxrates) %&gt;%\n  arrange(av) %&gt;%\n\n    mutate(\n   # ## Made negative tax bills!! ## #\n         \n         bill_neg10 = tr_neg10*(equalized_AV-all_exemptions+ exe_homeowner -exe_neg10),\n         bill_current = cur_comp_TC_rate/100*(equalized_AV-all_exemptions),\n         bill_plus10 =  tr_plus10*(equalized_AV-all_exemptions+ exe_homeowner -exe_plus10),\n         bill_plus20 = tr_plus20*(equalized_AV-all_exemptions+ exe_homeowner -exe_plus20),\n         bill_plus30 = tr_plus20*(equalized_AV-all_exemptions+ exe_homeowner -exe_plus30),\n         bill_plus40 = tr_plus20*(equalized_AV-all_exemptions+ exe_homeowner -exe_plus40),\n    \n    # ## make bills $1 if they had been negative.    \n         bill_neg10 = ifelse(bill_neg10 &lt; 1, 1, bill_neg10),\n         bill_current = ifelse(bill_current &lt; 1, 1, bill_current),\n         bill_plus10 = ifelse(bill_plus10 &lt; 1, 1, bill_plus10),\n         bill_plus20 = ifelse(bill_plus20 &lt; 1, 1, bill_plus20),\n         bill_plus30 = ifelse(bill_plus30 &lt; 1, 1, bill_plus30),\n         bill_plus40 = ifelse(bill_plus40 &lt; 1, 1, bill_plus40)\n         )%&gt;%\n  mutate(\n         zerodol_bills_ghe0 = ifelse(bill_neg10 &lt; 5, 1, 0),\n         zerodol_bills_current = ifelse(bill_current &lt; 5, 1, 0),\n         zerodol_bills_ghe20 = ifelse(bill_plus10 &lt; 5, 1, 0),\n         zerodol_bills_ghe30 = ifelse(bill_plus20 &lt; 5, 1, 0),\n         zerodol_bills_ghe40 = ifelse(bill_plus30 &lt; 5, 1, 0),\n         zerodol_bills_ghe50 = ifelse(bill_plus40 &lt; 5, 1, 0)\n  ) %&gt;%\n  group_by(clean_name, rank, has_HO_exemp) %&gt;% \n  summarize(median_AV = round(median(av)),\n            median_EAV = round(median(eav)),\n            mean_bill_neg10 = round(mean(bill_neg10, na.rm=TRUE)),\n            mean_bill_cur = round(mean(bill_current, na.rm=TRUE)),\n            mean_bill_plus10 = round(mean(bill_plus10, na.rm=TRUE)),\n            mean_bill_plus20 = round(mean(bill_plus20, na.rm=TRUE)),\n            mean_bill_plus30 = round(mean(bill_plus30, na.rm=TRUE)),\n            mean_bill_plus40 = round(mean(bill_plus40, na.rm=TRUE)),\n            \n            # current perceived_savings = median(tax_amt_exe),\n            tr_neg10 = round(mean(tr_neg10*100), digits = 2), \n            cur_comp_TC_rate = round(mean(cur_comp_TC_rate), digits = 2),\n            tr_plus10 = round(mean(tr_plus10*100), digits = 2),\n            tr_plus20 = round(mean(tr_plus20*100), digits = 2),\n            tr_plus30 = round(mean(tr_plus30*100), digits = 2),\n            tr_plus40 = round(mean(tr_plus40*100), digits = 2),\n            pincount=n(),\n            zerodol_bills_ghe0 = sum(zerodol_bills_ghe0),           \n            zerodol_bills_current = sum(zerodol_bills_current),\n            zerodol_bills_ghe20 = sum(zerodol_bills_ghe20),\n            zerodol_bills_ghe30 = sum(zerodol_bills_ghe30),\n            zerodol_bills_ghe40 = sum(zerodol_bills_ghe40),\n            zerodol_bills_ghe50 = sum(zerodol_bills_ghe50),\n\n\n  ) %&gt;%\n  arrange(has_HO_exemp, rank)\n\n\nmunis_billchange &lt;- munis_billchange %&gt;% left_join(muni_quartiles)\n\nmunis_billchange \n\n\n\n\n  \n\n\n\nCode\nwrite_csv(munis_billchange, \"5b_munis_billchange_1025507590.csv\")"
  },
  {
    "objectID": "milliondollarhomes.html",
    "href": "milliondollarhomes.html",
    "title": "4  Million Dollar Homes in Cook County, IL",
    "section": "",
    "text": "5 Changing General Homeowner Exemption - Scenarios\nCode\nq = c(.10, .25, .5, .75, .9, .99)\n\n## ranks properties that are considered single family homes in order of AV for each Muni\nmuni_quartiles &lt;- joined_pins %&gt;%\n  filter(Option2 == \"Single-Family\") %&gt;% \n  filter(tax_code %in% muni_TC_fullyCook$tax_code_num) %&gt;%\n  group_by(agency_name, clean_name) %&gt;%\n  arrange(av) %&gt;%\n  summarize(count_pins = n(), \n            min = min(av),\n            quant10 = round(quantile(av, probs = q[1])), \n            quant25 = round(quantile(av, probs = q[2])), \n            quant50 = round(quantile(av, probs = q[3])),\n            quant75 = round(quantile(av, probs = q[4])),\n            quant90 = round(quantile(av, probs = q[5])),\n            quant99 = round(quantile(av, probs = q[6])),\n            max = max(av)\n           ) %&gt;% \n  arrange( desc( quant50))\n\nmuni_quartiles\n\n\n## create rank variable for properties that fall within the quartiles +/- $500 range\nmunis_ranked &lt;- joined_pins  %&gt;%\n  inner_join(muni_quartiles, by = c(\"agency_name\", \"clean_name\")) %&gt;% \n  mutate(rank = case_when(\n    av &gt; (quant10-500) & (av&lt;quant10+500) ~ \"q10\",\n    av &gt; (quant25-500) & (av&lt;quant25+500) ~ \"q25\",\n    av &gt; (quant50-500) & (av&lt;quant50+500) ~ \"q50\",\n    av &gt; (quant75-500) & (av&lt;quant75+500) ~ \"q75\",\n    av &gt; (quant90-500) & (av&lt;quant90+500) ~ \"q90\",\n    av &gt; (quant99-500) & (av&lt;quant99+500) ~ \"q99\")\n\n    ) %&gt;%\n  select(clean_name, rank, av, pin, class, everything()) %&gt;%\n  left_join(nicknames)\n\n\n\n\nmunis_billchange &lt;-  munis_ranked %&gt;% \n  group_by(clean_name, rank) %&gt;%\n  left_join(scenario_taxrates) %&gt;%\n  arrange(av) %&gt;%\n\n    mutate(\n   # ## Made negative tax bills!! ## #\n         \n         bill_neg10 = tr_neg10*(equalized_AV-all_exemptions+ exe_homeowner -exe_neg10),\n         bill_current = cur_comp_TC_rate/100*(equalized_AV-all_exemptions),\n         bill_plus10 =  tr_plus10*(equalized_AV-all_exemptions+ exe_homeowner -exe_plus10),\n         bill_plus20 = tr_plus20*(equalized_AV-all_exemptions+ exe_homeowner -exe_plus20),\n         bill_plus30 = tr_plus30*(equalized_AV-all_exemptions+ exe_homeowner -exe_plus30),\n         bill_plus40 = tr_plus40*(equalized_AV-all_exemptions+ exe_homeowner -exe_plus40),\n    \n    # ## make bills $1 if they had been negative.    \n         bill_neg10 = ifelse(bill_neg10 &lt; 1, 1, bill_neg10),\n         bill_current = ifelse(bill_current &lt; 1, 1, bill_current),\n         bill_plus10 = ifelse(bill_plus10 &lt; 1, 1, bill_plus10),\n         bill_plus20 = ifelse(bill_plus20 &lt; 1, 1, bill_plus20),\n         bill_plus30 = ifelse(bill_plus30 &lt; 1, 1, bill_plus30),\n         bill_plus40 = ifelse(bill_plus40 &lt; 1, 1, bill_plus40)\n         )%&gt;%\n  mutate(\n         zerodol_bills_ghe0 = ifelse(bill_neg10 &lt; 5, 1, 0),\n         zerodol_bills_current = ifelse(bill_current &lt; 5, 1, 0),\n         zerodol_bills_ghe20 = ifelse(bill_plus10 &lt; 5, 1, 0),\n         zerodol_bills_ghe30 = ifelse(bill_plus20 &lt; 5, 1, 0),\n         zerodol_bills_ghe40 = ifelse(bill_plus30 &lt; 5, 1, 0),\n         zerodol_bills_ghe50 = ifelse(bill_plus40 &lt; 5, 1, 0)\n  ) %&gt;%\n  group_by(clean_name, rank, has_HO_exemp) %&gt;% \n  summarize(median_AV = round(median(av)),\n            median_EAV = round(median(eav)),\n            mean_bill_neg10 = round(mean(bill_neg10, na.rm=TRUE)),\n            mean_bill_cur = round(mean(bill_current, na.rm=TRUE)),\n            mean_bill_plus10 = round(mean(bill_plus10, na.rm=TRUE)),\n            mean_bill_plus20 = round(mean(bill_plus20, na.rm=TRUE)),\n            mean_bill_plus30 = round(mean(bill_plus30, na.rm=TRUE)),\n            mean_bill_plus40 = round(mean(bill_plus40, na.rm=TRUE)),\n            \n            # current perceived_savings = median(tax_amt_exe),\n            tr_neg10 = round(mean(tr_neg10*100), digits = 2), \n            cur_comp_TC_rate = round(mean(cur_comp_TC_rate), digits = 2),\n            tr_plus10 = round(mean(tr_plus10*100), digits = 2),\n            tr_plus20 = round(mean(tr_plus20*100), digits = 2),\n            tr_plus30 = round(mean(tr_plus30*100), digits = 2),\n            tr_plus40 = round(mean(tr_plus40*100), digits = 2),\n            pincount=n(),\n            zerodol_bills_ghe0 = sum(zerodol_bills_ghe0),           \n            zerodol_bills_current = sum(zerodol_bills_current),\n            zerodol_bills_ghe20 = sum(zerodol_bills_ghe20),\n            zerodol_bills_ghe30 = sum(zerodol_bills_ghe30),\n            zerodol_bills_ghe40 = sum(zerodol_bills_ghe40),\n            zerodol_bills_ghe50 = sum(zerodol_bills_ghe50),\n            mill_homes = sum(mil_home)\n\n  ) %&gt;%\n  arrange(has_HO_exemp, rank)\n\n\nmunis_billchange &lt;- munis_billchange %&gt;% left_join(muni_quartiles)\n\nmunis_billchange\nCode\nmunis_ranked %&gt;% \n  mutate(mil_home = ifelse(major_class_code == 2 & av*10 &gt; 1000000, 1, 0) ) %&gt;%\n # filter(has_HO_exemp == 1) %&gt;% \n  group_by(clean_name, has_HO_exemp) %&gt;% \n  summarize(million_dollar_homes = sum(mil_home)) %&gt;% \n  arrange(desc(million_dollar_homes))\n\nmunis_ranked %&gt;% \n  mutate(mil_home = ifelse(major_class_code == 2 & av*10 &gt; 1000000,1,0) ) %&gt;%\n  filter(has_HO_exemp == 1) %&gt;% \n  group_by(clean_name) %&gt;% \n  summarize(million_dollar_homes = sum(mil_home)) %&gt;% \n  arrange(desc(million_dollar_homes))\n\nmunis_ranked %&gt;% \n  mutate(mil_home = ifelse(major_class_code == 2 &av*10 &gt; 1000000,1,0) ) %&gt;%\n  filter(has_HO_exemp == 1) %&gt;% \n  summarize(million_dollar_homes = sum(mil_home))\n\nmunis_ranked %&gt;% \n  mutate(mil_home = ifelse(major_class_code == 2 & av*10 &gt; 1000000,1,0) ) %&gt;%\n  filter(has_HO_exemp == 1 & mil_home == 1) %&gt;% \n  summarize(\n    exempt_eav  = sum(exe_0),\n    million_dollar_homes = sum(mil_home),\n    bonus_rev = sum(cur_comp_TC_rate*exe_0))\nOf these, 50,775 did not claim the GHE exemption. 17,107 million dollar homes did claim the GHE exemption in 2021.\nAmount of money that could be “transferred” to areas impacted by high tax rates =\nSum of (composite tax rate * exempt_EAV) = $13 million"
  },
  {
    "objectID": "milliondollarhomes.html#quartiles-and-progressivity",
    "href": "milliondollarhomes.html#quartiles-and-progressivity",
    "title": "4  Million Dollar Homes in Cook County, IL",
    "section": "5.1 Quartiles and Progressivity",
    "text": "5.1 Quartiles and Progressivity\n\nDownload file 4C_joined_PINs_bills_and_exemptions.csv from the Box folder at this link. Put file in your project folder and run code. Change file path if needed.\n\n\n\nCode\nclass_dict &lt;- read_csv(\"./Necessary_Files/class_dict_singlefamcodes.csv\") %&gt;% \n  mutate(class_code = as.character(class_code)) # change variable type to character so the join works.\n\nnicknames &lt;- readxl::read_xlsx(\"./Necessary_Files/muni_shortnames.xlsx\")\n\n#pin_data2 &lt;- read_csv(\"./Output/4C_joined_PINs_bills_and_exemptions.csv\")\n\nmuni_taxrates &lt;- read_csv(\"./Output/4C_muni_taxrates.csv\")\n\n#pin_data2 &lt;- pin_data2 %&gt;% left_join(class_dict)\n\nmuni_TC_fullyCook &lt;- muni_tax_codes %&gt;%\n  filter(!agency_num %in% cross_county_lines)\n\n\njoined_pins &lt;- read_csv(\"./Output/4C_joined_PINs_bills_and_exemptions.csv\") %&gt;%\n  mutate(tax_code_num = as.character(tax_code_num)) %&gt;%  \n  left_join(tc_muninames) %&gt;% left_join(class_dict)\n\n# all pins in munis fully within cook county that are some form of single-family, detached home\nsingfam_pins &lt;- joined_pins %&gt;% \n  filter(tax_code %in% muni_TC_fullyCook$tax_code_num) %&gt;% # excludes county line crossing munis\n  filter(Option2 == \"Single-Family\")"
  },
  {
    "objectID": "milliondollarhomes.html#scenarios-tax-rates",
    "href": "milliondollarhomes.html#scenarios-tax-rates",
    "title": "4  Million Dollar Homes in Cook County, IL",
    "section": "5.2 Scenarios & tax rates",
    "text": "5.2 Scenarios & tax rates\n\nCalculate Class 2 Bill Burden –&gt; Calculate the amount of taxable EAV in the Municipality (for each scenario) and multiply it by the new composite tax rate (for each scenario).\nBurden Share = Taxable EAV within Property Class * Composite tax rate\nComposite Tax Rate = (Municipal Levy / Taxable EAV )\n\n\n\nCode\n## Bring in tax bills and exemption data for 2021 PINs ##\n# \n# joined_pins &lt;- read_csv(\"./Output/4C_joined_PINs_bills_and_exemptions.csv\") %&gt;%\n#   mutate(tax_code_num = as.character(tax_code_num)) %&gt;%  \n#   left_join(tc_muninames) %&gt;% left_join(class_dict)\n\nMuniLevy &lt;- joined_pins %&gt;% \n  group_by(clean_name, agency_num) %&gt;%\n  \n  summarize(MuniLevy = sum(final_tax_to_dist, na.rm = TRUE), # amount billed by munis with current exemptions in place\n            current_nonTIF_EAV_post_exemps = sum(final_tax_to_dist/(tax_code_rate/100), na.rm = TRUE),\n            current_TIF_increment_EAV = sum(final_tax_to_tif/(tax_code_rate/100), na.rm=TRUE),  \n            current_Exempt_EAV = sum(tax_amt_exe/(tax_code_rate/100), na.rm=TRUE), \n            Total_EAV = sum((tax_amt_exe+final_tax_to_dist+final_tax_to_tif)/(tax_code_rate/100), na.rm = TRUE)) %&gt;% \n  mutate(cur_muni_comp_rate = MuniLevy / current_nonTIF_EAV_post_exemps)\n\nMuniLevy\n\n\n\n\nCode\njoined_pins &lt;- joined_pins %&gt;% \n  mutate(exe_neg10 = 0,\n         exe_0 = ifelse(eav &lt; 10000 & exe_homeowner!=0, eav, \n                             ifelse(eav&gt;10000 & exe_homeowner!=0, 10000, 0 )),  #would be if there is no change in exemptions\n         exe_plus10 = ifelse(eav &lt; 20000 & exe_homeowner!=0, eav, \n                             ifelse(eav&gt;20000 & exe_homeowner!=0, 20000, 0 )),\n         exe_plus20 = ifelse(eav &lt; 30000 & exe_homeowner!=0, eav, \n                             ifelse(eav&gt;30000 & exe_homeowner!=0, 30000, 0 ) ),\n         exe_plus30 = ifelse(eav &lt; 40000 & exe_homeowner!=0, eav, \n                             ifelse(eav&gt;40000 & exe_homeowner!=0, 40000, 0) ),\n         exe_plus40 = ifelse(eav &lt; 50000 & exe_homeowner!=0, eav, \n                             ifelse(eav&gt;50000 & exe_homeowner!=0, 50000, 0) ),\n         mil_home = ifelse(av*10 &gt; 1000000, 1, 0))\n\nscenario_calcs &lt;- joined_pins %&gt;%    \n  group_by(clean_name) %&gt;%\n\n    summarize(MuniLevy = sum(final_tax_to_dist, na.rm = TRUE), # amount billed by munis with current exemptions in place\n            current_nonTIF_EAV_post_exemps = sum(final_tax_to_dist/(tax_code_rate/100), na.rm = TRUE),\n            current_TIF_increment_EAV = sum(final_tax_to_tif/(tax_code_rate/100), na.rm=TRUE),  \n            current_Exempt_EAV = sum(tax_amt_exe/(tax_code_rate/100), na.rm=TRUE), \n            current_GHE = sum(exe_homeowner, na.rm=TRUE),\n            Total_EAV = sum((tax_amt_exe+final_tax_to_dist+final_tax_to_tif)/(tax_code_rate/100), na.rm = TRUE),\n            exe_neg10 = sum(exe_neg10),\n            exe_0 = sum(exe_0), # no change, for comparison\n            exe_plus10 = sum(exe_plus10),\n            exe_plus20 = sum(exe_plus20),\n            exe_plus30 = sum(exe_plus30),\n            exe_plus40 = sum(exe_plus40),\n            mil_home = sum(mil_home)) %&gt;%\n\n  # remove all GHE (up to 10,000 EAV added back to base per PIN), \n  # add exe_homeowner back to taxable base\n  mutate(neg10_taxable_eav = Total_EAV - current_TIF_increment_EAV - current_Exempt_EAV + current_GHE,    # adds GHE exempt EAV back to taxable base and decreases tax rates\n         plus10_taxable_eav = Total_EAV - current_TIF_increment_EAV - current_Exempt_EAV + current_GHE - exe_plus10, # will increase tax rates\n         plus20_taxable_eav = Total_EAV - current_TIF_increment_EAV - current_Exempt_EAV + current_GHE - exe_plus20,\n         plus30_taxable_eav = Total_EAV - current_TIF_increment_EAV - current_Exempt_EAV + current_GHE - exe_plus30,\n         plus40_taxable_eav = Total_EAV - current_TIF_increment_EAV - current_Exempt_EAV + current_GHE - exe_plus40,\n         scenario_noexemptions_taxable_eav = Total_EAV - current_TIF_increment_EAV) %&gt;%\n  \n  mutate(tr_neg10 = MuniLevy / neg10_taxable_eav,\n         tr_nochange = MuniLevy / current_nonTIF_EAV_post_exemps,\n         tr_plus10 = MuniLevy / plus10_taxable_eav,\n         tr_plus20 = MuniLevy / plus20_taxable_eav,\n         tr_plus30 = MuniLevy / plus30_taxable_eav,\n         tr_plus40 = MuniLevy / plus40_taxable_eav, \n         tax_rate_current = MuniLevy/current_nonTIF_EAV_post_exemps,\n         taxrate_noexemps = MuniLevy /(Total_EAV - current_TIF_increment_EAV  ),\n         taxrate_noTIFs = MuniLevy / (Total_EAV - current_Exempt_EAV),\n         taxrate_noTIFs_orExemps = MuniLevy / Total_EAV) %&gt;%\n  select(clean_name, MuniLevy, tr_neg10:taxrate_noTIFs_orExemps, everything())\n\nscenario_taxrates &lt;- scenario_calcs %&gt;%  select(clean_name, MuniLevy, tr_neg10:taxrate_noTIFs_orExemps) \n\nscenario_taxrates\n\n\n\n\nCode\njoined_pins &lt;- joined_pins %&gt;% \n  mutate(exe_neg10 = 0,\n         exe_0 = ifelse(eav &lt; 10000 & exe_homeowner!=0, eav, \n                             ifelse(eav&gt;10000 & exe_homeowner!=0, 10000, 0 )),  #would be if there is no change in exemptions\n         exe_plus10 = ifelse(eav &lt; 20000 & exe_homeowner!=0, eav, \n                             ifelse(eav&gt;20000 & exe_homeowner!=0, 20000, 0 )),\n         exe_plus20 = ifelse(eav &lt; 30000 & exe_homeowner!=0, eav, \n                             ifelse(eav&gt;30000 & exe_homeowner!=0, 30000, 0 ) ),\n         exe_plus30 = ifelse(eav &lt; 40000 & exe_homeowner!=0, eav, \n                             ifelse(eav&gt;40000 & exe_homeowner!=0, 40000, 0) ),\n         exe_plus40 = ifelse(eav &lt; 50000 & exe_homeowner!=0, eav, \n                             ifelse(eav&gt;50000 & exe_homeowner!=0, 50000, 0) ),\n         mil_home = ifelse(av*10 &gt; 1000000, 1, 0))\n\nscenario_calcs &lt;- joined_pins %&gt;%    \n  group_by(clean_name) %&gt;%\n\n    summarize(MuniLevy = sum(final_tax_to_dist, na.rm = TRUE), # amount billed by munis with current exemptions in place\n            current_nonTIF_EAV_post_exemps = sum(final_tax_to_dist/(tax_code_rate/100), na.rm = TRUE),\n            current_TIF_increment_EAV = sum(final_tax_to_tif/(tax_code_rate/100), na.rm=TRUE),  \n            current_Exempt_EAV = sum(tax_amt_exe/(tax_code_rate/100), na.rm=TRUE), \n            current_GHE = sum(exe_homeowner, na.rm=TRUE),\n            Total_EAV = sum((tax_amt_exe+final_tax_to_dist+final_tax_to_tif)/(tax_code_rate/100), na.rm = TRUE),\n            exe_neg10 = sum(exe_neg10),\n            exe_0 = sum(exe_0), # no change, for comparison\n            exe_plus10 = sum(exe_plus10),\n            exe_plus20 = sum(exe_plus20),\n            exe_plus30 = sum(exe_plus30),\n            exe_plus40 = sum(exe_plus40),\n            mil_home = sum(mil_home)) %&gt;%\n\n  # remove all GHE (up to 10,000 EAV added back to base per PIN), \n  # add exe_homeowner back to taxable base\n  mutate(neg10_taxable_eav = Total_EAV - current_TIF_increment_EAV - current_Exempt_EAV + current_GHE,    # adds GHE exempt EAV back to taxable base and decreases tax rates\n         plus10_taxable_eav = Total_EAV - current_TIF_increment_EAV - current_Exempt_EAV + current_GHE - exe_plus10, # will increase tax rates\n         plus20_taxable_eav = Total_EAV - current_TIF_increment_EAV - current_Exempt_EAV + current_GHE - exe_plus20,\n         plus30_taxable_eav = Total_EAV - current_TIF_increment_EAV - current_Exempt_EAV + current_GHE - exe_plus30,\n         plus40_taxable_eav = Total_EAV - current_TIF_increment_EAV - current_Exempt_EAV + current_GHE - exe_plus40,\n         scenario_noexemptions_taxable_eav = Total_EAV - current_TIF_increment_EAV) %&gt;%\n  \n  mutate(tr_neg10 = MuniLevy / neg10_taxable_eav,\n         tr_nochange = MuniLevy / current_nonTIF_EAV_post_exemps,\n         tr_plus10 = MuniLevy / plus10_taxable_eav,\n         tr_plus20 = MuniLevy / plus20_taxable_eav,\n         tr_plus30 = MuniLevy / plus30_taxable_eav,\n         tr_plus40 = MuniLevy / plus40_taxable_eav, \n         tax_rate_current = MuniLevy/current_nonTIF_EAV_post_exemps,\n         taxrate_noexemps = MuniLevy /(Total_EAV - current_TIF_increment_EAV  ),\n         taxrate_noTIFs = MuniLevy / (Total_EAV - current_Exempt_EAV),\n         taxrate_noTIFs_orExemps = MuniLevy / Total_EAV) %&gt;%\n  select(clean_name, MuniLevy, tr_neg10:taxrate_noTIFs_orExemps, everything())\n\nscenario_taxrates &lt;- scenario_calcs %&gt;%  select(clean_name, MuniLevy, tr_neg10:taxrate_noTIFs_orExemps) \n\nscenario_taxrates"
  },
  {
    "objectID": "takeuprate.html#find-taxable-base-in-scenarios",
    "href": "takeuprate.html#find-taxable-base-in-scenarios",
    "title": "5  Exemption Takeup Rates",
    "section": "5.1 Find Taxable Base in Scenarios",
    "text": "5.1 Find Taxable Base in Scenarios\n\n\nCode\nmuni_MC_summary %&gt;%\n  filter(major_class_code == 2) %&gt;% \n  group_by(clean_name) %&gt;%\n  summarize(has_HO_exemp = sum(has_HO_exemp),\n            res_pins = sum(pins_in_muni)\n            ) %&gt;%\n  mutate(C2_takeup = has_HO_exemp / res_pins)\n\n\n\n\n  \n\n\n\n\n\nCode\nexemptions &lt;- read_csv(\"../Output/Dont_Upload/3_Exemption_Details_output-all_cook_pin_exemptions_2021_actual.csv\") \n# head(exemptions)\n\n\nexemptions &lt;- exemptions %&gt;% \n  select(pin, av, eav_original = eav, class_code, tax_code_num, major_class_code, exe_homeowner:exe_abate) %&gt;%\n  \n  mutate(exe_vet_dis = exe_vet_dis_lt50 + exe_vet_dis_50_69 + exe_vet_dis_ge70,\n         total_exempt_eav = exe_homeowner + exe_senior + exe_freeze + exe_longtime_homeowner + \n           exe_disabled + exe_vet_returning + exe_vet_dis + exe_abate,\n         has_homeown = ifelse(exe_homeowner &gt; 0, 1, 0),\n         has_senior = ifelse(exe_senior &gt; 0, 1, 0),\n         has_freeze = ifelse(exe_freeze &gt; 0, 1, 0),\n         \n         has_seniorexemps = ifelse(exe_senior &gt; 0 & exe_freeze &gt; 0, 1, 0),\n         has_disability = ifelse(exe_disabled &gt; 0, 1, 0),\n         has_vetreturn = ifelse(exe_vet_returning &gt; 0, 1, 0),\n         has_any_exemps = ifelse(total_exempt_eav &gt; 0, 1, 0)\n) %&gt;% \n  \n  mutate(tax_code_num = as.character(tax_code_num))%&gt;%\n  left_join(tc_muninames)\n  # left_join(muni_tax_codes) %&gt;% \n  # left_join(muni_agency_names) %&gt;% \n  # left_join(nicknames)\n\n# head(exemptions)\n\n#table(exemptions$has_any_exemps)\n#table(exemptions$has_seniorexemps)\n#table(exemptions$has_multi_exemps)\n\nhas_exemptions_pins &lt;-  exemptions %&gt;% \n  filter(has_any_exemps == 1)\n\n# head(has_exemptions_pins)\n\n\nmuni_summary %&gt;% summarize(sum(exe_homeowner), sum(all_exemptions), sum(av))\n\n\n\n\n  \n\n\n\nCode\nmuni_exempt_eav &lt;- has_exemptions_pins %&gt;% \n  group_by(clean_name, agency_num) %&gt;%\n  summarize(\n    av_hasexemps = sum(av, na.rm = TRUE),\n    eav_original_hasexemps=sum(eav_original, na.rm=TRUE),\n    total_exempt_eav = sum(exe_homeowner + exe_senior + exe_freeze + exe_longtime_homeowner + \n                             exe_disabled + exe_vet_returning + exe_vet_dis + exe_abate, na.rm=TRUE),\n    homeowners_exemption = sum(exe_homeowner),\n    senior_exemption = sum(exe_senior, na.rm=TRUE),\n    freeze_exemption = sum(exe_freeze, na.rm=TRUE),\n    other_exemptions = sum(exe_vet_dis + exe_disabled + exe_longtime_homeowner + exe_vet_returning + exe_abate), \n    #pin_count_hasexemptions = n(),\n    PC_has_exe = n() # has at least one exemption associated with the pin\n    ) \n\n\nmuni_C2_has_exe_eav &lt;- has_exemptions_pins %&gt;%\n  group_by(clean_name, agency_num) %&gt;%\n  filter(major_class_code == \"2\") %&gt;%\n  summarize(\n    av_hasexemps = sum(av, na.rm = TRUE),\n    eav_original_hasexemps=sum(eav_original, na.rm=TRUE),\n    total_exempt_eav = sum(exe_homeowner + exe_senior + exe_freeze + exe_longtime_homeowner +\n                             exe_disabled + exe_vet_returning + exe_vet_dis + exe_abate, na.rm=TRUE),\n    homeowners_exemption = sum(exe_homeowner),\n    senior_exemption = sum(exe_senior, na.rm=TRUE),\n    freeze_exemption = sum(exe_freeze, na.rm=TRUE),\n    other_exemptions = sum(exe_vet_dis + exe_disabled + exe_longtime_homeowner + exe_vet_returning + exe_abate),\n    PC_C2_has_exe = n()\n    )\n\n\nmuni_singfamres_has_homeowners_exemps &lt;- has_exemptions_pins %&gt;% \n  filter(class_code &gt; 199 & class_code &lt; 211) %&gt;%\n  filter(exe_homeowner &gt; 0) %&gt;%\n  group_by(clean_name, agency_num) %&gt;%\n  summarize(\n    av_singfam_has_homeownexemps = sum(av, na.rm = TRUE),\n    eav_original_sing_fam_has_homeownexemps=sum(eav_original, na.rm=TRUE),\n    total_exempt_eav_singfam_has_homeown = sum(exe_homeowner + exe_senior + exe_freeze + exe_longtime_homeowner + exe_disabled + exe_vet_returning + exe_vet_dis + exe_abate, na.rm=TRUE),\n    homeowners_exemption_singfam = sum(exe_homeowner),\n    #pin_count_singfam_has_homeownerexemptions = n(),\n    PC_SF_has_HOexe = n() # has Homeowner exemption and is within Class range specified\n  ) \n\n\nOver $10 billion in EAV is not taxed due to the general homeowners exemption. $2.63 billion is not taxed due to senior exemptions. $3.2 billion in EAV is not taxed due to Senior Freeze Exemptions.\n\n1,029,799 pins have at least one exemption in 2021.\n\n350,126 pins have multiple exemptions in 2021.\n\n151,642 pins have the senior exemption, senior freeze exemption, or both of those exemptions."
  },
  {
    "objectID": "takeuprate.html#takeup-rates",
    "href": "takeuprate.html#takeup-rates",
    "title": "5  Exemption Takeup Rates",
    "section": "5.2 Takeup Rates",
    "text": "5.2 Takeup Rates\n\nThe only take up rate that can be easily estimated is the % of Homeowners that have the general homeowners exemption. We cannot tell how long somebody has lived in their home, their age, or other factors that go into granting some types of property tax exemptions.\n\nIdentify property classes that can have homeowners exemptions\n\nProperty Class 203 has the most pins with exemptions, followed by 299. There are some non-residential property classes with exemptions but most have less than 20 pins with exemptions in each. I will focus on the 200-level property clases that make up major class “2 - Residential”.\n\n\nidentify number of pins within those property classes\nfind number of pins within those classes that have homeowner exemptions.\n\n\n\n\nCode\nwithexemps_table &lt;- has_exemptions_pins %&gt;% group_by(class_code) %&gt;% summarize(pins_w_exe = n()) %&gt;%\n  arrange(desc(pins_w_exe))\n\n\n\nallpins_table &lt;- exemptions %&gt;% group_by(class_code) %&gt;% summarize(pins_perclass = n())\n\nfull_join(allpins_table, withexemps_table) %&gt;% \n  mutate(any_exe_takeup = pins_w_exe/pins_perclass)\n\n\n\n\n  \n\n\n\nCode\nexemptions %&gt;%\n  filter(class_code!=0) %&gt;%\n  filter(tax_code_num %in% muni_tax_codes$tax_code_num)%&gt;%\n  group_by(clean_name, major_class_code) %&gt;% \n  summarize(pins_inMuni = n()) %&gt;%\n  arrange(desc(pins_inMuni)) %&gt;%\n  pivot_wider(names_from = \"major_class_code\", values_from = pins_inMuni)\n\n\n\n\n  \n\n\n\nCode\nexemptions %&gt;%\n  filter(class_code!=0) %&gt;%\n  filter(tax_code_num %in% muni_tax_codes$tax_code_num)%&gt;%\n  group_by(clean_name, major_class_code) %&gt;% \n  summarize(pins_inMuni_perclass = n(),\n            pins_w_any_exe = sum(has_any_exemps==1)) %&gt;%\n  mutate(any_exe_takeup = pins_w_any_exe/pins_inMuni_perclass) %&gt;%\n  arrange(desc(pins_inMuni_perclass)) %&gt;%\n  pivot_wider( id_cols = \"clean_name\", names_from = \"major_class_code\", values_from = any_exe_takeup)\n\n\n\n\n  \n\n\n\nCode\nClass2_HO_takeuprate &lt;- exemptions %&gt;%\n  filter(class_code!=0) %&gt;%\n  filter(tax_code_num %in% muni_tax_codes$tax_code_num)%&gt;%\n  group_by(clean_name, major_class_code) %&gt;% \n  summarize(pins_inMuni_perclass = n(),\n            pins_w_HO_exe = sum(has_homeown==1)) %&gt;%\n  mutate(HO_exe_takeup = pins_w_HO_exe/pins_inMuni_perclass) %&gt;%\n  arrange(desc(pins_inMuni_perclass)) %&gt;%\n  pivot_wider( id_cols = \"clean_name\", names_from = \"major_class_code\", values_from = HO_exe_takeup)\n\n# write_csv(Class2_HO_takeuprate, \"./Output/5_C2_w_HOexe_takeuprate.csv\")\n\nexemptions %&gt;%\n  filter(class_code!=0) %&gt;%\n  filter(tax_code_num %in% muni_tax_codes$tax_code_num)%&gt;%\n  filter(class_code &gt;= 200 & class_code &lt;300) %&gt;% \n  group_by(clean_name, class_code) %&gt;% \n  summarize(pins_inMuni_perclass = n(),\n            pins_w_any_exe = sum(has_any_exemps==1)) %&gt;%\n  mutate(any_exe_takeup = pins_w_any_exe/pins_inMuni_perclass) %&gt;%\n  arrange(clean_name) %&gt;%\n  pivot_wider( id_cols = \"clean_name\", names_from = \"class_code\", values_from = any_exe_takeup)\n\n\n\n\n  \n\n\n\nCode\nexemptions %&gt;%\n  filter(class_code!=0) %&gt;%\n  filter(tax_code_num %in% muni_tax_codes$tax_code_num)%&gt;%\n  filter(class_code &gt;= 200 & class_code &lt;300) %&gt;% \n  group_by(clean_name, class_code) %&gt;% \n  summarize(pins_inMuni_perclass = n(),\n            pins_w_HO_exe = sum(has_homeown==1)) %&gt;%\n  mutate(HO_exe_takeup = pins_w_HO_exe/pins_inMuni_perclass) %&gt;%\n  arrange(clean_name) %&gt;%\n  pivot_wider( id_cols = \"clean_name\", names_from = \"class_code\", values_from = HO_exe_takeup)\n\n\n\n\n  \n\n\n\n\n\nCode\nmunitotals &lt;- muni_summary %&gt;%\nselect(clean_name, av, equalized_av, all_exemptions, exe_homeowner:exe_vet_dis)\n\n\nmuni_residentialtotals &lt;- exemptions %&gt;%\n  filter(tax_code_num %in% muni_tax_codes$tax_code_num)%&gt;%\n  filter(major_class_code == \"2\") %&gt;% \n  group_by(clean_name, agency_num) %&gt;%\n  summarize(muni_residential_av = sum(av, na.rm = TRUE),\n            muni_residential_eav_original=sum(eav_original, na.rm=TRUE),\n            total_residential_exempt_eav = sum(exe_homeowner + exe_senior + exe_freeze + exe_longtime_homeowner + \n                                                 exe_disabled + exe_vet_returning + exe_vet_dis + exe_abate, na.rm=TRUE),\n            PC_C2_muni = n() # number of PINs that are Class 2 Residential \n            ) \n\n#muni_residentialtotals %&gt;% select(-agency_num)\n\n\n# Should I add the other \"single family\" property classes??  ## \nmuni_singfam_residentialtotals &lt;- exemptions %&gt;%\n  filter(tax_code_num %in% muni_tax_codes$tax_code_num)%&gt;%\n  filter(class_code &gt; 199 & class_code &lt; 211) %&gt;% \n  group_by(clean_name, agency_num) %&gt;%\n  summarize(muni_singfam_residential_av = sum(av, na.rm = TRUE),\n            muni_singfam_residential_eav_original=sum(eav_original, na.rm=TRUE),\n           # total \"single-family\" residential exempt eav\n            SF_res_exe_EAV_muni = sum(exe_homeowner + exe_senior + exe_freeze + exe_longtime_homeowner + \n                                      exe_disabled + exe_vet_returning + exe_vet_dis + exe_abate, na.rm=TRUE),\n            PC_SF_Res = n() \n           ) \n\n#muni_singfam_residentialtotals %&gt;% select(-agency_num)\n\nmerged &lt;- munitotals %&gt;% \n  select(clean_name, av, equalized_av) %&gt;% \n  left_join(muni_exempt_eav) %&gt;% \n  left_join(muni_residentialtotals) %&gt;%\n  left_join(muni_singfam_residentialtotals) %&gt;%\n  left_join(muni_C2_has_exe_eav) %&gt;%\n  left_join(muni_singfamres_has_homeowners_exemps) %&gt;%\n  mutate(pct_ofSF_pins_w_HOexe = PC_SF_has_HOexe / PC_SF_Res,\n        # pct_SF_pins_w_exemps = pin_count_has_homeownerexemptions / pin_count_singfam_residential,\n        # pct_pins_w_exemps = pin_count_hasexemptions / pin_count,\n       # pct_ofallpins_w_exe = PC_has_exe / muni_pins, #       pins with exemptions / all pins in a muni\n\n        pct_EAV_is_C2 = muni_residential_eav_original / equalized_av,\n         pct_C2_w_exemps = PC_C2_has_exe / PC_C2_muni, # \n         #pct_singfam_pins_w_exemps = pin_count_hasexemptions / pin_count_singfam_residential,\n      #   pct_singfam_pins_w_exemps = pin_count_has_homeownerexemptions / pin_count_singfam_residential\n    ) %&gt;%\n  \n  select(clean_name, pct_EAV_is_C2, pct_ofSF_pins_w_HOexe, #pct_ofallpins_w_exe, \n         pct_C2_w_exemps, \n         PC_has_exe, PC_C2_muni, \n        \n        # PC_allPINs_muni, \n         everything())\n\nmerged\n\n\n\n\n  \n\n\n\n\nBring in tax bills to calculate the muni levy for each municipality from final_tax_to_dist variable.\n\n\n\nCode\nmerged &lt;- merged %&gt;% left_join(muni_summary)\n\nMuniLevy &lt;- muni_summary %&gt;% \n  select(clean_name, MuniLevy = final_tax_to_dist, current_taxable_eav, final_tax_to_tif, all_exemptions, equalized_av)\n\n\nmerged &lt;- merged %&gt;% left_join(MuniLevy)"
  },
  {
    "objectID": "takeuprate.html#burden-share-for-scenarios",
    "href": "takeuprate.html#burden-share-for-scenarios",
    "title": "5  Exemption Takeup Rates",
    "section": "5.3 Burden Share for Scenarios",
    "text": "5.3 Burden Share for Scenarios\nCalculate Class 2 Burden –&gt; Calculate the amount of taxable EAV in the Municipality (for each scenario) and multiply it by the new composite tax rate (for each scenario).\nBurden Share = Taxable EAV within Property Class * Composite tax rate\nComposite Tax Rate = (Municipal Levy / Taxable EAV )\n\n\nCode\nClass2_EAV_scenarios &lt;- exemptions %&gt;% \n  filter(class_code &gt;= 200 & class_code &lt;= 300) %&gt;% \n  filter(tax_code_num %in% muni_tax_codes$tax_code_num)%&gt;%\n  group_by(clean_name) %&gt;%\n  summarize(Class2_av = sum(av, na.rm = TRUE),\n            Class2_eav_original=sum(eav_original, na.rm=TRUE),\n            Class2_total_exempt_eav = sum(exe_homeowner + exe_senior + exe_freeze + exe_longtime_homeowner + \n                                     exe_disabled + exe_vet_returning + exe_vet_dis + exe_abate, na.rm=TRUE),\n            Class2_homeowners_exemption = sum(exe_homeowner),\n            Class2_senior_exemption = sum(exe_senior, na.rm=TRUE),\n            Class2_freeze_exemption = sum(exe_freeze, na.rm=TRUE),\n            Class2_PC_permuni = n() # number of pins within each municipality\n            ) \nClass2_EAV_scenarios\n\n\n\n\n  \n\n\n\n\n\nCode\nClass2_TIF_EAV &lt;-  bills_current %&gt;% \n  filter(class &gt;= 200 & class &lt;=300) %&gt;%\n  left_join(tc_muninames, by = c(\"tax_code_num\", \"tax_code_rate\" )) %&gt;%\n # left_join(muni_agency_names, by = \"agency_num\") %&gt;%\n # left_join(nicknames, by = c(\"agency_name\" = \"agency_name\")) %&gt;%\n # filter(!agency_num %in% cross_county_lines) %&gt;%\n  group_by(clean_name) %&gt;%\n  summarize(Class2_DistrictRev = sum(final_tax_to_dist, na.rm = TRUE), # amount billed by munis with current exemptions in place\n            Class2_nonTIF_EAV_post_exemps = sum(final_tax_to_dist/(tax_code_rate/100), na.rm = TRUE),\n            Class2_TIF_increment_EAV = sum(final_tax_to_tif/(tax_code_rate/100), na.rm=TRUE),  \n            Class2_Exempt_EAV = sum(tax_amt_exe/(tax_code_rate/100), na.rm=TRUE), \n            Class2_Total_EAV = sum((tax_amt_exe+final_tax_to_dist+final_tax_to_tif)/(tax_code_rate/100), na.rm = TRUE) )\n\nClass2_TIF_EAV\n\n\nClass2_merged &lt;- Class2_TIF_EAV %&gt;% \n  left_join(Class2_EAV_scenarios) %&gt;%\n  left_join(MuniLevy) %&gt;% \n  mutate(pct_EAV_is_C2 = Class2_Total_EAV / equalized_av) # pct of all EAV in 2021 that is Class 200 level properties\n\n\n\n\nCode\nClass2_Scenario_burdenshift &lt;- Class2_merged %&gt;% \n  left_join(scenario_taxrates) %&gt;%\n  mutate(Class2_scenario1_taxable_eav = Class2_Total_EAV - Class2_TIF_increment_EAV - Class2_Exempt_EAV + Class2_homeowners_exemption,\n        Class2_scenario2_taxable_eav = Class2_Total_EAV - Class2_TIF_increment_EAV - Class2_Exempt_EAV + (Class2_senior_exemption + Class2_freeze_exemption )) %&gt;%\n  \n  mutate(burden_C2_scen1 = (Class2_scenario1_taxable_eav * taxrate_scen1)/ MuniLevy,\n         burden_C2_scen2 = (Class2_scenario2_taxable_eav * taxrate_scen2) / MuniLevy,\n         burden_C2_current = Class2_nonTIF_EAV_post_exemps * tax_rate_current/ MuniLevy,\n         burden_C2_noexemps = ( (Class2_Total_EAV - Class2_TIF_increment_EAV)*taxrate_noexemps ) / MuniLevy,\n         burden_C2_noTIF_orExemps = (Class2_Total_EAV * taxrate_noTIFs_orExemps ) / MuniLevy,\n         burden_C2_noTIFs =  ((Class2_Total_EAV - Class2_Exempt_EAV) * taxrate_noTIFs ) / MuniLevy) #  %&gt;%\n # select(clean_name, MuniLevy, taxrate_scen1, taxrate_scen2, tax_rate_current, taxrate_noexemps, scenario1_taxable_eav, scenario2_taxable_eav)\n\nClass2_Scenario_burdenshift %&gt;% \n  select(clean_name, pct_EAV_is_C2, burden_C2_scen1:burden_C2_noTIFs)  %&gt;% \n  filter(clean_name %in% c(\"Park Forest\", #\"Markham\",  \n                           \"Dolton\", #\"Hillside\", \"Riverside\", \n                           \"Chicago\"#, \"Westchester\", \"Winnetka\", \"Rosemont\"\n                           ))\n\n\nClass2_Scenario_burdenshift %&gt;% \n  select(clean_name, pct_EAV_is_C2, burden_C2_scen1:burden_C2_noTIFs) %&gt;% summarize()"
  }
]