<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Summary Statistics and Findings using CCAO’s PTAXSIM package - 4&nbsp; Million Dollar Homes in Cook County, IL</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./takeuprate.html" rel="next">
<link href="./GHE_Scenarios.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>


</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Summary Statistics and Findings using CCAO’s PTAXSIM package</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./index.html" rel="" target="" aria-current="page">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="dropdown-header">
 <span class="menu-text">Topics</span></li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/AleaWM/CookCounty-PropertyTaxes.git" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./milliondollarhomes.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Million Dollar Homes in Cook County, IL</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Background Information</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./GetData.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Get and Prepare Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./breakeven-points.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Breakeven Points and Tax Bill Distributions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./GHE_Scenarios.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Exemption Progressivity &amp; GHE Scenarios</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./milliondollarhomes.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Million Dollar Homes in Cook County, IL</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./takeuprate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Exemption Takeup Rates</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#changing-general-homeowner-exemption---scenarios" id="toc-changing-general-homeowner-exemption---scenarios" class="nav-link active" data-scroll-target="#changing-general-homeowner-exemption---scenarios"><span class="header-section-number">5</span> Changing General Homeowner Exemption - Scenarios</a>
  <ul class="collapse">
  <li><a href="#quartiles-and-progressivity" id="toc-quartiles-and-progressivity" class="nav-link" data-scroll-target="#quartiles-and-progressivity"><span class="header-section-number">5.1</span> Quartiles and Progressivity</a></li>
  <li><a href="#scenarios-tax-rates" id="toc-scenarios-tax-rates" class="nav-link" data-scroll-target="#scenarios-tax-rates"><span class="header-section-number">5.2</span> Scenarios &amp; tax rates</a></li>
  </ul></li>
  <li><a href="#ranked-properties-and-muni-quartiles" id="toc-ranked-properties-and-muni-quartiles" class="nav-link" data-scroll-target="#ranked-properties-and-muni-quartiles"><span class="header-section-number">6</span> Ranked Properties and Muni Quartiles</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Million Dollar Homes in Cook County, IL</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">echo =</span> <span class="cn">TRUE</span>,<span class="at">eval=</span><span class="cn">FALSE</span>, <span class="at">warning =</span> <span class="cn">FALSE</span>, <span class="at">message =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DBI)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggspatial)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gstat)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ptaxsim)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stars)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glue)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpattern)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the DB connection with the default name expected by PTAXSIM functions</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>ptaxsim_db_conn <span class="ot">&lt;-</span> DBI<span class="sc">::</span><span class="fu">dbConnect</span>(RSQLite<span class="sc">::</span><span class="fu">SQLite</span>(), <span class="st">"../ptaxsim.db/ptaxsim-2021.0.4.db"</span>)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">digits=</span><span class="dv">4</span>, <span class="at">scipen =</span> <span class="dv">999</span>)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">".."</span>)   <span class="co"># set directory above current one (set to parent directory)</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"../helper_tc_muninames.R"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># link to the API output as a JSON file</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>muni_shp <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"https://gis.cookcountyil.gov/traditional/rest/services/politicalBoundary/MapServer/2/query?outFields=*&amp;where=1%3D1&amp;f=geojson"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>cook_shp <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"https://gis.cookcountyil.gov/traditional/rest/services/plss/MapServer/1/query?outFields=*&amp;where=1%3D1&amp;f=geojson"</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co">#muni_shp &lt;- read_json("muni_shp.json")</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>nicknames <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">"./Necessary_Files/muni_shortnames.xlsx"</span>)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>class_dict <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"./Necessary_Files/class_dict_expanded.csv"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">class_code =</span> <span class="fu">as.character</span>(class_code))</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co"># `agency_dt` has all taxing agencies (but not TIFs) that existed each year and includes their total taxable base (cty_cook_eav), their levy, taxing rate, binary variables for if a municipality is home rule or not, as well as many other variables. tax_bill() uses this table for the taxable EAV that is used to  calculate the tax rates in the tax bills. For simulations, you must alter the taxable EAV or levy or other variables and then tell tax_bill() function to use the modified agency data table for simulated tax bills.</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="co"># # has EAV values, extensions by agency_num</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="co"># agency_dt &lt;- DBI::dbGetQuery(</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="co">#   ptaxsim_db_conn,</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="co">#   "SELECT *</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="co">#   FROM agency</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="co">#   WHERE year = 2021</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="co">#   "</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="co"># muni_agency_names &lt;- DBI::dbGetQuery(</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="co">#   ptaxsim_db_conn,</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a><span class="co">#   "SELECT DISTINCT agency_num, agency_name, minor_type</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a><span class="co">#   FROM agency_info</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a><span class="co">#   WHERE minor_type = 'MUNI'</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a><span class="co">#   OR agency_num = '020060000'  </span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a><span class="co">#   "</span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a><span class="co"># muni_tax_codes &lt;- DBI::dbGetQuery(</span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a><span class="co">#   ptaxsim_db_conn,</span></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a><span class="co">#   glue_sql("</span></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a><span class="co">#   SELECT*</span></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a><span class="co">#   FROM tax_code</span></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a><span class="co">#   WHERE agency_num IN ({muni_agency_names$agency_num*})</span></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a><span class="co">#   AND year = 2021</span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a><span class="co">#   ",</span></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a><span class="co">#   .con = ptaxsim_db_conn</span></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a><span class="co"># )  </span></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a><span class="co"># tax_codes &lt;- DBI::dbGetQuery(</span></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a><span class="co">#   ptaxsim_db_conn,</span></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a><span class="co">#   glue_sql("</span></span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a><span class="co">#   SELECT DISTINCT tax_code_num, tax_code_rate</span></span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a><span class="co">#   FROM tax_code</span></span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a><span class="co">#   WHERE year = 2021  </span></span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a><span class="co">#   ",</span></span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a><span class="co">#   .con = ptaxsim_db_conn</span></span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a><span class="co"># ## All tax codes. </span></span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a><span class="co"># ## tax codes within municipalities have additional info </span></span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a><span class="co"># tc_muninames &lt;- tax_codes %&gt;% </span></span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a><span class="co">#   left_join(muni_tax_codes) %&gt;%</span></span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a><span class="co">#   left_join(muni_agency_names) %&gt;% </span></span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(-agency_rate) %&gt;% </span></span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a><span class="co">#   left_join(nicknames) %&gt;% </span></span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(-c(minor_type, short_name, `Column1`, `Most recent reassessed`, agency_number))</span></span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a><span class="co"># # Agency number and agency name for all TIFs</span></span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a><span class="co"># TIF_agencies &lt;- DBI::dbGetQuery(</span></span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a><span class="co">#   ptaxsim_db_conn,</span></span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a><span class="co">#   "SELECT DISTINCT agency_num, agency_name, major_type, minor_type</span></span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a><span class="co">#   FROM agency_info</span></span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a><span class="co">#   WHERE minor_type = 'TIF'</span></span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a><span class="co">#   "</span></span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a><span class="co"># unique_tif_taxcodes &lt;- DBI::dbGetQuery(</span></span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a><span class="co">#   ptaxsim_db_conn, </span></span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a><span class="co">#   glue_sql("</span></span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a><span class="co">#   SELECT DISTINCT tax_code_num</span></span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a><span class="co">#   FROM tax_code</span></span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a><span class="co">#   WHERE agency_num IN ({TIF_agencies$agency_num*})</span></span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a><span class="co">#   AND year = 2021</span></span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a><span class="co">#   ",</span></span>
<span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a><span class="co">#   .con = ptaxsim_db_conn</span></span>
<span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb3-96"><a href="#cb3-96" aria-hidden="true" tabindex="-1"></a><span class="co"># tif_distrib &lt;- DBI::dbGetQuery(</span></span>
<span id="cb3-97"><a href="#cb3-97" aria-hidden="true" tabindex="-1"></a><span class="co">#   ptaxsim_db_conn, </span></span>
<span id="cb3-98"><a href="#cb3-98" aria-hidden="true" tabindex="-1"></a><span class="co">#   glue_sql("</span></span>
<span id="cb3-99"><a href="#cb3-99" aria-hidden="true" tabindex="-1"></a><span class="co">#   SELECT *</span></span>
<span id="cb3-100"><a href="#cb3-100" aria-hidden="true" tabindex="-1"></a><span class="co">#   FROM tif_distribution</span></span>
<span id="cb3-101"><a href="#cb3-101" aria-hidden="true" tabindex="-1"></a><span class="co">#   WHERE tax_code_num IN ({muni_tax_codes$tax_code_num*})</span></span>
<span id="cb3-102"><a href="#cb3-102" aria-hidden="true" tabindex="-1"></a><span class="co">#   AND year = 2021</span></span>
<span id="cb3-103"><a href="#cb3-103" aria-hidden="true" tabindex="-1"></a><span class="co">#   ",</span></span>
<span id="cb3-104"><a href="#cb3-104" aria-hidden="true" tabindex="-1"></a><span class="co">#   .con = ptaxsim_db_conn</span></span>
<span id="cb3-105"><a href="#cb3-105" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb3-106"><a href="#cb3-106" aria-hidden="true" tabindex="-1"></a><span class="co"># ) %&gt;% mutate(tax_code_num = as.character(tax_code_num))</span></span>
<span id="cb3-107"><a href="#cb3-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-108"><a href="#cb3-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-109"><a href="#cb3-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-110"><a href="#cb3-110" aria-hidden="true" tabindex="-1"></a>cross_county_lines <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"030440000"</span>, <span class="st">"030585000"</span>, <span class="st">"030890000"</span>, <span class="st">"030320000"</span>, <span class="st">"031280000"</span>,<span class="st">"030080000"</span>, <span class="st">"030560000"</span>, <span class="st">"031120000"</span>, <span class="st">"030280000"</span>, <span class="st">"030340000"</span>,<span class="st">"030150000"</span>,<span class="st">"030050000"</span>, <span class="st">"030180000"</span>,<span class="st">"030500000"</span>,<span class="st">"031210000"</span>)</span>
<span id="cb3-111"><a href="#cb3-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-112"><a href="#cb3-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-113"><a href="#cb3-113" aria-hidden="true" tabindex="-1"></a>cross_county_lines <span class="ot">&lt;-</span> muni_agency_names <span class="sc">%&gt;%</span> </span>
<span id="cb3-114"><a href="#cb3-114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(agency_num <span class="sc">%in%</span> cross_county_lines) <span class="sc">%&gt;%</span> </span>
<span id="cb3-115"><a href="#cb3-115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(nicknames, <span class="at">by =</span> <span class="st">"agency_name"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="changing-general-homeowner-exemption---scenarios" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Changing General Homeowner Exemption - Scenarios</h1>
<section id="quartiles-and-progressivity" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="quartiles-and-progressivity"><span class="header-section-number">5.1</span> Quartiles and Progressivity</h2>
<blockquote class="blockquote">
<p>Download file 4C_joined_PINs_bills_and_exemptions.csv from the Box folder at this <a href="https://uofi.box.com/s/cvp7pdjkx8kth7o0vg9itpra3z8vfkzq">link</a>. Put file in your project folder and run code. Change file path if needed.</p>
</blockquote>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>class_dict <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"./Necessary_Files/class_dict_singlefamcodes.csv"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">class_code =</span> <span class="fu">as.character</span>(class_code)) <span class="co"># change variable type to character so the join works.</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>nicknames <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_xlsx</span>(<span class="st">"./Necessary_Files/muni_shortnames.xlsx"</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">#pin_data2 &lt;- read_csv("./Output/4C_joined_PINs_bills_and_exemptions.csv")</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>muni_taxrates <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"./Output/4C_muni_taxrates.csv"</span>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co">#pin_data2 &lt;- pin_data2 %&gt;% left_join(class_dict)</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>muni_TC_fullyCook <span class="ot">&lt;-</span> muni_tax_codes <span class="sc">%&gt;%</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>agency_num <span class="sc">%in%</span> cross_county_lines)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>joined_pins <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"./Output/4C_joined_PINs_bills_and_exemptions.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tax_code_num =</span> <span class="fu">as.character</span>(tax_code_num)) <span class="sc">%&gt;%</span>  </span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(tc_muninames) <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(class_dict)</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="co"># all pins in munis fully within cook county that are some form of single-family, detached home</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>singfam_pins <span class="ot">&lt;-</span> joined_pins <span class="sc">%&gt;%</span> </span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(tax_code <span class="sc">%in%</span> muni_TC_fullyCook<span class="sc">$</span>tax_code_num) <span class="sc">%&gt;%</span> <span class="co"># excludes county line crossing munis</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Option2 <span class="sc">==</span> <span class="st">"Single-Family"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="scenarios-tax-rates" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="scenarios-tax-rates"><span class="header-section-number">5.2</span> Scenarios &amp; tax rates</h2>
<ul>
<li><p>Calculate Class 2 Bill Burden –&gt; Calculate the amount of taxable EAV in the Municipality (for each scenario) and multiply it by the new composite tax rate (for each scenario).</p></li>
<li><p>Burden Share = Taxable EAV within Property Class * Composite tax rate</p></li>
<li><p>Composite Tax Rate = (Municipal Levy / Taxable EAV )</p></li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Bring in tax bills and exemption data for 2021 PINs ##</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># joined_pins &lt;- read_csv("./Output/4C_joined_PINs_bills_and_exemptions.csv") %&gt;%</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(tax_code_num = as.character(tax_code_num)) %&gt;%  </span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   left_join(tc_muninames) %&gt;% left_join(class_dict)</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>MuniLevy <span class="ot">&lt;-</span> joined_pins <span class="sc">%&gt;%</span> </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(clean_name, agency_num) <span class="sc">%&gt;%</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">MuniLevy =</span> <span class="fu">sum</span>(final_tax_to_dist, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="co"># amount billed by munis with current exemptions in place</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">current_nonTIF_EAV_post_exemps =</span> <span class="fu">sum</span>(final_tax_to_dist<span class="sc">/</span>(tax_code_rate<span class="sc">/</span><span class="dv">100</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">current_TIF_increment_EAV =</span> <span class="fu">sum</span>(final_tax_to_tif<span class="sc">/</span>(tax_code_rate<span class="sc">/</span><span class="dv">100</span>), <span class="at">na.rm=</span><span class="cn">TRUE</span>),  </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">current_Exempt_EAV =</span> <span class="fu">sum</span>(tax_amt_exe<span class="sc">/</span>(tax_code_rate<span class="sc">/</span><span class="dv">100</span>), <span class="at">na.rm=</span><span class="cn">TRUE</span>), </span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">Total_EAV =</span> <span class="fu">sum</span>((tax_amt_exe<span class="sc">+</span>final_tax_to_dist<span class="sc">+</span>final_tax_to_tif)<span class="sc">/</span>(tax_code_rate<span class="sc">/</span><span class="dv">100</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cur_muni_comp_rate =</span> MuniLevy <span class="sc">/</span> current_nonTIF_EAV_post_exemps)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>MuniLevy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>joined_pins <span class="ot">&lt;-</span> joined_pins <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">exe_neg10 =</span> <span class="dv">0</span>,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">exe_0 =</span> <span class="fu">ifelse</span>(eav <span class="sc">&lt;</span> <span class="dv">10000</span> <span class="sc">&amp;</span> exe_homeowner<span class="sc">!=</span><span class="dv">0</span>, eav, </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">ifelse</span>(eav<span class="sc">&gt;</span><span class="dv">10000</span> <span class="sc">&amp;</span> exe_homeowner<span class="sc">!=</span><span class="dv">0</span>, <span class="dv">10000</span>, <span class="dv">0</span> )),  <span class="co">#would be if there is no change in exemptions</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">exe_plus10 =</span> <span class="fu">ifelse</span>(eav <span class="sc">&lt;</span> <span class="dv">20000</span> <span class="sc">&amp;</span> exe_homeowner<span class="sc">!=</span><span class="dv">0</span>, eav, </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">ifelse</span>(eav<span class="sc">&gt;</span><span class="dv">20000</span> <span class="sc">&amp;</span> exe_homeowner<span class="sc">!=</span><span class="dv">0</span>, <span class="dv">20000</span>, <span class="dv">0</span> )),</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">exe_plus20 =</span> <span class="fu">ifelse</span>(eav <span class="sc">&lt;</span> <span class="dv">30000</span> <span class="sc">&amp;</span> exe_homeowner<span class="sc">!=</span><span class="dv">0</span>, eav, </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">ifelse</span>(eav<span class="sc">&gt;</span><span class="dv">30000</span> <span class="sc">&amp;</span> exe_homeowner<span class="sc">!=</span><span class="dv">0</span>, <span class="dv">30000</span>, <span class="dv">0</span> ) ),</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">exe_plus30 =</span> <span class="fu">ifelse</span>(eav <span class="sc">&lt;</span> <span class="dv">40000</span> <span class="sc">&amp;</span> exe_homeowner<span class="sc">!=</span><span class="dv">0</span>, eav, </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">ifelse</span>(eav<span class="sc">&gt;</span><span class="dv">40000</span> <span class="sc">&amp;</span> exe_homeowner<span class="sc">!=</span><span class="dv">0</span>, <span class="dv">40000</span>, <span class="dv">0</span>) ),</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">exe_plus40 =</span> <span class="fu">ifelse</span>(eav <span class="sc">&lt;</span> <span class="dv">50000</span> <span class="sc">&amp;</span> exe_homeowner<span class="sc">!=</span><span class="dv">0</span>, eav, </span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">ifelse</span>(eav<span class="sc">&gt;</span><span class="dv">50000</span> <span class="sc">&amp;</span> exe_homeowner<span class="sc">!=</span><span class="dv">0</span>, <span class="dv">50000</span>, <span class="dv">0</span>) ),</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">mil_home =</span> <span class="fu">ifelse</span>(av<span class="sc">*</span><span class="dv">10</span> <span class="sc">&gt;</span> <span class="dv">1000000</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>scenario_calcs <span class="ot">&lt;-</span> joined_pins <span class="sc">%&gt;%</span>    </span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(clean_name) <span class="sc">%&gt;%</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">MuniLevy =</span> <span class="fu">sum</span>(final_tax_to_dist, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="co"># amount billed by munis with current exemptions in place</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">current_nonTIF_EAV_post_exemps =</span> <span class="fu">sum</span>(final_tax_to_dist<span class="sc">/</span>(tax_code_rate<span class="sc">/</span><span class="dv">100</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">current_TIF_increment_EAV =</span> <span class="fu">sum</span>(final_tax_to_tif<span class="sc">/</span>(tax_code_rate<span class="sc">/</span><span class="dv">100</span>), <span class="at">na.rm=</span><span class="cn">TRUE</span>),  </span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">current_Exempt_EAV =</span> <span class="fu">sum</span>(tax_amt_exe<span class="sc">/</span>(tax_code_rate<span class="sc">/</span><span class="dv">100</span>), <span class="at">na.rm=</span><span class="cn">TRUE</span>), </span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>            <span class="at">current_GHE =</span> <span class="fu">sum</span>(exe_homeowner, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>            <span class="at">Total_EAV =</span> <span class="fu">sum</span>((tax_amt_exe<span class="sc">+</span>final_tax_to_dist<span class="sc">+</span>final_tax_to_tif)<span class="sc">/</span>(tax_code_rate<span class="sc">/</span><span class="dv">100</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>            <span class="at">exe_neg10 =</span> <span class="fu">sum</span>(exe_neg10),</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>            <span class="at">exe_0 =</span> <span class="fu">sum</span>(exe_0), <span class="co"># no change, for comparison</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>            <span class="at">exe_plus10 =</span> <span class="fu">sum</span>(exe_plus10),</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>            <span class="at">exe_plus20 =</span> <span class="fu">sum</span>(exe_plus20),</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>            <span class="at">exe_plus30 =</span> <span class="fu">sum</span>(exe_plus30),</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>            <span class="at">exe_plus40 =</span> <span class="fu">sum</span>(exe_plus40),</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>            <span class="at">mil_home =</span> <span class="fu">sum</span>(mil_home)) <span class="sc">%&gt;%</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># remove all GHE (up to 10,000 EAV added back to base per PIN), </span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add exe_homeowner back to taxable base</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">neg10_taxable_eav =</span> Total_EAV <span class="sc">-</span> current_TIF_increment_EAV <span class="sc">-</span> current_Exempt_EAV <span class="sc">+</span> current_GHE,    <span class="co"># adds GHE exempt EAV back to taxable base and decreases tax rates</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>         <span class="at">plus10_taxable_eav =</span> Total_EAV <span class="sc">-</span> current_TIF_increment_EAV <span class="sc">-</span> current_Exempt_EAV <span class="sc">+</span> current_GHE <span class="sc">-</span> exe_plus10, <span class="co"># will increase tax rates</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>         <span class="at">plus20_taxable_eav =</span> Total_EAV <span class="sc">-</span> current_TIF_increment_EAV <span class="sc">-</span> current_Exempt_EAV <span class="sc">+</span> current_GHE <span class="sc">-</span> exe_plus20,</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>         <span class="at">plus30_taxable_eav =</span> Total_EAV <span class="sc">-</span> current_TIF_increment_EAV <span class="sc">-</span> current_Exempt_EAV <span class="sc">+</span> current_GHE <span class="sc">-</span> exe_plus30,</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>         <span class="at">plus40_taxable_eav =</span> Total_EAV <span class="sc">-</span> current_TIF_increment_EAV <span class="sc">-</span> current_Exempt_EAV <span class="sc">+</span> current_GHE <span class="sc">-</span> exe_plus40,</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>         <span class="at">scenario_noexemptions_taxable_eav =</span> Total_EAV <span class="sc">-</span> current_TIF_increment_EAV) <span class="sc">%&gt;%</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tr_neg10 =</span> MuniLevy <span class="sc">/</span> neg10_taxable_eav,</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>         <span class="at">tr_nochange =</span> MuniLevy <span class="sc">/</span> current_nonTIF_EAV_post_exemps,</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>         <span class="at">tr_plus10 =</span> MuniLevy <span class="sc">/</span> plus10_taxable_eav,</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>         <span class="at">tr_plus20 =</span> MuniLevy <span class="sc">/</span> plus20_taxable_eav,</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>         <span class="at">tr_plus30 =</span> MuniLevy <span class="sc">/</span> plus30_taxable_eav,</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>         <span class="at">tr_plus40 =</span> MuniLevy <span class="sc">/</span> plus40_taxable_eav, </span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>         <span class="at">tax_rate_current =</span> MuniLevy<span class="sc">/</span>current_nonTIF_EAV_post_exemps,</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>         <span class="at">taxrate_noexemps =</span> MuniLevy <span class="sc">/</span>(Total_EAV <span class="sc">-</span> current_TIF_increment_EAV  ),</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>         <span class="at">taxrate_noTIFs =</span> MuniLevy <span class="sc">/</span> (Total_EAV <span class="sc">-</span> current_Exempt_EAV),</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>         <span class="at">taxrate_noTIFs_orExemps =</span> MuniLevy <span class="sc">/</span> Total_EAV) <span class="sc">%&gt;%</span></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(clean_name, MuniLevy, tr_neg10<span class="sc">:</span>taxrate_noTIFs_orExemps, <span class="fu">everything</span>())</span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>scenario_taxrates <span class="ot">&lt;-</span> scenario_calcs <span class="sc">%&gt;%</span>  <span class="fu">select</span>(clean_name, MuniLevy, tr_neg10<span class="sc">:</span>taxrate_noTIFs_orExemps) </span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>scenario_taxrates</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>joined_pins <span class="ot">&lt;-</span> joined_pins <span class="sc">%&gt;%</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">exe_neg10 =</span> <span class="dv">0</span>,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">exe_0 =</span> <span class="fu">ifelse</span>(eav <span class="sc">&lt;</span> <span class="dv">10000</span> <span class="sc">&amp;</span> exe_homeowner<span class="sc">!=</span><span class="dv">0</span>, eav, </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">ifelse</span>(eav<span class="sc">&gt;</span><span class="dv">10000</span> <span class="sc">&amp;</span> exe_homeowner<span class="sc">!=</span><span class="dv">0</span>, <span class="dv">10000</span>, <span class="dv">0</span> )),  <span class="co">#would be if there is no change in exemptions</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">exe_plus10 =</span> <span class="fu">ifelse</span>(eav <span class="sc">&lt;</span> <span class="dv">20000</span> <span class="sc">&amp;</span> exe_homeowner<span class="sc">!=</span><span class="dv">0</span>, eav, </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">ifelse</span>(eav<span class="sc">&gt;</span><span class="dv">20000</span> <span class="sc">&amp;</span> exe_homeowner<span class="sc">!=</span><span class="dv">0</span>, <span class="dv">20000</span>, <span class="dv">0</span> )),</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">exe_plus20 =</span> <span class="fu">ifelse</span>(eav <span class="sc">&lt;</span> <span class="dv">30000</span> <span class="sc">&amp;</span> exe_homeowner<span class="sc">!=</span><span class="dv">0</span>, eav, </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">ifelse</span>(eav<span class="sc">&gt;</span><span class="dv">30000</span> <span class="sc">&amp;</span> exe_homeowner<span class="sc">!=</span><span class="dv">0</span>, <span class="dv">30000</span>, <span class="dv">0</span> ) ),</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">exe_plus30 =</span> <span class="fu">ifelse</span>(eav <span class="sc">&lt;</span> <span class="dv">40000</span> <span class="sc">&amp;</span> exe_homeowner<span class="sc">!=</span><span class="dv">0</span>, eav, </span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">ifelse</span>(eav<span class="sc">&gt;</span><span class="dv">40000</span> <span class="sc">&amp;</span> exe_homeowner<span class="sc">!=</span><span class="dv">0</span>, <span class="dv">40000</span>, <span class="dv">0</span>) ),</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">exe_plus40 =</span> <span class="fu">ifelse</span>(eav <span class="sc">&lt;</span> <span class="dv">50000</span> <span class="sc">&amp;</span> exe_homeowner<span class="sc">!=</span><span class="dv">0</span>, eav, </span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">ifelse</span>(eav<span class="sc">&gt;</span><span class="dv">50000</span> <span class="sc">&amp;</span> exe_homeowner<span class="sc">!=</span><span class="dv">0</span>, <span class="dv">50000</span>, <span class="dv">0</span>) ),</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">mil_home =</span> <span class="fu">ifelse</span>(av<span class="sc">*</span><span class="dv">10</span> <span class="sc">&gt;</span> <span class="dv">1000000</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>scenario_calcs <span class="ot">&lt;-</span> joined_pins <span class="sc">%&gt;%</span>    </span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(clean_name) <span class="sc">%&gt;%</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">MuniLevy =</span> <span class="fu">sum</span>(final_tax_to_dist, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="co"># amount billed by munis with current exemptions in place</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">current_nonTIF_EAV_post_exemps =</span> <span class="fu">sum</span>(final_tax_to_dist<span class="sc">/</span>(tax_code_rate<span class="sc">/</span><span class="dv">100</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">current_TIF_increment_EAV =</span> <span class="fu">sum</span>(final_tax_to_tif<span class="sc">/</span>(tax_code_rate<span class="sc">/</span><span class="dv">100</span>), <span class="at">na.rm=</span><span class="cn">TRUE</span>),  </span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">current_Exempt_EAV =</span> <span class="fu">sum</span>(tax_amt_exe<span class="sc">/</span>(tax_code_rate<span class="sc">/</span><span class="dv">100</span>), <span class="at">na.rm=</span><span class="cn">TRUE</span>), </span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>            <span class="at">current_GHE =</span> <span class="fu">sum</span>(exe_homeowner, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>            <span class="at">Total_EAV =</span> <span class="fu">sum</span>((tax_amt_exe<span class="sc">+</span>final_tax_to_dist<span class="sc">+</span>final_tax_to_tif)<span class="sc">/</span>(tax_code_rate<span class="sc">/</span><span class="dv">100</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>            <span class="at">exe_neg10 =</span> <span class="fu">sum</span>(exe_neg10),</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>            <span class="at">exe_0 =</span> <span class="fu">sum</span>(exe_0), <span class="co"># no change, for comparison</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>            <span class="at">exe_plus10 =</span> <span class="fu">sum</span>(exe_plus10),</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>            <span class="at">exe_plus20 =</span> <span class="fu">sum</span>(exe_plus20),</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>            <span class="at">exe_plus30 =</span> <span class="fu">sum</span>(exe_plus30),</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>            <span class="at">exe_plus40 =</span> <span class="fu">sum</span>(exe_plus40),</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>            <span class="at">mil_home =</span> <span class="fu">sum</span>(mil_home)) <span class="sc">%&gt;%</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># remove all GHE (up to 10,000 EAV added back to base per PIN), </span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add exe_homeowner back to taxable base</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">neg10_taxable_eav =</span> Total_EAV <span class="sc">-</span> current_TIF_increment_EAV <span class="sc">-</span> current_Exempt_EAV <span class="sc">+</span> current_GHE,    <span class="co"># adds GHE exempt EAV back to taxable base and decreases tax rates</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>         <span class="at">plus10_taxable_eav =</span> Total_EAV <span class="sc">-</span> current_TIF_increment_EAV <span class="sc">-</span> current_Exempt_EAV <span class="sc">+</span> current_GHE <span class="sc">-</span> exe_plus10, <span class="co"># will increase tax rates</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>         <span class="at">plus20_taxable_eav =</span> Total_EAV <span class="sc">-</span> current_TIF_increment_EAV <span class="sc">-</span> current_Exempt_EAV <span class="sc">+</span> current_GHE <span class="sc">-</span> exe_plus20,</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>         <span class="at">plus30_taxable_eav =</span> Total_EAV <span class="sc">-</span> current_TIF_increment_EAV <span class="sc">-</span> current_Exempt_EAV <span class="sc">+</span> current_GHE <span class="sc">-</span> exe_plus30,</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>         <span class="at">plus40_taxable_eav =</span> Total_EAV <span class="sc">-</span> current_TIF_increment_EAV <span class="sc">-</span> current_Exempt_EAV <span class="sc">+</span> current_GHE <span class="sc">-</span> exe_plus40,</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>         <span class="at">scenario_noexemptions_taxable_eav =</span> Total_EAV <span class="sc">-</span> current_TIF_increment_EAV) <span class="sc">%&gt;%</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tr_neg10 =</span> MuniLevy <span class="sc">/</span> neg10_taxable_eav,</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>         <span class="at">tr_nochange =</span> MuniLevy <span class="sc">/</span> current_nonTIF_EAV_post_exemps,</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>         <span class="at">tr_plus10 =</span> MuniLevy <span class="sc">/</span> plus10_taxable_eav,</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>         <span class="at">tr_plus20 =</span> MuniLevy <span class="sc">/</span> plus20_taxable_eav,</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>         <span class="at">tr_plus30 =</span> MuniLevy <span class="sc">/</span> plus30_taxable_eav,</span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>         <span class="at">tr_plus40 =</span> MuniLevy <span class="sc">/</span> plus40_taxable_eav, </span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>         <span class="at">tax_rate_current =</span> MuniLevy<span class="sc">/</span>current_nonTIF_EAV_post_exemps,</span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>         <span class="at">taxrate_noexemps =</span> MuniLevy <span class="sc">/</span>(Total_EAV <span class="sc">-</span> current_TIF_increment_EAV  ),</span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>         <span class="at">taxrate_noTIFs =</span> MuniLevy <span class="sc">/</span> (Total_EAV <span class="sc">-</span> current_Exempt_EAV),</span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>         <span class="at">taxrate_noTIFs_orExemps =</span> MuniLevy <span class="sc">/</span> Total_EAV) <span class="sc">%&gt;%</span></span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(clean_name, MuniLevy, tr_neg10<span class="sc">:</span>taxrate_noTIFs_orExemps, <span class="fu">everything</span>())</span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>scenario_taxrates <span class="ot">&lt;-</span> scenario_calcs <span class="sc">%&gt;%</span>  <span class="fu">select</span>(clean_name, MuniLevy, tr_neg10<span class="sc">:</span>taxrate_noTIFs_orExemps) </span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>scenario_taxrates</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="ranked-properties-and-muni-quartiles" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Ranked Properties and Muni Quartiles</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>q <span class="ot">=</span> <span class="fu">c</span>(.<span class="dv">10</span>, .<span class="dv">25</span>, .<span class="dv">5</span>, .<span class="dv">75</span>, .<span class="dv">9</span>, .<span class="dv">99</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="do">## ranks properties that are considered single family homes in order of AV for each Muni</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>muni_quartiles <span class="ot">&lt;-</span> joined_pins <span class="sc">%&gt;%</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Option2 <span class="sc">==</span> <span class="st">"Single-Family"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(tax_code <span class="sc">%in%</span> muni_TC_fullyCook<span class="sc">$</span>tax_code_num) <span class="sc">%&gt;%</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(agency_name, clean_name) <span class="sc">%&gt;%</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(av) <span class="sc">%&gt;%</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">count_pins =</span> <span class="fu">n</span>(), </span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">min =</span> <span class="fu">min</span>(av),</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">quant10 =</span> <span class="fu">round</span>(<span class="fu">quantile</span>(av, <span class="at">probs =</span> q[<span class="dv">1</span>])), </span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">quant25 =</span> <span class="fu">round</span>(<span class="fu">quantile</span>(av, <span class="at">probs =</span> q[<span class="dv">2</span>])), </span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">quant50 =</span> <span class="fu">round</span>(<span class="fu">quantile</span>(av, <span class="at">probs =</span> q[<span class="dv">3</span>])),</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">quant75 =</span> <span class="fu">round</span>(<span class="fu">quantile</span>(av, <span class="at">probs =</span> q[<span class="dv">4</span>])),</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">quant90 =</span> <span class="fu">round</span>(<span class="fu">quantile</span>(av, <span class="at">probs =</span> q[<span class="dv">5</span>])),</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">quant99 =</span> <span class="fu">round</span>(<span class="fu">quantile</span>(av, <span class="at">probs =</span> q[<span class="dv">6</span>])),</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">max =</span> <span class="fu">max</span>(av)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>           ) <span class="sc">%&gt;%</span> </span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>( <span class="fu">desc</span>( quant50))</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>muni_quartiles</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a><span class="do">## create rank variable for properties that fall within the quartiles +/- $500 range</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>munis_ranked <span class="ot">&lt;-</span> joined_pins  <span class="sc">%&gt;%</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(muni_quartiles, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"agency_name"</span>, <span class="st">"clean_name"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rank =</span> <span class="fu">case_when</span>(</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>    av <span class="sc">&gt;</span> (quant10<span class="dv">-500</span>) <span class="sc">&amp;</span> (av<span class="sc">&lt;</span>quant10<span class="sc">+</span><span class="dv">500</span>) <span class="sc">~</span> <span class="st">"q10"</span>,</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>    av <span class="sc">&gt;</span> (quant25<span class="dv">-500</span>) <span class="sc">&amp;</span> (av<span class="sc">&lt;</span>quant25<span class="sc">+</span><span class="dv">500</span>) <span class="sc">~</span> <span class="st">"q25"</span>,</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>    av <span class="sc">&gt;</span> (quant50<span class="dv">-500</span>) <span class="sc">&amp;</span> (av<span class="sc">&lt;</span>quant50<span class="sc">+</span><span class="dv">500</span>) <span class="sc">~</span> <span class="st">"q50"</span>,</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>    av <span class="sc">&gt;</span> (quant75<span class="dv">-500</span>) <span class="sc">&amp;</span> (av<span class="sc">&lt;</span>quant75<span class="sc">+</span><span class="dv">500</span>) <span class="sc">~</span> <span class="st">"q75"</span>,</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>    av <span class="sc">&gt;</span> (quant90<span class="dv">-500</span>) <span class="sc">&amp;</span> (av<span class="sc">&lt;</span>quant90<span class="sc">+</span><span class="dv">500</span>) <span class="sc">~</span> <span class="st">"q90"</span>,</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>    av <span class="sc">&gt;</span> (quant99<span class="dv">-500</span>) <span class="sc">&amp;</span> (av<span class="sc">&lt;</span>quant99<span class="sc">+</span><span class="dv">500</span>) <span class="sc">~</span> <span class="st">"q99"</span>)</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(clean_name, rank, av, pin, class, <span class="fu">everything</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(nicknames)</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>munis_billchange <span class="ot">&lt;-</span>  munis_ranked <span class="sc">%&gt;%</span> </span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(clean_name, rank) <span class="sc">%&gt;%</span></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(scenario_taxrates) <span class="sc">%&gt;%</span></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(av) <span class="sc">%&gt;%</span></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>   <span class="co"># ## Made negative tax bills!! ## #</span></span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>         <span class="at">bill_neg10 =</span> tr_neg10<span class="sc">*</span>(equalized_AV<span class="sc">-</span>all_exemptions<span class="sc">+</span> exe_homeowner <span class="sc">-</span>exe_neg10),</span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>         <span class="at">bill_current =</span> cur_comp_TC_rate<span class="sc">/</span><span class="dv">100</span><span class="sc">*</span>(equalized_AV<span class="sc">-</span>all_exemptions),</span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>         <span class="at">bill_plus10 =</span>  tr_plus10<span class="sc">*</span>(equalized_AV<span class="sc">-</span>all_exemptions<span class="sc">+</span> exe_homeowner <span class="sc">-</span>exe_plus10),</span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>         <span class="at">bill_plus20 =</span> tr_plus20<span class="sc">*</span>(equalized_AV<span class="sc">-</span>all_exemptions<span class="sc">+</span> exe_homeowner <span class="sc">-</span>exe_plus20),</span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>         <span class="at">bill_plus30 =</span> tr_plus30<span class="sc">*</span>(equalized_AV<span class="sc">-</span>all_exemptions<span class="sc">+</span> exe_homeowner <span class="sc">-</span>exe_plus30),</span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>         <span class="at">bill_plus40 =</span> tr_plus40<span class="sc">*</span>(equalized_AV<span class="sc">-</span>all_exemptions<span class="sc">+</span> exe_homeowner <span class="sc">-</span>exe_plus40),</span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ## make bills $1 if they had been negative.    </span></span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>         <span class="at">bill_neg10 =</span> <span class="fu">ifelse</span>(bill_neg10 <span class="sc">&lt;</span> <span class="dv">1</span>, <span class="dv">1</span>, bill_neg10),</span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>         <span class="at">bill_current =</span> <span class="fu">ifelse</span>(bill_current <span class="sc">&lt;</span> <span class="dv">1</span>, <span class="dv">1</span>, bill_current),</span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>         <span class="at">bill_plus10 =</span> <span class="fu">ifelse</span>(bill_plus10 <span class="sc">&lt;</span> <span class="dv">1</span>, <span class="dv">1</span>, bill_plus10),</span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a>         <span class="at">bill_plus20 =</span> <span class="fu">ifelse</span>(bill_plus20 <span class="sc">&lt;</span> <span class="dv">1</span>, <span class="dv">1</span>, bill_plus20),</span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a>         <span class="at">bill_plus30 =</span> <span class="fu">ifelse</span>(bill_plus30 <span class="sc">&lt;</span> <span class="dv">1</span>, <span class="dv">1</span>, bill_plus30),</span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>         <span class="at">bill_plus40 =</span> <span class="fu">ifelse</span>(bill_plus40 <span class="sc">&lt;</span> <span class="dv">1</span>, <span class="dv">1</span>, bill_plus40)</span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a>         )<span class="sc">%&gt;%</span></span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a>         <span class="at">zerodol_bills_ghe0 =</span> <span class="fu">ifelse</span>(bill_neg10 <span class="sc">&lt;</span> <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a>         <span class="at">zerodol_bills_current =</span> <span class="fu">ifelse</span>(bill_current <span class="sc">&lt;</span> <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a>         <span class="at">zerodol_bills_ghe20 =</span> <span class="fu">ifelse</span>(bill_plus10 <span class="sc">&lt;</span> <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a>         <span class="at">zerodol_bills_ghe30 =</span> <span class="fu">ifelse</span>(bill_plus20 <span class="sc">&lt;</span> <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a>         <span class="at">zerodol_bills_ghe40 =</span> <span class="fu">ifelse</span>(bill_plus30 <span class="sc">&lt;</span> <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a>         <span class="at">zerodol_bills_ghe50 =</span> <span class="fu">ifelse</span>(bill_plus40 <span class="sc">&lt;</span> <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(clean_name, rank, has_HO_exemp) <span class="sc">%&gt;%</span> </span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">median_AV =</span> <span class="fu">round</span>(<span class="fu">median</span>(av)),</span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a>            <span class="at">median_EAV =</span> <span class="fu">round</span>(<span class="fu">median</span>(eav)),</span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_bill_neg10 =</span> <span class="fu">round</span>(<span class="fu">mean</span>(bill_neg10, <span class="at">na.rm=</span><span class="cn">TRUE</span>)),</span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_bill_cur =</span> <span class="fu">round</span>(<span class="fu">mean</span>(bill_current, <span class="at">na.rm=</span><span class="cn">TRUE</span>)),</span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_bill_plus10 =</span> <span class="fu">round</span>(<span class="fu">mean</span>(bill_plus10, <span class="at">na.rm=</span><span class="cn">TRUE</span>)),</span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_bill_plus20 =</span> <span class="fu">round</span>(<span class="fu">mean</span>(bill_plus20, <span class="at">na.rm=</span><span class="cn">TRUE</span>)),</span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_bill_plus30 =</span> <span class="fu">round</span>(<span class="fu">mean</span>(bill_plus30, <span class="at">na.rm=</span><span class="cn">TRUE</span>)),</span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_bill_plus40 =</span> <span class="fu">round</span>(<span class="fu">mean</span>(bill_plus40, <span class="at">na.rm=</span><span class="cn">TRUE</span>)),</span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a>            <span class="co"># current perceived_savings = median(tax_amt_exe),</span></span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a>            <span class="at">tr_neg10 =</span> <span class="fu">round</span>(<span class="fu">mean</span>(tr_neg10<span class="sc">*</span><span class="dv">100</span>), <span class="at">digits =</span> <span class="dv">2</span>), </span>
<span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a>            <span class="at">cur_comp_TC_rate =</span> <span class="fu">round</span>(<span class="fu">mean</span>(cur_comp_TC_rate), <span class="at">digits =</span> <span class="dv">2</span>),</span>
<span id="cb8-86"><a href="#cb8-86" aria-hidden="true" tabindex="-1"></a>            <span class="at">tr_plus10 =</span> <span class="fu">round</span>(<span class="fu">mean</span>(tr_plus10<span class="sc">*</span><span class="dv">100</span>), <span class="at">digits =</span> <span class="dv">2</span>),</span>
<span id="cb8-87"><a href="#cb8-87" aria-hidden="true" tabindex="-1"></a>            <span class="at">tr_plus20 =</span> <span class="fu">round</span>(<span class="fu">mean</span>(tr_plus20<span class="sc">*</span><span class="dv">100</span>), <span class="at">digits =</span> <span class="dv">2</span>),</span>
<span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a>            <span class="at">tr_plus30 =</span> <span class="fu">round</span>(<span class="fu">mean</span>(tr_plus30<span class="sc">*</span><span class="dv">100</span>), <span class="at">digits =</span> <span class="dv">2</span>),</span>
<span id="cb8-89"><a href="#cb8-89" aria-hidden="true" tabindex="-1"></a>            <span class="at">tr_plus40 =</span> <span class="fu">round</span>(<span class="fu">mean</span>(tr_plus40<span class="sc">*</span><span class="dv">100</span>), <span class="at">digits =</span> <span class="dv">2</span>),</span>
<span id="cb8-90"><a href="#cb8-90" aria-hidden="true" tabindex="-1"></a>            <span class="at">pincount=</span><span class="fu">n</span>(),</span>
<span id="cb8-91"><a href="#cb8-91" aria-hidden="true" tabindex="-1"></a>            <span class="at">zerodol_bills_ghe0 =</span> <span class="fu">sum</span>(zerodol_bills_ghe0),           </span>
<span id="cb8-92"><a href="#cb8-92" aria-hidden="true" tabindex="-1"></a>            <span class="at">zerodol_bills_current =</span> <span class="fu">sum</span>(zerodol_bills_current),</span>
<span id="cb8-93"><a href="#cb8-93" aria-hidden="true" tabindex="-1"></a>            <span class="at">zerodol_bills_ghe20 =</span> <span class="fu">sum</span>(zerodol_bills_ghe20),</span>
<span id="cb8-94"><a href="#cb8-94" aria-hidden="true" tabindex="-1"></a>            <span class="at">zerodol_bills_ghe30 =</span> <span class="fu">sum</span>(zerodol_bills_ghe30),</span>
<span id="cb8-95"><a href="#cb8-95" aria-hidden="true" tabindex="-1"></a>            <span class="at">zerodol_bills_ghe40 =</span> <span class="fu">sum</span>(zerodol_bills_ghe40),</span>
<span id="cb8-96"><a href="#cb8-96" aria-hidden="true" tabindex="-1"></a>            <span class="at">zerodol_bills_ghe50 =</span> <span class="fu">sum</span>(zerodol_bills_ghe50),</span>
<span id="cb8-97"><a href="#cb8-97" aria-hidden="true" tabindex="-1"></a>            <span class="at">mill_homes =</span> <span class="fu">sum</span>(mil_home)</span>
<span id="cb8-98"><a href="#cb8-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-99"><a href="#cb8-99" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb8-100"><a href="#cb8-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(has_HO_exemp, rank)</span>
<span id="cb8-101"><a href="#cb8-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-102"><a href="#cb8-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-103"><a href="#cb8-103" aria-hidden="true" tabindex="-1"></a>munis_billchange <span class="ot">&lt;-</span> munis_billchange <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(muni_quartiles)</span>
<span id="cb8-104"><a href="#cb8-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-105"><a href="#cb8-105" aria-hidden="true" tabindex="-1"></a>munis_billchange </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>munis_ranked <span class="sc">%&gt;%</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mil_home =</span> <span class="fu">ifelse</span>(major_class_code <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> av<span class="sc">*</span><span class="dv">10</span> <span class="sc">&gt;</span> <span class="dv">1000000</span>, <span class="dv">1</span>, <span class="dv">0</span>) ) <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a> <span class="co"># filter(has_HO_exemp == 1) %&gt;% </span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(clean_name, has_HO_exemp) <span class="sc">%&gt;%</span> </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">million_dollar_homes =</span> <span class="fu">sum</span>(mil_home)) <span class="sc">%&gt;%</span> </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(million_dollar_homes))</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>munis_ranked <span class="sc">%&gt;%</span> </span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mil_home =</span> <span class="fu">ifelse</span>(major_class_code <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> av<span class="sc">*</span><span class="dv">10</span> <span class="sc">&gt;</span> <span class="dv">1000000</span>,<span class="dv">1</span>,<span class="dv">0</span>) ) <span class="sc">%&gt;%</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(has_HO_exemp <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(clean_name) <span class="sc">%&gt;%</span> </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">million_dollar_homes =</span> <span class="fu">sum</span>(mil_home)) <span class="sc">%&gt;%</span> </span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(million_dollar_homes))</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>munis_ranked <span class="sc">%&gt;%</span> </span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mil_home =</span> <span class="fu">ifelse</span>(major_class_code <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span>av<span class="sc">*</span><span class="dv">10</span> <span class="sc">&gt;</span> <span class="dv">1000000</span>,<span class="dv">1</span>,<span class="dv">0</span>) ) <span class="sc">%&gt;%</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(has_HO_exemp <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">million_dollar_homes =</span> <span class="fu">sum</span>(mil_home))</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>munis_ranked <span class="sc">%&gt;%</span> </span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mil_home =</span> <span class="fu">ifelse</span>(major_class_code <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> av<span class="sc">*</span><span class="dv">10</span> <span class="sc">&gt;</span> <span class="dv">1000000</span>,<span class="dv">1</span>,<span class="dv">0</span>) ) <span class="sc">%&gt;%</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(has_HO_exemp <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> mil_home <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">exempt_eav  =</span> <span class="fu">sum</span>(exe_0),</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">million_dollar_homes =</span> <span class="fu">sum</span>(mil_home),</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">bonus_rev =</span> <span class="fu">sum</span>(cur_comp_TC_rate<span class="sc">*</span>exe_0))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Of these, 50,775 did not claim the GHE exemption. 17,107 million dollar homes did claim the GHE exemption in 2021.</p>
<p>Amount of money that could be “transferred” to areas impacted by high tax rates =</p>
<p>Sum of (composite tax rate * exempt_EAV) = $13 million</p>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./GHE_Scenarios.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Exemption Progressivity &amp; GHE Scenarios</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./takeuprate.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Exemption Takeup Rates</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb10" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Million Dollar Homes in Cook County, IL"</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, warning = FALSE, message = FALSE}</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">echo =</span> <span class="cn">TRUE</span>,<span class="at">eval=</span><span class="cn">FALSE</span>, <span class="at">warning =</span> <span class="cn">FALSE</span>, <span class="at">message =</span> <span class="cn">FALSE</span>)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DBI)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggspatial)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gstat)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ptaxsim)</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stars)</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glue)</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpattern)</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the DB connection with the default name expected by PTAXSIM functions</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>ptaxsim_db_conn <span class="ot">&lt;-</span> DBI<span class="sc">::</span><span class="fu">dbConnect</span>(RSQLite<span class="sc">::</span><span class="fu">SQLite</span>(), <span class="st">"../ptaxsim.db/ptaxsim-2021.0.4.db"</span>)</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">digits=</span><span class="dv">4</span>, <span class="at">scipen =</span> <span class="dv">999</span>)</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">".."</span>)   <span class="co"># set directory above current one (set to parent directory)</span></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"../helper_tc_muninames.R"</span>)</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a><span class="co"># link to the API output as a JSON file</span></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>muni_shp <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"https://gis.cookcountyil.gov/traditional/rest/services/politicalBoundary/MapServer/2/query?outFields=*&amp;where=1%3D1&amp;f=geojson"</span>)</span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>cook_shp <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"https://gis.cookcountyil.gov/traditional/rest/services/plss/MapServer/1/query?outFields=*&amp;where=1%3D1&amp;f=geojson"</span>)</span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a><span class="co">#muni_shp &lt;- read_json("muni_shp.json")</span></span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>nicknames <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">"./Necessary_Files/muni_shortnames.xlsx"</span>)</span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>class_dict <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"./Necessary_Files/class_dict_expanded.csv"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">class_code =</span> <span class="fu">as.character</span>(class_code))</span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a><span class="co"># `agency_dt` has all taxing agencies (but not TIFs) that existed each year and includes their total taxable base (cty_cook_eav), their levy, taxing rate, binary variables for if a municipality is home rule or not, as well as many other variables. tax_bill() uses this table for the taxable EAV that is used to  calculate the tax rates in the tax bills. For simulations, you must alter the taxable EAV or levy or other variables and then tell tax_bill() function to use the modified agency data table for simulated tax bills.</span></span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a><span class="co"># # has EAV values, extensions by agency_num</span></span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a><span class="co"># agency_dt &lt;- DBI::dbGetQuery(</span></span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a><span class="co">#   ptaxsim_db_conn,</span></span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a><span class="co">#   "SELECT *</span></span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a><span class="co">#   FROM agency</span></span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a><span class="co">#   WHERE year = 2021</span></span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a><span class="co">#   "</span></span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a><span class="co"># muni_agency_names &lt;- DBI::dbGetQuery(</span></span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a><span class="co">#   ptaxsim_db_conn,</span></span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a><span class="co">#   "SELECT DISTINCT agency_num, agency_name, minor_type</span></span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a><span class="co">#   FROM agency_info</span></span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a><span class="co">#   WHERE minor_type = 'MUNI'</span></span>
<span id="cb10-76"><a href="#cb10-76" aria-hidden="true" tabindex="-1"></a><span class="co">#   OR agency_num = '020060000'  </span></span>
<span id="cb10-77"><a href="#cb10-77" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb10-78"><a href="#cb10-78" aria-hidden="true" tabindex="-1"></a><span class="co">#   "</span></span>
<span id="cb10-79"><a href="#cb10-79" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb10-80"><a href="#cb10-80" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb10-81"><a href="#cb10-81" aria-hidden="true" tabindex="-1"></a><span class="co"># muni_tax_codes &lt;- DBI::dbGetQuery(</span></span>
<span id="cb10-82"><a href="#cb10-82" aria-hidden="true" tabindex="-1"></a><span class="co">#   ptaxsim_db_conn,</span></span>
<span id="cb10-83"><a href="#cb10-83" aria-hidden="true" tabindex="-1"></a><span class="co">#   glue_sql("</span></span>
<span id="cb10-84"><a href="#cb10-84" aria-hidden="true" tabindex="-1"></a><span class="co">#   SELECT*</span></span>
<span id="cb10-85"><a href="#cb10-85" aria-hidden="true" tabindex="-1"></a><span class="co">#   FROM tax_code</span></span>
<span id="cb10-86"><a href="#cb10-86" aria-hidden="true" tabindex="-1"></a><span class="co">#   WHERE agency_num IN ({muni_agency_names$agency_num*})</span></span>
<span id="cb10-87"><a href="#cb10-87" aria-hidden="true" tabindex="-1"></a><span class="co">#   AND year = 2021</span></span>
<span id="cb10-88"><a href="#cb10-88" aria-hidden="true" tabindex="-1"></a><span class="co">#   ",</span></span>
<span id="cb10-89"><a href="#cb10-89" aria-hidden="true" tabindex="-1"></a><span class="co">#   .con = ptaxsim_db_conn</span></span>
<span id="cb10-90"><a href="#cb10-90" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb10-91"><a href="#cb10-91" aria-hidden="true" tabindex="-1"></a><span class="co"># )  </span></span>
<span id="cb10-92"><a href="#cb10-92" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb10-93"><a href="#cb10-93" aria-hidden="true" tabindex="-1"></a><span class="co"># tax_codes &lt;- DBI::dbGetQuery(</span></span>
<span id="cb10-94"><a href="#cb10-94" aria-hidden="true" tabindex="-1"></a><span class="co">#   ptaxsim_db_conn,</span></span>
<span id="cb10-95"><a href="#cb10-95" aria-hidden="true" tabindex="-1"></a><span class="co">#   glue_sql("</span></span>
<span id="cb10-96"><a href="#cb10-96" aria-hidden="true" tabindex="-1"></a><span class="co">#   SELECT DISTINCT tax_code_num, tax_code_rate</span></span>
<span id="cb10-97"><a href="#cb10-97" aria-hidden="true" tabindex="-1"></a><span class="co">#   FROM tax_code</span></span>
<span id="cb10-98"><a href="#cb10-98" aria-hidden="true" tabindex="-1"></a><span class="co">#   WHERE year = 2021  </span></span>
<span id="cb10-99"><a href="#cb10-99" aria-hidden="true" tabindex="-1"></a><span class="co">#   ",</span></span>
<span id="cb10-100"><a href="#cb10-100" aria-hidden="true" tabindex="-1"></a><span class="co">#   .con = ptaxsim_db_conn</span></span>
<span id="cb10-101"><a href="#cb10-101" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb10-102"><a href="#cb10-102" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb10-103"><a href="#cb10-103" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb10-104"><a href="#cb10-104" aria-hidden="true" tabindex="-1"></a><span class="co"># ## All tax codes. </span></span>
<span id="cb10-105"><a href="#cb10-105" aria-hidden="true" tabindex="-1"></a><span class="co"># ## tax codes within municipalities have additional info </span></span>
<span id="cb10-106"><a href="#cb10-106" aria-hidden="true" tabindex="-1"></a><span class="co"># tc_muninames &lt;- tax_codes %&gt;% </span></span>
<span id="cb10-107"><a href="#cb10-107" aria-hidden="true" tabindex="-1"></a><span class="co">#   left_join(muni_tax_codes) %&gt;%</span></span>
<span id="cb10-108"><a href="#cb10-108" aria-hidden="true" tabindex="-1"></a><span class="co">#   left_join(muni_agency_names) %&gt;% </span></span>
<span id="cb10-109"><a href="#cb10-109" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(-agency_rate) %&gt;% </span></span>
<span id="cb10-110"><a href="#cb10-110" aria-hidden="true" tabindex="-1"></a><span class="co">#   left_join(nicknames) %&gt;% </span></span>
<span id="cb10-111"><a href="#cb10-111" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(-c(minor_type, short_name, `Column1`, `Most recent reassessed`, agency_number))</span></span>
<span id="cb10-112"><a href="#cb10-112" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb10-113"><a href="#cb10-113" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb10-114"><a href="#cb10-114" aria-hidden="true" tabindex="-1"></a><span class="co"># # Agency number and agency name for all TIFs</span></span>
<span id="cb10-115"><a href="#cb10-115" aria-hidden="true" tabindex="-1"></a><span class="co"># TIF_agencies &lt;- DBI::dbGetQuery(</span></span>
<span id="cb10-116"><a href="#cb10-116" aria-hidden="true" tabindex="-1"></a><span class="co">#   ptaxsim_db_conn,</span></span>
<span id="cb10-117"><a href="#cb10-117" aria-hidden="true" tabindex="-1"></a><span class="co">#   "SELECT DISTINCT agency_num, agency_name, major_type, minor_type</span></span>
<span id="cb10-118"><a href="#cb10-118" aria-hidden="true" tabindex="-1"></a><span class="co">#   FROM agency_info</span></span>
<span id="cb10-119"><a href="#cb10-119" aria-hidden="true" tabindex="-1"></a><span class="co">#   WHERE minor_type = 'TIF'</span></span>
<span id="cb10-120"><a href="#cb10-120" aria-hidden="true" tabindex="-1"></a><span class="co">#   "</span></span>
<span id="cb10-121"><a href="#cb10-121" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb10-122"><a href="#cb10-122" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb10-123"><a href="#cb10-123" aria-hidden="true" tabindex="-1"></a><span class="co"># unique_tif_taxcodes &lt;- DBI::dbGetQuery(</span></span>
<span id="cb10-124"><a href="#cb10-124" aria-hidden="true" tabindex="-1"></a><span class="co">#   ptaxsim_db_conn, </span></span>
<span id="cb10-125"><a href="#cb10-125" aria-hidden="true" tabindex="-1"></a><span class="co">#   glue_sql("</span></span>
<span id="cb10-126"><a href="#cb10-126" aria-hidden="true" tabindex="-1"></a><span class="co">#   SELECT DISTINCT tax_code_num</span></span>
<span id="cb10-127"><a href="#cb10-127" aria-hidden="true" tabindex="-1"></a><span class="co">#   FROM tax_code</span></span>
<span id="cb10-128"><a href="#cb10-128" aria-hidden="true" tabindex="-1"></a><span class="co">#   WHERE agency_num IN ({TIF_agencies$agency_num*})</span></span>
<span id="cb10-129"><a href="#cb10-129" aria-hidden="true" tabindex="-1"></a><span class="co">#   AND year = 2021</span></span>
<span id="cb10-130"><a href="#cb10-130" aria-hidden="true" tabindex="-1"></a><span class="co">#   ",</span></span>
<span id="cb10-131"><a href="#cb10-131" aria-hidden="true" tabindex="-1"></a><span class="co">#   .con = ptaxsim_db_conn</span></span>
<span id="cb10-132"><a href="#cb10-132" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb10-133"><a href="#cb10-133" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb10-134"><a href="#cb10-134" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb10-135"><a href="#cb10-135" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb10-136"><a href="#cb10-136" aria-hidden="true" tabindex="-1"></a><span class="co"># tif_distrib &lt;- DBI::dbGetQuery(</span></span>
<span id="cb10-137"><a href="#cb10-137" aria-hidden="true" tabindex="-1"></a><span class="co">#   ptaxsim_db_conn, </span></span>
<span id="cb10-138"><a href="#cb10-138" aria-hidden="true" tabindex="-1"></a><span class="co">#   glue_sql("</span></span>
<span id="cb10-139"><a href="#cb10-139" aria-hidden="true" tabindex="-1"></a><span class="co">#   SELECT *</span></span>
<span id="cb10-140"><a href="#cb10-140" aria-hidden="true" tabindex="-1"></a><span class="co">#   FROM tif_distribution</span></span>
<span id="cb10-141"><a href="#cb10-141" aria-hidden="true" tabindex="-1"></a><span class="co">#   WHERE tax_code_num IN ({muni_tax_codes$tax_code_num*})</span></span>
<span id="cb10-142"><a href="#cb10-142" aria-hidden="true" tabindex="-1"></a><span class="co">#   AND year = 2021</span></span>
<span id="cb10-143"><a href="#cb10-143" aria-hidden="true" tabindex="-1"></a><span class="co">#   ",</span></span>
<span id="cb10-144"><a href="#cb10-144" aria-hidden="true" tabindex="-1"></a><span class="co">#   .con = ptaxsim_db_conn</span></span>
<span id="cb10-145"><a href="#cb10-145" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb10-146"><a href="#cb10-146" aria-hidden="true" tabindex="-1"></a><span class="co"># ) %&gt;% mutate(tax_code_num = as.character(tax_code_num))</span></span>
<span id="cb10-147"><a href="#cb10-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-148"><a href="#cb10-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-149"><a href="#cb10-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-150"><a href="#cb10-150" aria-hidden="true" tabindex="-1"></a>cross_county_lines <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"030440000"</span>, <span class="st">"030585000"</span>, <span class="st">"030890000"</span>, <span class="st">"030320000"</span>, <span class="st">"031280000"</span>,<span class="st">"030080000"</span>, <span class="st">"030560000"</span>, <span class="st">"031120000"</span>, <span class="st">"030280000"</span>, <span class="st">"030340000"</span>,<span class="st">"030150000"</span>,<span class="st">"030050000"</span>, <span class="st">"030180000"</span>,<span class="st">"030500000"</span>,<span class="st">"031210000"</span>)</span>
<span id="cb10-151"><a href="#cb10-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-152"><a href="#cb10-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-153"><a href="#cb10-153" aria-hidden="true" tabindex="-1"></a>cross_county_lines <span class="ot">&lt;-</span> muni_agency_names <span class="sc">%&gt;%</span> </span>
<span id="cb10-154"><a href="#cb10-154" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(agency_num <span class="sc">%in%</span> cross_county_lines) <span class="sc">%&gt;%</span> </span>
<span id="cb10-155"><a href="#cb10-155" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(nicknames, <span class="at">by =</span> <span class="st">"agency_name"</span>)</span>
<span id="cb10-156"><a href="#cb10-156" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-157"><a href="#cb10-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-158"><a href="#cb10-158" aria-hidden="true" tabindex="-1"></a><span class="fu"># Changing General Homeowner Exemption - Scenarios</span></span>
<span id="cb10-159"><a href="#cb10-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-160"><a href="#cb10-160" aria-hidden="true" tabindex="-1"></a><span class="fu">## Quartiles and Progressivity</span></span>
<span id="cb10-161"><a href="#cb10-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-162"><a href="#cb10-162" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Download file 4C_joined_PINs_bills_and_exemptions.csv from the Box folder at this </span><span class="co">[</span><span class="ot">link</span><span class="co">](https://uofi.box.com/s/cvp7pdjkx8kth7o0vg9itpra3z8vfkzq)</span><span class="at">. Put file in your project folder and run code. Change file path if needed.</span></span>
<span id="cb10-163"><a href="#cb10-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-166"><a href="#cb10-166" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb10-167"><a href="#cb10-167" aria-hidden="true" tabindex="-1"></a>class_dict <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"./Necessary_Files/class_dict_singlefamcodes.csv"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb10-168"><a href="#cb10-168" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">class_code =</span> <span class="fu">as.character</span>(class_code)) <span class="co"># change variable type to character so the join works.</span></span>
<span id="cb10-169"><a href="#cb10-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-170"><a href="#cb10-170" aria-hidden="true" tabindex="-1"></a>nicknames <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_xlsx</span>(<span class="st">"./Necessary_Files/muni_shortnames.xlsx"</span>)</span>
<span id="cb10-171"><a href="#cb10-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-172"><a href="#cb10-172" aria-hidden="true" tabindex="-1"></a><span class="co">#pin_data2 &lt;- read_csv("./Output/4C_joined_PINs_bills_and_exemptions.csv")</span></span>
<span id="cb10-173"><a href="#cb10-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-174"><a href="#cb10-174" aria-hidden="true" tabindex="-1"></a>muni_taxrates <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"./Output/4C_muni_taxrates.csv"</span>)</span>
<span id="cb10-175"><a href="#cb10-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-176"><a href="#cb10-176" aria-hidden="true" tabindex="-1"></a><span class="co">#pin_data2 &lt;- pin_data2 %&gt;% left_join(class_dict)</span></span>
<span id="cb10-177"><a href="#cb10-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-178"><a href="#cb10-178" aria-hidden="true" tabindex="-1"></a>muni_TC_fullyCook <span class="ot">&lt;-</span> muni_tax_codes <span class="sc">%&gt;%</span></span>
<span id="cb10-179"><a href="#cb10-179" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>agency_num <span class="sc">%in%</span> cross_county_lines)</span>
<span id="cb10-180"><a href="#cb10-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-181"><a href="#cb10-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-182"><a href="#cb10-182" aria-hidden="true" tabindex="-1"></a>joined_pins <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"./Output/4C_joined_PINs_bills_and_exemptions.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-183"><a href="#cb10-183" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tax_code_num =</span> <span class="fu">as.character</span>(tax_code_num)) <span class="sc">%&gt;%</span>  </span>
<span id="cb10-184"><a href="#cb10-184" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(tc_muninames) <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(class_dict)</span>
<span id="cb10-185"><a href="#cb10-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-186"><a href="#cb10-186" aria-hidden="true" tabindex="-1"></a><span class="co"># all pins in munis fully within cook county that are some form of single-family, detached home</span></span>
<span id="cb10-187"><a href="#cb10-187" aria-hidden="true" tabindex="-1"></a>singfam_pins <span class="ot">&lt;-</span> joined_pins <span class="sc">%&gt;%</span> </span>
<span id="cb10-188"><a href="#cb10-188" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(tax_code <span class="sc">%in%</span> muni_TC_fullyCook<span class="sc">$</span>tax_code_num) <span class="sc">%&gt;%</span> <span class="co"># excludes county line crossing munis</span></span>
<span id="cb10-189"><a href="#cb10-189" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Option2 <span class="sc">==</span> <span class="st">"Single-Family"</span>)</span>
<span id="cb10-190"><a href="#cb10-190" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-191"><a href="#cb10-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-192"><a href="#cb10-192" aria-hidden="true" tabindex="-1"></a><span class="fu">## Scenarios &amp; tax rates</span></span>
<span id="cb10-193"><a href="#cb10-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-194"><a href="#cb10-194" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Calculate Class 2 Bill Burden --<span class="sc">\&gt;</span> Calculate the amount of taxable EAV in the Municipality (for each scenario) and multiply it by the new composite tax rate (for each scenario).</span>
<span id="cb10-195"><a href="#cb10-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-196"><a href="#cb10-196" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Burden Share = Taxable EAV within Property Class <span class="sc">\*</span> Composite tax rate</span>
<span id="cb10-197"><a href="#cb10-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-198"><a href="#cb10-198" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Composite Tax Rate = (Municipal Levy / Taxable EAV )</span>
<span id="cb10-199"><a href="#cb10-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-202"><a href="#cb10-202" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb10-203"><a href="#cb10-203" aria-hidden="true" tabindex="-1"></a><span class="do">## Bring in tax bills and exemption data for 2021 PINs ##</span></span>
<span id="cb10-204"><a href="#cb10-204" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb10-205"><a href="#cb10-205" aria-hidden="true" tabindex="-1"></a><span class="co"># joined_pins &lt;- read_csv("./Output/4C_joined_PINs_bills_and_exemptions.csv") %&gt;%</span></span>
<span id="cb10-206"><a href="#cb10-206" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(tax_code_num = as.character(tax_code_num)) %&gt;%  </span></span>
<span id="cb10-207"><a href="#cb10-207" aria-hidden="true" tabindex="-1"></a><span class="co">#   left_join(tc_muninames) %&gt;% left_join(class_dict)</span></span>
<span id="cb10-208"><a href="#cb10-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-209"><a href="#cb10-209" aria-hidden="true" tabindex="-1"></a>MuniLevy <span class="ot">&lt;-</span> joined_pins <span class="sc">%&gt;%</span> </span>
<span id="cb10-210"><a href="#cb10-210" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(clean_name, agency_num) <span class="sc">%&gt;%</span></span>
<span id="cb10-211"><a href="#cb10-211" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-212"><a href="#cb10-212" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">MuniLevy =</span> <span class="fu">sum</span>(final_tax_to_dist, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="co"># amount billed by munis with current exemptions in place</span></span>
<span id="cb10-213"><a href="#cb10-213" aria-hidden="true" tabindex="-1"></a>            <span class="at">current_nonTIF_EAV_post_exemps =</span> <span class="fu">sum</span>(final_tax_to_dist<span class="sc">/</span>(tax_code_rate<span class="sc">/</span><span class="dv">100</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb10-214"><a href="#cb10-214" aria-hidden="true" tabindex="-1"></a>            <span class="at">current_TIF_increment_EAV =</span> <span class="fu">sum</span>(final_tax_to_tif<span class="sc">/</span>(tax_code_rate<span class="sc">/</span><span class="dv">100</span>), <span class="at">na.rm=</span><span class="cn">TRUE</span>),  </span>
<span id="cb10-215"><a href="#cb10-215" aria-hidden="true" tabindex="-1"></a>            <span class="at">current_Exempt_EAV =</span> <span class="fu">sum</span>(tax_amt_exe<span class="sc">/</span>(tax_code_rate<span class="sc">/</span><span class="dv">100</span>), <span class="at">na.rm=</span><span class="cn">TRUE</span>), </span>
<span id="cb10-216"><a href="#cb10-216" aria-hidden="true" tabindex="-1"></a>            <span class="at">Total_EAV =</span> <span class="fu">sum</span>((tax_amt_exe<span class="sc">+</span>final_tax_to_dist<span class="sc">+</span>final_tax_to_tif)<span class="sc">/</span>(tax_code_rate<span class="sc">/</span><span class="dv">100</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-217"><a href="#cb10-217" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cur_muni_comp_rate =</span> MuniLevy <span class="sc">/</span> current_nonTIF_EAV_post_exemps)</span>
<span id="cb10-218"><a href="#cb10-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-219"><a href="#cb10-219" aria-hidden="true" tabindex="-1"></a>MuniLevy</span>
<span id="cb10-220"><a href="#cb10-220" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-223"><a href="#cb10-223" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb10-224"><a href="#cb10-224" aria-hidden="true" tabindex="-1"></a>joined_pins <span class="ot">&lt;-</span> joined_pins <span class="sc">%&gt;%</span> </span>
<span id="cb10-225"><a href="#cb10-225" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">exe_neg10 =</span> <span class="dv">0</span>,</span>
<span id="cb10-226"><a href="#cb10-226" aria-hidden="true" tabindex="-1"></a>         <span class="at">exe_0 =</span> <span class="fu">ifelse</span>(eav <span class="sc">&lt;</span> <span class="dv">10000</span> <span class="sc">&amp;</span> exe_homeowner<span class="sc">!=</span><span class="dv">0</span>, eav, </span>
<span id="cb10-227"><a href="#cb10-227" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">ifelse</span>(eav<span class="sc">&gt;</span><span class="dv">10000</span> <span class="sc">&amp;</span> exe_homeowner<span class="sc">!=</span><span class="dv">0</span>, <span class="dv">10000</span>, <span class="dv">0</span> )),  <span class="co">#would be if there is no change in exemptions</span></span>
<span id="cb10-228"><a href="#cb10-228" aria-hidden="true" tabindex="-1"></a>         <span class="at">exe_plus10 =</span> <span class="fu">ifelse</span>(eav <span class="sc">&lt;</span> <span class="dv">20000</span> <span class="sc">&amp;</span> exe_homeowner<span class="sc">!=</span><span class="dv">0</span>, eav, </span>
<span id="cb10-229"><a href="#cb10-229" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">ifelse</span>(eav<span class="sc">&gt;</span><span class="dv">20000</span> <span class="sc">&amp;</span> exe_homeowner<span class="sc">!=</span><span class="dv">0</span>, <span class="dv">20000</span>, <span class="dv">0</span> )),</span>
<span id="cb10-230"><a href="#cb10-230" aria-hidden="true" tabindex="-1"></a>         <span class="at">exe_plus20 =</span> <span class="fu">ifelse</span>(eav <span class="sc">&lt;</span> <span class="dv">30000</span> <span class="sc">&amp;</span> exe_homeowner<span class="sc">!=</span><span class="dv">0</span>, eav, </span>
<span id="cb10-231"><a href="#cb10-231" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">ifelse</span>(eav<span class="sc">&gt;</span><span class="dv">30000</span> <span class="sc">&amp;</span> exe_homeowner<span class="sc">!=</span><span class="dv">0</span>, <span class="dv">30000</span>, <span class="dv">0</span> ) ),</span>
<span id="cb10-232"><a href="#cb10-232" aria-hidden="true" tabindex="-1"></a>         <span class="at">exe_plus30 =</span> <span class="fu">ifelse</span>(eav <span class="sc">&lt;</span> <span class="dv">40000</span> <span class="sc">&amp;</span> exe_homeowner<span class="sc">!=</span><span class="dv">0</span>, eav, </span>
<span id="cb10-233"><a href="#cb10-233" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">ifelse</span>(eav<span class="sc">&gt;</span><span class="dv">40000</span> <span class="sc">&amp;</span> exe_homeowner<span class="sc">!=</span><span class="dv">0</span>, <span class="dv">40000</span>, <span class="dv">0</span>) ),</span>
<span id="cb10-234"><a href="#cb10-234" aria-hidden="true" tabindex="-1"></a>         <span class="at">exe_plus40 =</span> <span class="fu">ifelse</span>(eav <span class="sc">&lt;</span> <span class="dv">50000</span> <span class="sc">&amp;</span> exe_homeowner<span class="sc">!=</span><span class="dv">0</span>, eav, </span>
<span id="cb10-235"><a href="#cb10-235" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">ifelse</span>(eav<span class="sc">&gt;</span><span class="dv">50000</span> <span class="sc">&amp;</span> exe_homeowner<span class="sc">!=</span><span class="dv">0</span>, <span class="dv">50000</span>, <span class="dv">0</span>) ),</span>
<span id="cb10-236"><a href="#cb10-236" aria-hidden="true" tabindex="-1"></a>         <span class="at">mil_home =</span> <span class="fu">ifelse</span>(av<span class="sc">*</span><span class="dv">10</span> <span class="sc">&gt;</span> <span class="dv">1000000</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb10-237"><a href="#cb10-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-238"><a href="#cb10-238" aria-hidden="true" tabindex="-1"></a>scenario_calcs <span class="ot">&lt;-</span> joined_pins <span class="sc">%&gt;%</span>    </span>
<span id="cb10-239"><a href="#cb10-239" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(clean_name) <span class="sc">%&gt;%</span></span>
<span id="cb10-240"><a href="#cb10-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-241"><a href="#cb10-241" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">MuniLevy =</span> <span class="fu">sum</span>(final_tax_to_dist, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="co"># amount billed by munis with current exemptions in place</span></span>
<span id="cb10-242"><a href="#cb10-242" aria-hidden="true" tabindex="-1"></a>            <span class="at">current_nonTIF_EAV_post_exemps =</span> <span class="fu">sum</span>(final_tax_to_dist<span class="sc">/</span>(tax_code_rate<span class="sc">/</span><span class="dv">100</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb10-243"><a href="#cb10-243" aria-hidden="true" tabindex="-1"></a>            <span class="at">current_TIF_increment_EAV =</span> <span class="fu">sum</span>(final_tax_to_tif<span class="sc">/</span>(tax_code_rate<span class="sc">/</span><span class="dv">100</span>), <span class="at">na.rm=</span><span class="cn">TRUE</span>),  </span>
<span id="cb10-244"><a href="#cb10-244" aria-hidden="true" tabindex="-1"></a>            <span class="at">current_Exempt_EAV =</span> <span class="fu">sum</span>(tax_amt_exe<span class="sc">/</span>(tax_code_rate<span class="sc">/</span><span class="dv">100</span>), <span class="at">na.rm=</span><span class="cn">TRUE</span>), </span>
<span id="cb10-245"><a href="#cb10-245" aria-hidden="true" tabindex="-1"></a>            <span class="at">current_GHE =</span> <span class="fu">sum</span>(exe_homeowner, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb10-246"><a href="#cb10-246" aria-hidden="true" tabindex="-1"></a>            <span class="at">Total_EAV =</span> <span class="fu">sum</span>((tax_amt_exe<span class="sc">+</span>final_tax_to_dist<span class="sc">+</span>final_tax_to_tif)<span class="sc">/</span>(tax_code_rate<span class="sc">/</span><span class="dv">100</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb10-247"><a href="#cb10-247" aria-hidden="true" tabindex="-1"></a>            <span class="at">exe_neg10 =</span> <span class="fu">sum</span>(exe_neg10),</span>
<span id="cb10-248"><a href="#cb10-248" aria-hidden="true" tabindex="-1"></a>            <span class="at">exe_0 =</span> <span class="fu">sum</span>(exe_0), <span class="co"># no change, for comparison</span></span>
<span id="cb10-249"><a href="#cb10-249" aria-hidden="true" tabindex="-1"></a>            <span class="at">exe_plus10 =</span> <span class="fu">sum</span>(exe_plus10),</span>
<span id="cb10-250"><a href="#cb10-250" aria-hidden="true" tabindex="-1"></a>            <span class="at">exe_plus20 =</span> <span class="fu">sum</span>(exe_plus20),</span>
<span id="cb10-251"><a href="#cb10-251" aria-hidden="true" tabindex="-1"></a>            <span class="at">exe_plus30 =</span> <span class="fu">sum</span>(exe_plus30),</span>
<span id="cb10-252"><a href="#cb10-252" aria-hidden="true" tabindex="-1"></a>            <span class="at">exe_plus40 =</span> <span class="fu">sum</span>(exe_plus40),</span>
<span id="cb10-253"><a href="#cb10-253" aria-hidden="true" tabindex="-1"></a>            <span class="at">mil_home =</span> <span class="fu">sum</span>(mil_home)) <span class="sc">%&gt;%</span></span>
<span id="cb10-254"><a href="#cb10-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-255"><a href="#cb10-255" aria-hidden="true" tabindex="-1"></a>  <span class="co"># remove all GHE (up to 10,000 EAV added back to base per PIN), </span></span>
<span id="cb10-256"><a href="#cb10-256" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add exe_homeowner back to taxable base</span></span>
<span id="cb10-257"><a href="#cb10-257" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">neg10_taxable_eav =</span> Total_EAV <span class="sc">-</span> current_TIF_increment_EAV <span class="sc">-</span> current_Exempt_EAV <span class="sc">+</span> current_GHE,    <span class="co"># adds GHE exempt EAV back to taxable base and decreases tax rates</span></span>
<span id="cb10-258"><a href="#cb10-258" aria-hidden="true" tabindex="-1"></a>         <span class="at">plus10_taxable_eav =</span> Total_EAV <span class="sc">-</span> current_TIF_increment_EAV <span class="sc">-</span> current_Exempt_EAV <span class="sc">+</span> current_GHE <span class="sc">-</span> exe_plus10, <span class="co"># will increase tax rates</span></span>
<span id="cb10-259"><a href="#cb10-259" aria-hidden="true" tabindex="-1"></a>         <span class="at">plus20_taxable_eav =</span> Total_EAV <span class="sc">-</span> current_TIF_increment_EAV <span class="sc">-</span> current_Exempt_EAV <span class="sc">+</span> current_GHE <span class="sc">-</span> exe_plus20,</span>
<span id="cb10-260"><a href="#cb10-260" aria-hidden="true" tabindex="-1"></a>         <span class="at">plus30_taxable_eav =</span> Total_EAV <span class="sc">-</span> current_TIF_increment_EAV <span class="sc">-</span> current_Exempt_EAV <span class="sc">+</span> current_GHE <span class="sc">-</span> exe_plus30,</span>
<span id="cb10-261"><a href="#cb10-261" aria-hidden="true" tabindex="-1"></a>         <span class="at">plus40_taxable_eav =</span> Total_EAV <span class="sc">-</span> current_TIF_increment_EAV <span class="sc">-</span> current_Exempt_EAV <span class="sc">+</span> current_GHE <span class="sc">-</span> exe_plus40,</span>
<span id="cb10-262"><a href="#cb10-262" aria-hidden="true" tabindex="-1"></a>         <span class="at">scenario_noexemptions_taxable_eav =</span> Total_EAV <span class="sc">-</span> current_TIF_increment_EAV) <span class="sc">%&gt;%</span></span>
<span id="cb10-263"><a href="#cb10-263" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-264"><a href="#cb10-264" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tr_neg10 =</span> MuniLevy <span class="sc">/</span> neg10_taxable_eav,</span>
<span id="cb10-265"><a href="#cb10-265" aria-hidden="true" tabindex="-1"></a>         <span class="at">tr_nochange =</span> MuniLevy <span class="sc">/</span> current_nonTIF_EAV_post_exemps,</span>
<span id="cb10-266"><a href="#cb10-266" aria-hidden="true" tabindex="-1"></a>         <span class="at">tr_plus10 =</span> MuniLevy <span class="sc">/</span> plus10_taxable_eav,</span>
<span id="cb10-267"><a href="#cb10-267" aria-hidden="true" tabindex="-1"></a>         <span class="at">tr_plus20 =</span> MuniLevy <span class="sc">/</span> plus20_taxable_eav,</span>
<span id="cb10-268"><a href="#cb10-268" aria-hidden="true" tabindex="-1"></a>         <span class="at">tr_plus30 =</span> MuniLevy <span class="sc">/</span> plus30_taxable_eav,</span>
<span id="cb10-269"><a href="#cb10-269" aria-hidden="true" tabindex="-1"></a>         <span class="at">tr_plus40 =</span> MuniLevy <span class="sc">/</span> plus40_taxable_eav, </span>
<span id="cb10-270"><a href="#cb10-270" aria-hidden="true" tabindex="-1"></a>         <span class="at">tax_rate_current =</span> MuniLevy<span class="sc">/</span>current_nonTIF_EAV_post_exemps,</span>
<span id="cb10-271"><a href="#cb10-271" aria-hidden="true" tabindex="-1"></a>         <span class="at">taxrate_noexemps =</span> MuniLevy <span class="sc">/</span>(Total_EAV <span class="sc">-</span> current_TIF_increment_EAV  ),</span>
<span id="cb10-272"><a href="#cb10-272" aria-hidden="true" tabindex="-1"></a>         <span class="at">taxrate_noTIFs =</span> MuniLevy <span class="sc">/</span> (Total_EAV <span class="sc">-</span> current_Exempt_EAV),</span>
<span id="cb10-273"><a href="#cb10-273" aria-hidden="true" tabindex="-1"></a>         <span class="at">taxrate_noTIFs_orExemps =</span> MuniLevy <span class="sc">/</span> Total_EAV) <span class="sc">%&gt;%</span></span>
<span id="cb10-274"><a href="#cb10-274" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(clean_name, MuniLevy, tr_neg10<span class="sc">:</span>taxrate_noTIFs_orExemps, <span class="fu">everything</span>())</span>
<span id="cb10-275"><a href="#cb10-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-276"><a href="#cb10-276" aria-hidden="true" tabindex="-1"></a>scenario_taxrates <span class="ot">&lt;-</span> scenario_calcs <span class="sc">%&gt;%</span>  <span class="fu">select</span>(clean_name, MuniLevy, tr_neg10<span class="sc">:</span>taxrate_noTIFs_orExemps) </span>
<span id="cb10-277"><a href="#cb10-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-278"><a href="#cb10-278" aria-hidden="true" tabindex="-1"></a>scenario_taxrates</span>
<span id="cb10-279"><a href="#cb10-279" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-280"><a href="#cb10-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-283"><a href="#cb10-283" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb10-284"><a href="#cb10-284" aria-hidden="true" tabindex="-1"></a>joined_pins <span class="ot">&lt;-</span> joined_pins <span class="sc">%&gt;%</span> </span>
<span id="cb10-285"><a href="#cb10-285" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">exe_neg10 =</span> <span class="dv">0</span>,</span>
<span id="cb10-286"><a href="#cb10-286" aria-hidden="true" tabindex="-1"></a>         <span class="at">exe_0 =</span> <span class="fu">ifelse</span>(eav <span class="sc">&lt;</span> <span class="dv">10000</span> <span class="sc">&amp;</span> exe_homeowner<span class="sc">!=</span><span class="dv">0</span>, eav, </span>
<span id="cb10-287"><a href="#cb10-287" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">ifelse</span>(eav<span class="sc">&gt;</span><span class="dv">10000</span> <span class="sc">&amp;</span> exe_homeowner<span class="sc">!=</span><span class="dv">0</span>, <span class="dv">10000</span>, <span class="dv">0</span> )),  <span class="co">#would be if there is no change in exemptions</span></span>
<span id="cb10-288"><a href="#cb10-288" aria-hidden="true" tabindex="-1"></a>         <span class="at">exe_plus10 =</span> <span class="fu">ifelse</span>(eav <span class="sc">&lt;</span> <span class="dv">20000</span> <span class="sc">&amp;</span> exe_homeowner<span class="sc">!=</span><span class="dv">0</span>, eav, </span>
<span id="cb10-289"><a href="#cb10-289" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">ifelse</span>(eav<span class="sc">&gt;</span><span class="dv">20000</span> <span class="sc">&amp;</span> exe_homeowner<span class="sc">!=</span><span class="dv">0</span>, <span class="dv">20000</span>, <span class="dv">0</span> )),</span>
<span id="cb10-290"><a href="#cb10-290" aria-hidden="true" tabindex="-1"></a>         <span class="at">exe_plus20 =</span> <span class="fu">ifelse</span>(eav <span class="sc">&lt;</span> <span class="dv">30000</span> <span class="sc">&amp;</span> exe_homeowner<span class="sc">!=</span><span class="dv">0</span>, eav, </span>
<span id="cb10-291"><a href="#cb10-291" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">ifelse</span>(eav<span class="sc">&gt;</span><span class="dv">30000</span> <span class="sc">&amp;</span> exe_homeowner<span class="sc">!=</span><span class="dv">0</span>, <span class="dv">30000</span>, <span class="dv">0</span> ) ),</span>
<span id="cb10-292"><a href="#cb10-292" aria-hidden="true" tabindex="-1"></a>         <span class="at">exe_plus30 =</span> <span class="fu">ifelse</span>(eav <span class="sc">&lt;</span> <span class="dv">40000</span> <span class="sc">&amp;</span> exe_homeowner<span class="sc">!=</span><span class="dv">0</span>, eav, </span>
<span id="cb10-293"><a href="#cb10-293" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">ifelse</span>(eav<span class="sc">&gt;</span><span class="dv">40000</span> <span class="sc">&amp;</span> exe_homeowner<span class="sc">!=</span><span class="dv">0</span>, <span class="dv">40000</span>, <span class="dv">0</span>) ),</span>
<span id="cb10-294"><a href="#cb10-294" aria-hidden="true" tabindex="-1"></a>         <span class="at">exe_plus40 =</span> <span class="fu">ifelse</span>(eav <span class="sc">&lt;</span> <span class="dv">50000</span> <span class="sc">&amp;</span> exe_homeowner<span class="sc">!=</span><span class="dv">0</span>, eav, </span>
<span id="cb10-295"><a href="#cb10-295" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">ifelse</span>(eav<span class="sc">&gt;</span><span class="dv">50000</span> <span class="sc">&amp;</span> exe_homeowner<span class="sc">!=</span><span class="dv">0</span>, <span class="dv">50000</span>, <span class="dv">0</span>) ),</span>
<span id="cb10-296"><a href="#cb10-296" aria-hidden="true" tabindex="-1"></a>         <span class="at">mil_home =</span> <span class="fu">ifelse</span>(av<span class="sc">*</span><span class="dv">10</span> <span class="sc">&gt;</span> <span class="dv">1000000</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb10-297"><a href="#cb10-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-298"><a href="#cb10-298" aria-hidden="true" tabindex="-1"></a>scenario_calcs <span class="ot">&lt;-</span> joined_pins <span class="sc">%&gt;%</span>    </span>
<span id="cb10-299"><a href="#cb10-299" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(clean_name) <span class="sc">%&gt;%</span></span>
<span id="cb10-300"><a href="#cb10-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-301"><a href="#cb10-301" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">MuniLevy =</span> <span class="fu">sum</span>(final_tax_to_dist, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="co"># amount billed by munis with current exemptions in place</span></span>
<span id="cb10-302"><a href="#cb10-302" aria-hidden="true" tabindex="-1"></a>            <span class="at">current_nonTIF_EAV_post_exemps =</span> <span class="fu">sum</span>(final_tax_to_dist<span class="sc">/</span>(tax_code_rate<span class="sc">/</span><span class="dv">100</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb10-303"><a href="#cb10-303" aria-hidden="true" tabindex="-1"></a>            <span class="at">current_TIF_increment_EAV =</span> <span class="fu">sum</span>(final_tax_to_tif<span class="sc">/</span>(tax_code_rate<span class="sc">/</span><span class="dv">100</span>), <span class="at">na.rm=</span><span class="cn">TRUE</span>),  </span>
<span id="cb10-304"><a href="#cb10-304" aria-hidden="true" tabindex="-1"></a>            <span class="at">current_Exempt_EAV =</span> <span class="fu">sum</span>(tax_amt_exe<span class="sc">/</span>(tax_code_rate<span class="sc">/</span><span class="dv">100</span>), <span class="at">na.rm=</span><span class="cn">TRUE</span>), </span>
<span id="cb10-305"><a href="#cb10-305" aria-hidden="true" tabindex="-1"></a>            <span class="at">current_GHE =</span> <span class="fu">sum</span>(exe_homeowner, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb10-306"><a href="#cb10-306" aria-hidden="true" tabindex="-1"></a>            <span class="at">Total_EAV =</span> <span class="fu">sum</span>((tax_amt_exe<span class="sc">+</span>final_tax_to_dist<span class="sc">+</span>final_tax_to_tif)<span class="sc">/</span>(tax_code_rate<span class="sc">/</span><span class="dv">100</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb10-307"><a href="#cb10-307" aria-hidden="true" tabindex="-1"></a>            <span class="at">exe_neg10 =</span> <span class="fu">sum</span>(exe_neg10),</span>
<span id="cb10-308"><a href="#cb10-308" aria-hidden="true" tabindex="-1"></a>            <span class="at">exe_0 =</span> <span class="fu">sum</span>(exe_0), <span class="co"># no change, for comparison</span></span>
<span id="cb10-309"><a href="#cb10-309" aria-hidden="true" tabindex="-1"></a>            <span class="at">exe_plus10 =</span> <span class="fu">sum</span>(exe_plus10),</span>
<span id="cb10-310"><a href="#cb10-310" aria-hidden="true" tabindex="-1"></a>            <span class="at">exe_plus20 =</span> <span class="fu">sum</span>(exe_plus20),</span>
<span id="cb10-311"><a href="#cb10-311" aria-hidden="true" tabindex="-1"></a>            <span class="at">exe_plus30 =</span> <span class="fu">sum</span>(exe_plus30),</span>
<span id="cb10-312"><a href="#cb10-312" aria-hidden="true" tabindex="-1"></a>            <span class="at">exe_plus40 =</span> <span class="fu">sum</span>(exe_plus40),</span>
<span id="cb10-313"><a href="#cb10-313" aria-hidden="true" tabindex="-1"></a>            <span class="at">mil_home =</span> <span class="fu">sum</span>(mil_home)) <span class="sc">%&gt;%</span></span>
<span id="cb10-314"><a href="#cb10-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-315"><a href="#cb10-315" aria-hidden="true" tabindex="-1"></a>  <span class="co"># remove all GHE (up to 10,000 EAV added back to base per PIN), </span></span>
<span id="cb10-316"><a href="#cb10-316" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add exe_homeowner back to taxable base</span></span>
<span id="cb10-317"><a href="#cb10-317" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">neg10_taxable_eav =</span> Total_EAV <span class="sc">-</span> current_TIF_increment_EAV <span class="sc">-</span> current_Exempt_EAV <span class="sc">+</span> current_GHE,    <span class="co"># adds GHE exempt EAV back to taxable base and decreases tax rates</span></span>
<span id="cb10-318"><a href="#cb10-318" aria-hidden="true" tabindex="-1"></a>         <span class="at">plus10_taxable_eav =</span> Total_EAV <span class="sc">-</span> current_TIF_increment_EAV <span class="sc">-</span> current_Exempt_EAV <span class="sc">+</span> current_GHE <span class="sc">-</span> exe_plus10, <span class="co"># will increase tax rates</span></span>
<span id="cb10-319"><a href="#cb10-319" aria-hidden="true" tabindex="-1"></a>         <span class="at">plus20_taxable_eav =</span> Total_EAV <span class="sc">-</span> current_TIF_increment_EAV <span class="sc">-</span> current_Exempt_EAV <span class="sc">+</span> current_GHE <span class="sc">-</span> exe_plus20,</span>
<span id="cb10-320"><a href="#cb10-320" aria-hidden="true" tabindex="-1"></a>         <span class="at">plus30_taxable_eav =</span> Total_EAV <span class="sc">-</span> current_TIF_increment_EAV <span class="sc">-</span> current_Exempt_EAV <span class="sc">+</span> current_GHE <span class="sc">-</span> exe_plus30,</span>
<span id="cb10-321"><a href="#cb10-321" aria-hidden="true" tabindex="-1"></a>         <span class="at">plus40_taxable_eav =</span> Total_EAV <span class="sc">-</span> current_TIF_increment_EAV <span class="sc">-</span> current_Exempt_EAV <span class="sc">+</span> current_GHE <span class="sc">-</span> exe_plus40,</span>
<span id="cb10-322"><a href="#cb10-322" aria-hidden="true" tabindex="-1"></a>         <span class="at">scenario_noexemptions_taxable_eav =</span> Total_EAV <span class="sc">-</span> current_TIF_increment_EAV) <span class="sc">%&gt;%</span></span>
<span id="cb10-323"><a href="#cb10-323" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-324"><a href="#cb10-324" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tr_neg10 =</span> MuniLevy <span class="sc">/</span> neg10_taxable_eav,</span>
<span id="cb10-325"><a href="#cb10-325" aria-hidden="true" tabindex="-1"></a>         <span class="at">tr_nochange =</span> MuniLevy <span class="sc">/</span> current_nonTIF_EAV_post_exemps,</span>
<span id="cb10-326"><a href="#cb10-326" aria-hidden="true" tabindex="-1"></a>         <span class="at">tr_plus10 =</span> MuniLevy <span class="sc">/</span> plus10_taxable_eav,</span>
<span id="cb10-327"><a href="#cb10-327" aria-hidden="true" tabindex="-1"></a>         <span class="at">tr_plus20 =</span> MuniLevy <span class="sc">/</span> plus20_taxable_eav,</span>
<span id="cb10-328"><a href="#cb10-328" aria-hidden="true" tabindex="-1"></a>         <span class="at">tr_plus30 =</span> MuniLevy <span class="sc">/</span> plus30_taxable_eav,</span>
<span id="cb10-329"><a href="#cb10-329" aria-hidden="true" tabindex="-1"></a>         <span class="at">tr_plus40 =</span> MuniLevy <span class="sc">/</span> plus40_taxable_eav, </span>
<span id="cb10-330"><a href="#cb10-330" aria-hidden="true" tabindex="-1"></a>         <span class="at">tax_rate_current =</span> MuniLevy<span class="sc">/</span>current_nonTIF_EAV_post_exemps,</span>
<span id="cb10-331"><a href="#cb10-331" aria-hidden="true" tabindex="-1"></a>         <span class="at">taxrate_noexemps =</span> MuniLevy <span class="sc">/</span>(Total_EAV <span class="sc">-</span> current_TIF_increment_EAV  ),</span>
<span id="cb10-332"><a href="#cb10-332" aria-hidden="true" tabindex="-1"></a>         <span class="at">taxrate_noTIFs =</span> MuniLevy <span class="sc">/</span> (Total_EAV <span class="sc">-</span> current_Exempt_EAV),</span>
<span id="cb10-333"><a href="#cb10-333" aria-hidden="true" tabindex="-1"></a>         <span class="at">taxrate_noTIFs_orExemps =</span> MuniLevy <span class="sc">/</span> Total_EAV) <span class="sc">%&gt;%</span></span>
<span id="cb10-334"><a href="#cb10-334" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(clean_name, MuniLevy, tr_neg10<span class="sc">:</span>taxrate_noTIFs_orExemps, <span class="fu">everything</span>())</span>
<span id="cb10-335"><a href="#cb10-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-336"><a href="#cb10-336" aria-hidden="true" tabindex="-1"></a>scenario_taxrates <span class="ot">&lt;-</span> scenario_calcs <span class="sc">%&gt;%</span>  <span class="fu">select</span>(clean_name, MuniLevy, tr_neg10<span class="sc">:</span>taxrate_noTIFs_orExemps) </span>
<span id="cb10-337"><a href="#cb10-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-338"><a href="#cb10-338" aria-hidden="true" tabindex="-1"></a>scenario_taxrates</span>
<span id="cb10-339"><a href="#cb10-339" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-340"><a href="#cb10-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-341"><a href="#cb10-341" aria-hidden="true" tabindex="-1"></a><span class="fu"># Ranked Properties and Muni Quartiles</span></span>
<span id="cb10-342"><a href="#cb10-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-345"><a href="#cb10-345" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb10-346"><a href="#cb10-346" aria-hidden="true" tabindex="-1"></a>q <span class="ot">=</span> <span class="fu">c</span>(.<span class="dv">10</span>, .<span class="dv">25</span>, .<span class="dv">5</span>, .<span class="dv">75</span>, .<span class="dv">9</span>, .<span class="dv">99</span>)</span>
<span id="cb10-347"><a href="#cb10-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-348"><a href="#cb10-348" aria-hidden="true" tabindex="-1"></a><span class="do">## ranks properties that are considered single family homes in order of AV for each Muni</span></span>
<span id="cb10-349"><a href="#cb10-349" aria-hidden="true" tabindex="-1"></a>muni_quartiles <span class="ot">&lt;-</span> joined_pins <span class="sc">%&gt;%</span></span>
<span id="cb10-350"><a href="#cb10-350" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Option2 <span class="sc">==</span> <span class="st">"Single-Family"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb10-351"><a href="#cb10-351" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(tax_code <span class="sc">%in%</span> muni_TC_fullyCook<span class="sc">$</span>tax_code_num) <span class="sc">%&gt;%</span></span>
<span id="cb10-352"><a href="#cb10-352" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(agency_name, clean_name) <span class="sc">%&gt;%</span></span>
<span id="cb10-353"><a href="#cb10-353" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(av) <span class="sc">%&gt;%</span></span>
<span id="cb10-354"><a href="#cb10-354" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">count_pins =</span> <span class="fu">n</span>(), </span>
<span id="cb10-355"><a href="#cb10-355" aria-hidden="true" tabindex="-1"></a>            <span class="at">min =</span> <span class="fu">min</span>(av),</span>
<span id="cb10-356"><a href="#cb10-356" aria-hidden="true" tabindex="-1"></a>            <span class="at">quant10 =</span> <span class="fu">round</span>(<span class="fu">quantile</span>(av, <span class="at">probs =</span> q[<span class="dv">1</span>])), </span>
<span id="cb10-357"><a href="#cb10-357" aria-hidden="true" tabindex="-1"></a>            <span class="at">quant25 =</span> <span class="fu">round</span>(<span class="fu">quantile</span>(av, <span class="at">probs =</span> q[<span class="dv">2</span>])), </span>
<span id="cb10-358"><a href="#cb10-358" aria-hidden="true" tabindex="-1"></a>            <span class="at">quant50 =</span> <span class="fu">round</span>(<span class="fu">quantile</span>(av, <span class="at">probs =</span> q[<span class="dv">3</span>])),</span>
<span id="cb10-359"><a href="#cb10-359" aria-hidden="true" tabindex="-1"></a>            <span class="at">quant75 =</span> <span class="fu">round</span>(<span class="fu">quantile</span>(av, <span class="at">probs =</span> q[<span class="dv">4</span>])),</span>
<span id="cb10-360"><a href="#cb10-360" aria-hidden="true" tabindex="-1"></a>            <span class="at">quant90 =</span> <span class="fu">round</span>(<span class="fu">quantile</span>(av, <span class="at">probs =</span> q[<span class="dv">5</span>])),</span>
<span id="cb10-361"><a href="#cb10-361" aria-hidden="true" tabindex="-1"></a>            <span class="at">quant99 =</span> <span class="fu">round</span>(<span class="fu">quantile</span>(av, <span class="at">probs =</span> q[<span class="dv">6</span>])),</span>
<span id="cb10-362"><a href="#cb10-362" aria-hidden="true" tabindex="-1"></a>            <span class="at">max =</span> <span class="fu">max</span>(av)</span>
<span id="cb10-363"><a href="#cb10-363" aria-hidden="true" tabindex="-1"></a>           ) <span class="sc">%&gt;%</span> </span>
<span id="cb10-364"><a href="#cb10-364" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>( <span class="fu">desc</span>( quant50))</span>
<span id="cb10-365"><a href="#cb10-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-366"><a href="#cb10-366" aria-hidden="true" tabindex="-1"></a>muni_quartiles</span>
<span id="cb10-367"><a href="#cb10-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-368"><a href="#cb10-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-369"><a href="#cb10-369" aria-hidden="true" tabindex="-1"></a><span class="do">## create rank variable for properties that fall within the quartiles +/- $500 range</span></span>
<span id="cb10-370"><a href="#cb10-370" aria-hidden="true" tabindex="-1"></a>munis_ranked <span class="ot">&lt;-</span> joined_pins  <span class="sc">%&gt;%</span></span>
<span id="cb10-371"><a href="#cb10-371" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(muni_quartiles, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"agency_name"</span>, <span class="st">"clean_name"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-372"><a href="#cb10-372" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rank =</span> <span class="fu">case_when</span>(</span>
<span id="cb10-373"><a href="#cb10-373" aria-hidden="true" tabindex="-1"></a>    av <span class="sc">&gt;</span> (quant10<span class="dv">-500</span>) <span class="sc">&amp;</span> (av<span class="sc">&lt;</span>quant10<span class="sc">+</span><span class="dv">500</span>) <span class="sc">~</span> <span class="st">"q10"</span>,</span>
<span id="cb10-374"><a href="#cb10-374" aria-hidden="true" tabindex="-1"></a>    av <span class="sc">&gt;</span> (quant25<span class="dv">-500</span>) <span class="sc">&amp;</span> (av<span class="sc">&lt;</span>quant25<span class="sc">+</span><span class="dv">500</span>) <span class="sc">~</span> <span class="st">"q25"</span>,</span>
<span id="cb10-375"><a href="#cb10-375" aria-hidden="true" tabindex="-1"></a>    av <span class="sc">&gt;</span> (quant50<span class="dv">-500</span>) <span class="sc">&amp;</span> (av<span class="sc">&lt;</span>quant50<span class="sc">+</span><span class="dv">500</span>) <span class="sc">~</span> <span class="st">"q50"</span>,</span>
<span id="cb10-376"><a href="#cb10-376" aria-hidden="true" tabindex="-1"></a>    av <span class="sc">&gt;</span> (quant75<span class="dv">-500</span>) <span class="sc">&amp;</span> (av<span class="sc">&lt;</span>quant75<span class="sc">+</span><span class="dv">500</span>) <span class="sc">~</span> <span class="st">"q75"</span>,</span>
<span id="cb10-377"><a href="#cb10-377" aria-hidden="true" tabindex="-1"></a>    av <span class="sc">&gt;</span> (quant90<span class="dv">-500</span>) <span class="sc">&amp;</span> (av<span class="sc">&lt;</span>quant90<span class="sc">+</span><span class="dv">500</span>) <span class="sc">~</span> <span class="st">"q90"</span>,</span>
<span id="cb10-378"><a href="#cb10-378" aria-hidden="true" tabindex="-1"></a>    av <span class="sc">&gt;</span> (quant99<span class="dv">-500</span>) <span class="sc">&amp;</span> (av<span class="sc">&lt;</span>quant99<span class="sc">+</span><span class="dv">500</span>) <span class="sc">~</span> <span class="st">"q99"</span>)</span>
<span id="cb10-379"><a href="#cb10-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-380"><a href="#cb10-380" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb10-381"><a href="#cb10-381" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(clean_name, rank, av, pin, class, <span class="fu">everything</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb10-382"><a href="#cb10-382" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(nicknames)</span>
<span id="cb10-383"><a href="#cb10-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-384"><a href="#cb10-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-385"><a href="#cb10-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-386"><a href="#cb10-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-387"><a href="#cb10-387" aria-hidden="true" tabindex="-1"></a>munis_billchange <span class="ot">&lt;-</span>  munis_ranked <span class="sc">%&gt;%</span> </span>
<span id="cb10-388"><a href="#cb10-388" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(clean_name, rank) <span class="sc">%&gt;%</span></span>
<span id="cb10-389"><a href="#cb10-389" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(scenario_taxrates) <span class="sc">%&gt;%</span></span>
<span id="cb10-390"><a href="#cb10-390" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(av) <span class="sc">%&gt;%</span></span>
<span id="cb10-391"><a href="#cb10-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-392"><a href="#cb10-392" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb10-393"><a href="#cb10-393" aria-hidden="true" tabindex="-1"></a>   <span class="co"># ## Made negative tax bills!! ## #</span></span>
<span id="cb10-394"><a href="#cb10-394" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb10-395"><a href="#cb10-395" aria-hidden="true" tabindex="-1"></a>         <span class="at">bill_neg10 =</span> tr_neg10<span class="sc">*</span>(equalized_AV<span class="sc">-</span>all_exemptions<span class="sc">+</span> exe_homeowner <span class="sc">-</span>exe_neg10),</span>
<span id="cb10-396"><a href="#cb10-396" aria-hidden="true" tabindex="-1"></a>         <span class="at">bill_current =</span> cur_comp_TC_rate<span class="sc">/</span><span class="dv">100</span><span class="sc">*</span>(equalized_AV<span class="sc">-</span>all_exemptions),</span>
<span id="cb10-397"><a href="#cb10-397" aria-hidden="true" tabindex="-1"></a>         <span class="at">bill_plus10 =</span>  tr_plus10<span class="sc">*</span>(equalized_AV<span class="sc">-</span>all_exemptions<span class="sc">+</span> exe_homeowner <span class="sc">-</span>exe_plus10),</span>
<span id="cb10-398"><a href="#cb10-398" aria-hidden="true" tabindex="-1"></a>         <span class="at">bill_plus20 =</span> tr_plus20<span class="sc">*</span>(equalized_AV<span class="sc">-</span>all_exemptions<span class="sc">+</span> exe_homeowner <span class="sc">-</span>exe_plus20),</span>
<span id="cb10-399"><a href="#cb10-399" aria-hidden="true" tabindex="-1"></a>         <span class="at">bill_plus30 =</span> tr_plus30<span class="sc">*</span>(equalized_AV<span class="sc">-</span>all_exemptions<span class="sc">+</span> exe_homeowner <span class="sc">-</span>exe_plus30),</span>
<span id="cb10-400"><a href="#cb10-400" aria-hidden="true" tabindex="-1"></a>         <span class="at">bill_plus40 =</span> tr_plus40<span class="sc">*</span>(equalized_AV<span class="sc">-</span>all_exemptions<span class="sc">+</span> exe_homeowner <span class="sc">-</span>exe_plus40),</span>
<span id="cb10-401"><a href="#cb10-401" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-402"><a href="#cb10-402" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ## make bills $1 if they had been negative.    </span></span>
<span id="cb10-403"><a href="#cb10-403" aria-hidden="true" tabindex="-1"></a>         <span class="at">bill_neg10 =</span> <span class="fu">ifelse</span>(bill_neg10 <span class="sc">&lt;</span> <span class="dv">1</span>, <span class="dv">1</span>, bill_neg10),</span>
<span id="cb10-404"><a href="#cb10-404" aria-hidden="true" tabindex="-1"></a>         <span class="at">bill_current =</span> <span class="fu">ifelse</span>(bill_current <span class="sc">&lt;</span> <span class="dv">1</span>, <span class="dv">1</span>, bill_current),</span>
<span id="cb10-405"><a href="#cb10-405" aria-hidden="true" tabindex="-1"></a>         <span class="at">bill_plus10 =</span> <span class="fu">ifelse</span>(bill_plus10 <span class="sc">&lt;</span> <span class="dv">1</span>, <span class="dv">1</span>, bill_plus10),</span>
<span id="cb10-406"><a href="#cb10-406" aria-hidden="true" tabindex="-1"></a>         <span class="at">bill_plus20 =</span> <span class="fu">ifelse</span>(bill_plus20 <span class="sc">&lt;</span> <span class="dv">1</span>, <span class="dv">1</span>, bill_plus20),</span>
<span id="cb10-407"><a href="#cb10-407" aria-hidden="true" tabindex="-1"></a>         <span class="at">bill_plus30 =</span> <span class="fu">ifelse</span>(bill_plus30 <span class="sc">&lt;</span> <span class="dv">1</span>, <span class="dv">1</span>, bill_plus30),</span>
<span id="cb10-408"><a href="#cb10-408" aria-hidden="true" tabindex="-1"></a>         <span class="at">bill_plus40 =</span> <span class="fu">ifelse</span>(bill_plus40 <span class="sc">&lt;</span> <span class="dv">1</span>, <span class="dv">1</span>, bill_plus40)</span>
<span id="cb10-409"><a href="#cb10-409" aria-hidden="true" tabindex="-1"></a>         )<span class="sc">%&gt;%</span></span>
<span id="cb10-410"><a href="#cb10-410" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-411"><a href="#cb10-411" aria-hidden="true" tabindex="-1"></a>         <span class="at">zerodol_bills_ghe0 =</span> <span class="fu">ifelse</span>(bill_neg10 <span class="sc">&lt;</span> <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb10-412"><a href="#cb10-412" aria-hidden="true" tabindex="-1"></a>         <span class="at">zerodol_bills_current =</span> <span class="fu">ifelse</span>(bill_current <span class="sc">&lt;</span> <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb10-413"><a href="#cb10-413" aria-hidden="true" tabindex="-1"></a>         <span class="at">zerodol_bills_ghe20 =</span> <span class="fu">ifelse</span>(bill_plus10 <span class="sc">&lt;</span> <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb10-414"><a href="#cb10-414" aria-hidden="true" tabindex="-1"></a>         <span class="at">zerodol_bills_ghe30 =</span> <span class="fu">ifelse</span>(bill_plus20 <span class="sc">&lt;</span> <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb10-415"><a href="#cb10-415" aria-hidden="true" tabindex="-1"></a>         <span class="at">zerodol_bills_ghe40 =</span> <span class="fu">ifelse</span>(bill_plus30 <span class="sc">&lt;</span> <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb10-416"><a href="#cb10-416" aria-hidden="true" tabindex="-1"></a>         <span class="at">zerodol_bills_ghe50 =</span> <span class="fu">ifelse</span>(bill_plus40 <span class="sc">&lt;</span> <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb10-417"><a href="#cb10-417" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb10-418"><a href="#cb10-418" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(clean_name, rank, has_HO_exemp) <span class="sc">%&gt;%</span> </span>
<span id="cb10-419"><a href="#cb10-419" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">median_AV =</span> <span class="fu">round</span>(<span class="fu">median</span>(av)),</span>
<span id="cb10-420"><a href="#cb10-420" aria-hidden="true" tabindex="-1"></a>            <span class="at">median_EAV =</span> <span class="fu">round</span>(<span class="fu">median</span>(eav)),</span>
<span id="cb10-421"><a href="#cb10-421" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_bill_neg10 =</span> <span class="fu">round</span>(<span class="fu">mean</span>(bill_neg10, <span class="at">na.rm=</span><span class="cn">TRUE</span>)),</span>
<span id="cb10-422"><a href="#cb10-422" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_bill_cur =</span> <span class="fu">round</span>(<span class="fu">mean</span>(bill_current, <span class="at">na.rm=</span><span class="cn">TRUE</span>)),</span>
<span id="cb10-423"><a href="#cb10-423" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_bill_plus10 =</span> <span class="fu">round</span>(<span class="fu">mean</span>(bill_plus10, <span class="at">na.rm=</span><span class="cn">TRUE</span>)),</span>
<span id="cb10-424"><a href="#cb10-424" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_bill_plus20 =</span> <span class="fu">round</span>(<span class="fu">mean</span>(bill_plus20, <span class="at">na.rm=</span><span class="cn">TRUE</span>)),</span>
<span id="cb10-425"><a href="#cb10-425" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_bill_plus30 =</span> <span class="fu">round</span>(<span class="fu">mean</span>(bill_plus30, <span class="at">na.rm=</span><span class="cn">TRUE</span>)),</span>
<span id="cb10-426"><a href="#cb10-426" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_bill_plus40 =</span> <span class="fu">round</span>(<span class="fu">mean</span>(bill_plus40, <span class="at">na.rm=</span><span class="cn">TRUE</span>)),</span>
<span id="cb10-427"><a href="#cb10-427" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb10-428"><a href="#cb10-428" aria-hidden="true" tabindex="-1"></a>            <span class="co"># current perceived_savings = median(tax_amt_exe),</span></span>
<span id="cb10-429"><a href="#cb10-429" aria-hidden="true" tabindex="-1"></a>            <span class="at">tr_neg10 =</span> <span class="fu">round</span>(<span class="fu">mean</span>(tr_neg10<span class="sc">*</span><span class="dv">100</span>), <span class="at">digits =</span> <span class="dv">2</span>), </span>
<span id="cb10-430"><a href="#cb10-430" aria-hidden="true" tabindex="-1"></a>            <span class="at">cur_comp_TC_rate =</span> <span class="fu">round</span>(<span class="fu">mean</span>(cur_comp_TC_rate), <span class="at">digits =</span> <span class="dv">2</span>),</span>
<span id="cb10-431"><a href="#cb10-431" aria-hidden="true" tabindex="-1"></a>            <span class="at">tr_plus10 =</span> <span class="fu">round</span>(<span class="fu">mean</span>(tr_plus10<span class="sc">*</span><span class="dv">100</span>), <span class="at">digits =</span> <span class="dv">2</span>),</span>
<span id="cb10-432"><a href="#cb10-432" aria-hidden="true" tabindex="-1"></a>            <span class="at">tr_plus20 =</span> <span class="fu">round</span>(<span class="fu">mean</span>(tr_plus20<span class="sc">*</span><span class="dv">100</span>), <span class="at">digits =</span> <span class="dv">2</span>),</span>
<span id="cb10-433"><a href="#cb10-433" aria-hidden="true" tabindex="-1"></a>            <span class="at">tr_plus30 =</span> <span class="fu">round</span>(<span class="fu">mean</span>(tr_plus30<span class="sc">*</span><span class="dv">100</span>), <span class="at">digits =</span> <span class="dv">2</span>),</span>
<span id="cb10-434"><a href="#cb10-434" aria-hidden="true" tabindex="-1"></a>            <span class="at">tr_plus40 =</span> <span class="fu">round</span>(<span class="fu">mean</span>(tr_plus40<span class="sc">*</span><span class="dv">100</span>), <span class="at">digits =</span> <span class="dv">2</span>),</span>
<span id="cb10-435"><a href="#cb10-435" aria-hidden="true" tabindex="-1"></a>            <span class="at">pincount=</span><span class="fu">n</span>(),</span>
<span id="cb10-436"><a href="#cb10-436" aria-hidden="true" tabindex="-1"></a>            <span class="at">zerodol_bills_ghe0 =</span> <span class="fu">sum</span>(zerodol_bills_ghe0),           </span>
<span id="cb10-437"><a href="#cb10-437" aria-hidden="true" tabindex="-1"></a>            <span class="at">zerodol_bills_current =</span> <span class="fu">sum</span>(zerodol_bills_current),</span>
<span id="cb10-438"><a href="#cb10-438" aria-hidden="true" tabindex="-1"></a>            <span class="at">zerodol_bills_ghe20 =</span> <span class="fu">sum</span>(zerodol_bills_ghe20),</span>
<span id="cb10-439"><a href="#cb10-439" aria-hidden="true" tabindex="-1"></a>            <span class="at">zerodol_bills_ghe30 =</span> <span class="fu">sum</span>(zerodol_bills_ghe30),</span>
<span id="cb10-440"><a href="#cb10-440" aria-hidden="true" tabindex="-1"></a>            <span class="at">zerodol_bills_ghe40 =</span> <span class="fu">sum</span>(zerodol_bills_ghe40),</span>
<span id="cb10-441"><a href="#cb10-441" aria-hidden="true" tabindex="-1"></a>            <span class="at">zerodol_bills_ghe50 =</span> <span class="fu">sum</span>(zerodol_bills_ghe50),</span>
<span id="cb10-442"><a href="#cb10-442" aria-hidden="true" tabindex="-1"></a>            <span class="at">mill_homes =</span> <span class="fu">sum</span>(mil_home)</span>
<span id="cb10-443"><a href="#cb10-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-444"><a href="#cb10-444" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb10-445"><a href="#cb10-445" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(has_HO_exemp, rank)</span>
<span id="cb10-446"><a href="#cb10-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-447"><a href="#cb10-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-448"><a href="#cb10-448" aria-hidden="true" tabindex="-1"></a>munis_billchange <span class="ot">&lt;-</span> munis_billchange <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(muni_quartiles)</span>
<span id="cb10-449"><a href="#cb10-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-450"><a href="#cb10-450" aria-hidden="true" tabindex="-1"></a>munis_billchange </span>
<span id="cb10-451"><a href="#cb10-451" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-452"><a href="#cb10-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-453"><a href="#cb10-453" aria-hidden="true" tabindex="-1"></a><span class="in">```{r milliondollar-homes}</span></span>
<span id="cb10-454"><a href="#cb10-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-455"><a href="#cb10-455" aria-hidden="true" tabindex="-1"></a>munis_ranked <span class="sc">%&gt;%</span> </span>
<span id="cb10-456"><a href="#cb10-456" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mil_home =</span> <span class="fu">ifelse</span>(major_class_code <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> av<span class="sc">*</span><span class="dv">10</span> <span class="sc">&gt;</span> <span class="dv">1000000</span>, <span class="dv">1</span>, <span class="dv">0</span>) ) <span class="sc">%&gt;%</span></span>
<span id="cb10-457"><a href="#cb10-457" aria-hidden="true" tabindex="-1"></a> <span class="co"># filter(has_HO_exemp == 1) %&gt;% </span></span>
<span id="cb10-458"><a href="#cb10-458" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(clean_name, has_HO_exemp) <span class="sc">%&gt;%</span> </span>
<span id="cb10-459"><a href="#cb10-459" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">million_dollar_homes =</span> <span class="fu">sum</span>(mil_home)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-460"><a href="#cb10-460" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(million_dollar_homes))</span>
<span id="cb10-461"><a href="#cb10-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-462"><a href="#cb10-462" aria-hidden="true" tabindex="-1"></a>munis_ranked <span class="sc">%&gt;%</span> </span>
<span id="cb10-463"><a href="#cb10-463" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mil_home =</span> <span class="fu">ifelse</span>(major_class_code <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> av<span class="sc">*</span><span class="dv">10</span> <span class="sc">&gt;</span> <span class="dv">1000000</span>,<span class="dv">1</span>,<span class="dv">0</span>) ) <span class="sc">%&gt;%</span></span>
<span id="cb10-464"><a href="#cb10-464" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(has_HO_exemp <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb10-465"><a href="#cb10-465" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(clean_name) <span class="sc">%&gt;%</span> </span>
<span id="cb10-466"><a href="#cb10-466" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">million_dollar_homes =</span> <span class="fu">sum</span>(mil_home)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-467"><a href="#cb10-467" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(million_dollar_homes))</span>
<span id="cb10-468"><a href="#cb10-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-469"><a href="#cb10-469" aria-hidden="true" tabindex="-1"></a>munis_ranked <span class="sc">%&gt;%</span> </span>
<span id="cb10-470"><a href="#cb10-470" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mil_home =</span> <span class="fu">ifelse</span>(major_class_code <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span>av<span class="sc">*</span><span class="dv">10</span> <span class="sc">&gt;</span> <span class="dv">1000000</span>,<span class="dv">1</span>,<span class="dv">0</span>) ) <span class="sc">%&gt;%</span></span>
<span id="cb10-471"><a href="#cb10-471" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(has_HO_exemp <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb10-472"><a href="#cb10-472" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">million_dollar_homes =</span> <span class="fu">sum</span>(mil_home))</span>
<span id="cb10-473"><a href="#cb10-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-474"><a href="#cb10-474" aria-hidden="true" tabindex="-1"></a>munis_ranked <span class="sc">%&gt;%</span> </span>
<span id="cb10-475"><a href="#cb10-475" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mil_home =</span> <span class="fu">ifelse</span>(major_class_code <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> av<span class="sc">*</span><span class="dv">10</span> <span class="sc">&gt;</span> <span class="dv">1000000</span>,<span class="dv">1</span>,<span class="dv">0</span>) ) <span class="sc">%&gt;%</span></span>
<span id="cb10-476"><a href="#cb10-476" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(has_HO_exemp <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> mil_home <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb10-477"><a href="#cb10-477" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb10-478"><a href="#cb10-478" aria-hidden="true" tabindex="-1"></a>    <span class="at">exempt_eav  =</span> <span class="fu">sum</span>(exe_0),</span>
<span id="cb10-479"><a href="#cb10-479" aria-hidden="true" tabindex="-1"></a>    <span class="at">million_dollar_homes =</span> <span class="fu">sum</span>(mil_home),</span>
<span id="cb10-480"><a href="#cb10-480" aria-hidden="true" tabindex="-1"></a>    <span class="at">bonus_rev =</span> <span class="fu">sum</span>(cur_comp_TC_rate<span class="sc">*</span>exe_0))</span>
<span id="cb10-481"><a href="#cb10-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-482"><a href="#cb10-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-483"><a href="#cb10-483" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-484"><a href="#cb10-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-485"><a href="#cb10-485" aria-hidden="true" tabindex="-1"></a>Of these, 50,775 did not claim the GHE exemption. 17,107 million dollar homes did claim the GHE exemption in 2021.</span>
<span id="cb10-486"><a href="#cb10-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-487"><a href="#cb10-487" aria-hidden="true" tabindex="-1"></a>Amount of money that could be "transferred" to areas impacted by high tax rates =</span>
<span id="cb10-488"><a href="#cb10-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-489"><a href="#cb10-489" aria-hidden="true" tabindex="-1"></a>Sum of (composite tax rate <span class="sc">\*</span> exempt_EAV) = \$13 million</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>